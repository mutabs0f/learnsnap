{"file_contents":{"client/src/pages/upload.tsx":{"content":"import { useState, useCallback, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation, Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { \n  Upload as UploadIcon, \n  X, \n  Image as ImageIcon, \n  ArrowRight,\n  BookOpen,\n  Camera,\n  Lightbulb,\n  CheckCircle,\n  Loader2\n} from \"lucide-react\";\nimport type { Child } from \"@shared/schema\";\n\nconst subjects = [\n  { value: \"math\", label: \"الرياضيات\" },\n  { value: \"science\", label: \"العلوم\" },\n  { value: \"arabic\", label: \"اللغة العربية\" },\n  { value: \"english\", label: \"اللغة الإنجليزية\" },\n  { value: \"islamic\", label: \"التربية الإسلامية\" },\n  { value: \"social\", label: \"الدراسات الاجتماعية\" },\n];\n\nconst grades = [\n  { value: \"1\", label: \"الصف الأول\" },\n  { value: \"2\", label: \"الصف الثاني\" },\n  { value: \"3\", label: \"الصف الثالث\" },\n  { value: \"4\", label: \"الصف الرابع\" },\n  { value: \"5\", label: \"الصف الخامس\" },\n  { value: \"6\", label: \"الصف السادس\" },\n];\n\nconst tips = [\n  { icon: Lightbulb, text: \"تأكد من إضاءة جيدة للصور\" },\n  { icon: Camera, text: \"صوّر الصفحة بشكل مستقيم\" },\n  { icon: CheckCircle, text: \"تأكد من وضوح النص\" },\n];\n\ninterface UploadedPhoto {\n  id: string;\n  file: File;\n  preview: string;\n  pageNumber: number;\n}\n\nexport default function UploadPage() {\n  const [, setLocation] = useLocation();\n  const parentId = localStorage.getItem(\"userId\");\n  const { toast } = useToast();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const [selectedChild, setSelectedChild] = useState<string>(\"\");\n  const [subject, setSubject] = useState<string>(\"\");\n  const [grade, setGrade] = useState<string>(\"\");\n  const [title, setTitle] = useState<string>(\"\");\n  const [photos, setPhotos] = useState<UploadedPhoto[]>([]);\n  const [uploadProgress, setUploadProgress] = useState(0);\n  const [isUploading, setIsUploading] = useState(false);\n\n  const { data: children, isLoading: loadingChildren } = useQuery<Child[]>({\n    queryKey: [\"/api/children\", parentId],\n    enabled: !!parentId,\n  });\n\n  const createChapterMutation = useMutation({\n    mutationFn: async () => {\n      setIsUploading(true);\n      setUploadProgress(10);\n\n      const photoDataPromises = photos.map(async (photo) => {\n        return new Promise<string>((resolve) => {\n          const reader = new FileReader();\n          reader.onloadend = () => {\n            resolve(reader.result as string);\n          };\n          reader.readAsDataURL(photo.file);\n        });\n      });\n\n      const photoDataArray = await Promise.all(photoDataPromises);\n      setUploadProgress(30);\n\n      const res = await apiRequest(\"POST\", \"/api/chapters\", {\n        childId: selectedChild,\n        parentId,\n        title,\n        subject,\n        grade: parseInt(grade),\n        photos: photoDataArray.map((data, index) => ({\n          photoData: data,\n          pageNumber: index + 1,\n        })),\n      });\n\n      setUploadProgress(50);\n      return res.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chapters\"] });\n      toast({ title: \"تم الإرسال!\", description: \"جاري معالجة الفصل...\" });\n      setLocation(`/chapter/${data.chapter.id}/processing`);\n    },\n    onError: () => {\n      setIsUploading(false);\n      toast({ title: \"خطأ\", description: \"حدث خطأ أثناء إرسال الفصل\", variant: \"destructive\" });\n    },\n  });\n\n  const handleFileSelect = useCallback((files: FileList | null) => {\n    if (!files) return;\n\n    const validFiles = Array.from(files).filter(file => {\n      const validTypes = ['image/jpeg', 'image/png', 'image/heic', 'image/heif'];\n      const maxSize = 10 * 1024 * 1024; // 10MB\n      return validTypes.includes(file.type) && file.size <= maxSize;\n    });\n\n    if (validFiles.length === 0) {\n      toast({ \n        title: \"ملفات غير صالحة\", \n        description: \"الرجاء رفع صور بصيغة JPG أو PNG (حد أقصى 10MB)\", \n        variant: \"destructive\" \n      });\n      return;\n    }\n\n    const newPhotos: UploadedPhoto[] = validFiles.map((file, index) => ({\n      id: `${Date.now()}-${index}`,\n      file,\n      preview: URL.createObjectURL(file),\n      pageNumber: photos.length + index + 1,\n    }));\n\n    setPhotos(prev => [...prev, ...newPhotos].slice(0, 20));\n  }, [photos.length, toast]);\n\n  const handleDrop = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    handleFileSelect(e.dataTransfer.files);\n  }, [handleFileSelect]);\n\n  const handleDragOver = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n  }, []);\n\n  const removePhoto = (id: string) => {\n    setPhotos(prev => {\n      const updated = prev.filter(p => p.id !== id);\n      return updated.map((p, i) => ({ ...p, pageNumber: i + 1 }));\n    });\n  };\n\n  const canSubmit = selectedChild && subject && grade && title && photos.length >= 1;\n\n  if (!parentId) {\n    setLocation(\"/auth\");\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\" dir=\"rtl\">\n      <header className=\"bg-white border-b sticky top-0 z-50\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center h-16 gap-4\">\n            <Link href=\"/\">\n              <Button variant=\"ghost\" size=\"icon\">\n                <ArrowRight className=\"w-5 h-5\" />\n              </Button>\n            </Link>\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 bg-gradient-to-br from-blue-500 to-emerald-500 rounded-xl flex items-center justify-center\">\n                <UploadIcon className=\"w-5 h-5 text-white\" />\n              </div>\n              <div>\n                <h1 className=\"font-bold font-arabic\">إضافة فصل جديد</h1>\n                <p className=\"text-xs text-muted-foreground font-arabic\">صوّر صفحات الكتاب وأرسلها</p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          <div className=\"lg:col-span-2 space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"font-arabic\">معلومات الفصل</CardTitle>\n                <CardDescription className=\"font-arabic\">اختر الطفل والمادة والصف الدراسي</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label className=\"font-arabic\">اختر الطفل</Label>\n                  <Select value={selectedChild} onValueChange={setSelectedChild}>\n                    <SelectTrigger data-testid=\"select-child\">\n                      <SelectValue placeholder=\"اختر الطفل\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {children?.map((child) => (\n                        <SelectItem key={child.id} value={child.id}>\n                          {child.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label className=\"font-arabic\">المادة</Label>\n                    <Select value={subject} onValueChange={setSubject}>\n                      <SelectTrigger data-testid=\"select-subject\">\n                        <SelectValue placeholder=\"اختر المادة\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {subjects.map((s) => (\n                          <SelectItem key={s.value} value={s.value}>\n                            {s.label}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label className=\"font-arabic\">الصف</Label>\n                    <Select value={grade} onValueChange={setGrade}>\n                      <SelectTrigger data-testid=\"select-grade\">\n                        <SelectValue placeholder=\"اختر الصف\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {grades.map((g) => (\n                          <SelectItem key={g.value} value={g.value}>\n                            {g.label}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label className=\"font-arabic\">عنوان الفصل</Label>\n                  <Input \n                    placeholder=\"مثال: الجمع والطرح\"\n                    value={title}\n                    onChange={(e) => setTitle(e.target.value)}\n                    data-testid=\"input-chapter-title\"\n                  />\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"font-arabic\">صور صفحات الكتاب</CardTitle>\n                <CardDescription className=\"font-arabic\">\n                  ارفع من 1 إلى 20 صورة (JPG, PNG - حد أقصى 10MB لكل صورة)\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div\n                  className=\"border-2 border-dashed rounded-xl p-8 text-center transition-colors cursor-pointer hover:border-primary hover:bg-muted/50\"\n                  onDrop={handleDrop}\n                  onDragOver={handleDragOver}\n                  onClick={() => fileInputRef.current?.click()}\n                  data-testid=\"dropzone-photos\"\n                >\n                  <input\n                    ref={fileInputRef}\n                    type=\"file\"\n                    accept=\"image/jpeg,image/png,image/heic,image/heif\"\n                    multiple\n                    onChange={(e) => handleFileSelect(e.target.files)}\n                    className=\"hidden\"\n                    data-testid=\"input-file-photos\"\n                  />\n                  <div className=\"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4\">\n                    <ImageIcon className=\"w-8 h-8 text-muted-foreground\" />\n                  </div>\n                  <p className=\"font-arabic text-muted-foreground mb-2\">\n                    اسحب الصور هنا أو انقر للاختيار\n                  </p>\n                  <p className=\"text-sm text-muted-foreground font-arabic\">\n                    {photos.length}/20 صورة\n                  </p>\n                </div>\n\n                {photos.length > 0 && (\n                  <div className=\"grid grid-cols-3 sm:grid-cols-4 gap-3 mt-6\">\n                    {photos.map((photo) => (\n                      <div key={photo.id} className=\"relative group aspect-square\" data-testid={`photo-preview-${photo.id}`}>\n                        <img\n                          src={photo.preview}\n                          alt={`صفحة ${photo.pageNumber}`}\n                          className=\"w-full h-full object-cover rounded-lg\"\n                        />\n                        <div className=\"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center\">\n                          <Button\n                            variant=\"destructive\"\n                            size=\"icon\"\n                            className=\"w-8 h-8\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              removePhoto(photo.id);\n                            }}\n                            data-testid={`button-remove-photo-${photo.id}`}\n                          >\n                            <X className=\"w-4 h-4\" />\n                          </Button>\n                        </div>\n                        <span className=\"absolute bottom-1 right-1 bg-black/60 text-white text-xs px-2 py-0.5 rounded font-arabic\">\n                          {photo.pageNumber}\n                        </span>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            {isUploading && (\n              <Card>\n                <CardContent className=\"py-6\">\n                  <div className=\"flex items-center gap-4\">\n                    <Loader2 className=\"w-6 h-6 animate-spin text-primary\" />\n                    <div className=\"flex-1\">\n                      <p className=\"font-arabic font-medium mb-2\">جاري رفع الصور...</p>\n                      <Progress value={uploadProgress} className=\"h-2\" />\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n\n            <Button\n              className=\"w-full font-arabic h-12 text-lg\"\n              disabled={!canSubmit || isUploading}\n              onClick={() => createChapterMutation.mutate()}\n              data-testid=\"button-submit-chapter\"\n            >\n              {isUploading ? (\n                <>\n                  <Loader2 className=\"w-5 h-5 animate-spin ml-2\" />\n                  جاري الإرسال...\n                </>\n              ) : (\n                <>\n                  <UploadIcon className=\"w-5 h-5 ml-2\" />\n                  إرسال للمعالجة\n                </>\n              )}\n            </Button>\n          </div>\n\n          <div className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"font-arabic text-lg flex items-center gap-2\">\n                  <Lightbulb className=\"w-5 h-5 text-amber-500\" />\n                  نصائح للتصوير\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {tips.map((tip, index) => (\n                  <div key={index} className=\"flex items-start gap-3\">\n                    <div className=\"w-8 h-8 rounded-lg bg-amber-100 flex items-center justify-center shrink-0\">\n                      <tip.icon className=\"w-4 h-4 text-amber-600\" />\n                    </div>\n                    <p className=\"text-sm font-arabic text-muted-foreground\">{tip.text}</p>\n                  </div>\n                ))}\n              </CardContent>\n            </Card>\n\n            <Card className=\"bg-gradient-to-br from-blue-500 to-emerald-500 text-white border-0\">\n              <CardContent className=\"py-6\">\n                <BookOpen className=\"w-10 h-10 mb-3\" />\n                <h3 className=\"font-bold font-arabic mb-2\">كيف يعمل؟</h3>\n                <ol className=\"text-sm space-y-2 font-arabic opacity-90\">\n                  <li>1. ارفع صور صفحات الكتاب</li>\n                  <li>2. الذكاء الاصطناعي يحلل المحتوى</li>\n                  <li>3. يُنشئ شرح مبسط وأسئلة</li>\n                  <li>4. طفلك يتعلم ويختبر فهمه</li>\n                </ol>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":16107,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/pages/chapter.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useParams, Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { \n  ArrowRight, \n  BookOpen, \n  Play, \n  Share2, \n  Trash2,\n  Star,\n  CheckCircle,\n  Clock,\n  GraduationCap\n} from \"lucide-react\";\nimport type { Chapter, ChapterResult } from \"@shared/schema\";\n\nconst subjectLabels: Record<string, string> = {\n  math: \"الرياضيات\",\n  science: \"العلوم\",\n  arabic: \"اللغة العربية\",\n  english: \"اللغة الإنجليزية\",\n  islamic: \"التربية الإسلامية\",\n  social: \"الدراسات الاجتماعية\",\n};\n\nconst statusConfig: Record<string, { label: string; color: string; icon: any }> = {\n  processing: { label: \"قيد المعالجة\", color: \"bg-amber-100 text-amber-700\", icon: Clock },\n  ready: { label: \"جاهز للبدء\", color: \"bg-blue-100 text-blue-700\", icon: Play },\n  completed: { label: \"مكتمل\", color: \"bg-green-100 text-green-700\", icon: CheckCircle },\n};\n\nexport default function ChapterPage() {\n  const { id } = useParams<{ id: string }>();\n  const [, setLocation] = useLocation();\n\n  const { data: chapter, isLoading } = useQuery<Chapter>({\n    queryKey: [\"/api/chapters\", id],\n    enabled: !!id,\n  });\n\n  const { data: result } = useQuery<ChapterResult>({\n    queryKey: [\"/api/chapters\", id, \"result\"],\n    enabled: !!id && chapter?.status === \"completed\",\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\" dir=\"rtl\">\n        <header className=\"bg-white border-b sticky top-0 z-50\">\n          <div className=\"max-w-4xl mx-auto px-4 h-16 flex items-center\">\n            <Skeleton className=\"w-10 h-10 rounded-lg\" />\n            <div className=\"mr-3 space-y-1\">\n              <Skeleton className=\"h-5 w-32\" />\n              <Skeleton className=\"h-3 w-24\" />\n            </div>\n          </div>\n        </header>\n        <main className=\"max-w-4xl mx-auto px-4 py-8\">\n          <Skeleton className=\"h-64 w-full rounded-xl\" />\n        </main>\n      </div>\n    );\n  }\n\n  if (!chapter) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\" dir=\"rtl\">\n        <Card className=\"text-center p-8\">\n          <BookOpen className=\"w-16 h-16 mx-auto text-muted-foreground mb-4\" />\n          <h2 className=\"text-xl font-bold font-arabic mb-2\">الفصل غير موجود</h2>\n          <p className=\"text-muted-foreground font-arabic mb-4\">لم نتمكن من العثور على هذا الفصل</p>\n          <Link href=\"/\">\n            <Button className=\"font-arabic\">العودة للرئيسية</Button>\n          </Link>\n        </Card>\n      </div>\n    );\n  }\n\n  const status = statusConfig[chapter.status || \"processing\"];\n  const StatusIcon = status.icon;\n  const content = chapter.content;\n\n  const handleShare = () => {\n    const childUrl = `${window.location.origin}/child/chapter/${id}/learn`;\n    navigator.clipboard.writeText(childUrl);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\" dir=\"rtl\">\n      <header className=\"bg-white border-b sticky top-0 z-50\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16 gap-4\">\n            <div className=\"flex items-center gap-3\">\n              <Link href=\"/\">\n                <Button variant=\"ghost\" size=\"icon\">\n                  <ArrowRight className=\"w-5 h-5\" />\n                </Button>\n              </Link>\n              <div className=\"w-10 h-10 bg-gradient-to-br from-blue-500 to-emerald-500 rounded-xl flex items-center justify-center\">\n                <BookOpen className=\"w-5 h-5 text-white\" />\n              </div>\n              <div>\n                <h1 className=\"font-bold font-arabic line-clamp-1\">{chapter.title}</h1>\n                <p className=\"text-xs text-muted-foreground font-arabic\">\n                  {subjectLabels[chapter.subject]} - الصف {chapter.grade}\n                </p>\n              </div>\n            </div>\n            <Badge className={status.color}>\n              <StatusIcon className=\"w-3 h-3 ml-1\" />\n              {status.label}\n            </Badge>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {chapter.status === \"ready\" && (\n          <Card className=\"mb-6 bg-gradient-to-br from-blue-500 to-emerald-500 text-white border-0 overflow-hidden\">\n            <CardContent className=\"py-8 relative\">\n              <div className=\"absolute left-0 top-0 w-32 h-32 bg-white/10 rounded-full -translate-x-1/2 -translate-y-1/2\" />\n              <div className=\"relative z-10\">\n                <GraduationCap className=\"w-12 h-12 mb-4\" />\n                <h2 className=\"text-2xl font-bold font-arabic mb-2\">الفصل جاهز!</h2>\n                <p className=\"font-arabic opacity-90 mb-6\">\n                  شارك الرابط مع طفلك ليبدأ التعلم\n                </p>\n                <div className=\"flex flex-wrap gap-3\">\n                  <Link href={`/child/chapter/${id}/learn`}>\n                    <Button size=\"lg\" variant=\"secondary\" className=\"font-arabic gap-2\" data-testid=\"button-start-learning\">\n                      <Play className=\"w-5 h-5\" />\n                      ابدأ التعلم\n                    </Button>\n                  </Link>\n                  <Button \n                    size=\"lg\" \n                    variant=\"outline\" \n                    className=\"font-arabic gap-2 bg-white/10 border-white/30 hover:bg-white/20\"\n                    onClick={handleShare}\n                    data-testid=\"button-share\"\n                  >\n                    <Share2 className=\"w-5 h-5\" />\n                    نسخ الرابط\n                  </Button>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {chapter.status === \"completed\" && result && (\n          <Card className=\"mb-6\">\n            <CardHeader>\n              <CardTitle className=\"font-arabic flex items-center gap-2\">\n                <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                تم إكمال الفصل\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex items-center gap-6 mb-4\">\n                <div className=\"text-center\">\n                  <div className=\"flex items-center justify-center mb-1\">\n                    {Array.from({ length: 5 }).map((_, i) => (\n                      <Star \n                        key={i} \n                        className={`w-6 h-6 ${i < (result.stars || 0) ? \"text-amber-400 fill-amber-400\" : \"text-gray-200\"}`}\n                      />\n                    ))}\n                  </div>\n                  <p className=\"text-sm text-muted-foreground font-arabic\">{result.stars} نجوم</p>\n                </div>\n                <div className=\"text-center\">\n                  <p className=\"text-3xl font-bold\">{result.totalScore}/15</p>\n                  <p className=\"text-sm text-muted-foreground font-arabic\">النتيجة الإجمالية</p>\n                </div>\n              </div>\n              <Link href={`/report/${result.id}`}>\n                <Button className=\"w-full font-arabic\" data-testid=\"button-view-report\">\n                  عرض التقرير المفصل\n                </Button>\n              </Link>\n            </CardContent>\n          </Card>\n        )}\n\n        {content && (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"font-arabic\">محتوى الفصل</CardTitle>\n              <CardDescription className=\"font-arabic\">{content.topic}</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div>\n                <h3 className=\"font-bold font-arabic mb-3 flex items-center gap-2\">\n                  <BookOpen className=\"w-5 h-5 text-blue-600\" />\n                  الشرح\n                </h3>\n                <div className=\"space-y-3 text-muted-foreground font-arabic leading-relaxed\">\n                  {content.explanation.paragraphs.map((p, i) => (\n                    <p key={i}>{p}</p>\n                  ))}\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4 pt-4 border-t\">\n                <div className=\"text-center p-4 bg-blue-50 rounded-xl\">\n                  <p className=\"text-3xl font-bold text-blue-600\">{content.practice.length}</p>\n                  <p className=\"text-sm font-arabic text-blue-700\">أسئلة تمرين</p>\n                </div>\n                <div className=\"text-center p-4 bg-emerald-50 rounded-xl\">\n                  <p className=\"text-3xl font-bold text-emerald-600\">{content.test.length}</p>\n                  <p className=\"text-sm font-arabic text-emerald-700\">أسئلة اختبار</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":9250,"size_tokens":null},"client/src/pages/dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { \n  Plus, \n  Upload, \n  Star, \n  Flame, \n  BookOpen, \n  TrendingUp, \n  Users, \n  LogOut,\n  ChevronLeft,\n  Clock,\n  BarChart3,\n  Trophy,\n  Bell,\n  Library\n} from \"lucide-react\";\nimport type { Child, Chapter } from \"@shared/schema\";\n\nconst avatarColors = [\n  \"bg-child-coral\",\n  \"bg-child-turquoise\", \n  \"bg-child-yellow\",\n  \"bg-child-green\",\n  \"bg-child-blue\",\n  \"bg-child-purple\",\n];\n\nfunction ChildCard({ child, chapters }: { child: Child; chapters: Chapter[] }) {\n  const childChapters = chapters.filter(c => c.childId === child.id);\n  const completedChapters = childChapters.filter(c => c.status === \"completed\").length;\n  const colorIndex = child.name.charCodeAt(0) % avatarColors.length;\n\n  return (\n    <Card className=\"group hover:shadow-lg transition-all duration-300\" data-testid={`card-child-${child.id}`}>\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-start gap-4\">\n          <Avatar className=\"w-16 h-16 border-2 border-white shadow-md\">\n            <AvatarFallback className={`${avatarColors[colorIndex]} text-white text-xl font-bold`}>\n              {child.name.charAt(0)}\n            </AvatarFallback>\n          </Avatar>\n          <div className=\"flex-1 min-w-0\">\n            <h3 className=\"font-bold text-lg font-arabic truncate\" data-testid={`text-child-name-${child.id}`}>\n              {child.name}\n            </h3>\n            <p className=\"text-muted-foreground text-sm font-arabic\">\n              {child.age} سنوات\n            </p>\n            <div className=\"flex items-center gap-4 mt-3\">\n              <div className=\"flex items-center gap-1.5 text-amber-500\">\n                <Star className=\"w-4 h-4 fill-current\" />\n                <span className=\"font-semibold text-sm\">{child.totalStars || 0}</span>\n              </div>\n              <div className=\"flex items-center gap-1.5 text-orange-500\">\n                <Flame className=\"w-4 h-4\" />\n                <span className=\"font-semibold text-sm\">{child.streak || 0}</span>\n              </div>\n              <div className=\"flex items-center gap-1.5 text-blue-500\">\n                <BookOpen className=\"w-4 h-4\" />\n                <span className=\"font-semibold text-sm\">{completedChapters}</span>\n              </div>\n            </div>\n          </div>\n          <Link href={`/child/${child.id}/lessons`}>\n            <Button variant=\"ghost\" size=\"icon\" className=\"opacity-0 group-hover:opacity-100 transition-opacity\">\n              <ChevronLeft className=\"w-5 h-5\" />\n            </Button>\n          </Link>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction AddChildDialog({ onAdd }: { onAdd: () => void }) {\n  const [open, setOpen] = useState(false);\n  const [name, setName] = useState(\"\");\n  const [age, setAge] = useState(\"\");\n  const { toast } = useToast();\n  const parentId = localStorage.getItem(\"userId\");\n\n  const addChildMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", \"/api/children\", {\n        parentId,\n        name,\n        age: parseInt(age),\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/children\"] });\n      toast({ title: \"تمت الإضافة!\", description: `تم إضافة ${name} بنجاح` });\n      setName(\"\");\n      setAge(\"\");\n      setOpen(false);\n      onAdd();\n    },\n    onError: () => {\n      toast({ title: \"خطأ\", description: \"حدث خطأ أثناء إضافة الطفل\", variant: \"destructive\" });\n    },\n  });\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Card className=\"border-dashed border-2 cursor-pointer hover:border-primary hover:bg-muted/50 transition-all duration-300\" data-testid=\"button-add-child\">\n          <CardContent className=\"p-6 flex flex-col items-center justify-center min-h-[140px] gap-2\">\n            <div className=\"w-12 h-12 rounded-full bg-muted flex items-center justify-center\">\n              <Plus className=\"w-6 h-6 text-muted-foreground\" />\n            </div>\n            <span className=\"font-arabic text-muted-foreground\">إضافة طفل</span>\n          </CardContent>\n        </Card>\n      </DialogTrigger>\n      <DialogContent dir=\"rtl\">\n        <DialogHeader>\n          <DialogTitle className=\"font-arabic text-right\">إضافة طفل جديد</DialogTitle>\n        </DialogHeader>\n        <div className=\"space-y-4 pt-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"name\" className=\"font-arabic\">اسم الطفل</Label>\n            <Input \n              id=\"name\" \n              value={name} \n              onChange={(e) => setName(e.target.value)}\n              placeholder=\"أدخل اسم الطفل\"\n              data-testid=\"input-child-name\"\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"age\" className=\"font-arabic\">العمر</Label>\n            <Input \n              id=\"age\" \n              type=\"number\" \n              min=\"6\" \n              max=\"12\"\n              value={age} \n              onChange={(e) => setAge(e.target.value)}\n              placeholder=\"العمر (6-12)\"\n              data-testid=\"input-child-age\"\n            />\n          </div>\n          <Button \n            className=\"w-full font-arabic\" \n            onClick={() => addChildMutation.mutate()}\n            disabled={!name || !age || addChildMutation.isPending}\n            data-testid=\"button-confirm-add-child\"\n          >\n            {addChildMutation.isPending ? \"جاري الإضافة...\" : \"إضافة\"}\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction StatsCard({ icon: Icon, label, value, color }: { icon: any; label: string; value: number; color: string }) {\n  return (\n    <Card>\n      <CardContent className=\"p-4 flex items-center gap-4\">\n        <div className={`w-12 h-12 rounded-xl ${color} flex items-center justify-center`}>\n          <Icon className=\"w-6 h-6 text-white\" />\n        </div>\n        <div>\n          <p className=\"text-2xl font-bold\">{value}</p>\n          <p className=\"text-sm text-muted-foreground font-arabic\">{label}</p>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction RecentActivity({ chapters }: { chapters: Chapter[] }) {\n  const recentChapters = chapters.slice(0, 5);\n\n  if (recentChapters.length === 0) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"font-arabic text-lg\">النشاط الأخير</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"text-center py-8 text-muted-foreground\">\n            <Clock className=\"w-12 h-12 mx-auto mb-3 opacity-30\" />\n            <p className=\"font-arabic\">لا يوجد نشاط حتى الآن</p>\n            <p className=\"font-arabic text-sm mt-1\">ابدأ بإضافة فصل جديد</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const statusLabels: Record<string, { text: string; color: string }> = {\n    processing: { text: \"قيد المعالجة\", color: \"bg-amber-100 text-amber-700\" },\n    ready: { text: \"جاهز\", color: \"bg-blue-100 text-blue-700\" },\n    completed: { text: \"مكتمل\", color: \"bg-green-100 text-green-700\" },\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"font-arabic text-lg\">النشاط الأخير</CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-3\">\n        {recentChapters.map((chapter) => (\n          <Link key={chapter.id} href={`/chapter/${chapter.id}`}>\n            <div className=\"flex items-center gap-3 p-3 rounded-lg hover:bg-muted transition-colors cursor-pointer\" data-testid={`activity-chapter-${chapter.id}`}>\n              <div className=\"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-emerald-500 flex items-center justify-center\">\n                <BookOpen className=\"w-5 h-5 text-white\" />\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"font-semibold font-arabic truncate\">{chapter.title}</p>\n                <p className=\"text-sm text-muted-foreground font-arabic\">{chapter.subject}</p>\n              </div>\n              <span className={`text-xs px-2 py-1 rounded-full font-arabic ${statusLabels[chapter.status || \"processing\"].color}`}>\n                {statusLabels[chapter.status || \"processing\"].text}\n              </span>\n            </div>\n          </Link>\n        ))}\n      </CardContent>\n    </Card>\n  );\n}\n\nexport default function Dashboard() {\n  const [, setLocation] = useLocation();\n  const parentId = localStorage.getItem(\"userId\");\n  const userName = localStorage.getItem(\"userName\");\n\n  const { data: children, isLoading: loadingChildren } = useQuery<Child[]>({\n    queryKey: [\"/api/children\", parentId],\n    enabled: !!parentId,\n  });\n\n  const { data: chapters, isLoading: loadingChapters } = useQuery<Chapter[]>({\n    queryKey: [\"/api/chapters\", parentId],\n    enabled: !!parentId,\n  });\n\n  const { data: unreadCount } = useQuery<{ count: number }>({\n    queryKey: [`/api/users/${parentId}/notifications/unread-count`],\n    enabled: !!parentId,\n  });\n\n  const handleLogout = () => {\n    localStorage.removeItem(\"userId\");\n    localStorage.removeItem(\"userName\");\n    setLocation(\"/auth\");\n  };\n\n  if (!parentId) {\n    setLocation(\"/auth\");\n    return null;\n  }\n\n  const totalStars = children?.reduce((sum, child) => sum + (child.totalStars || 0), 0) || 0;\n  const totalChapters = chapters?.length || 0;\n  const completedChapters = chapters?.filter(c => c.status === \"completed\").length || 0;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\" dir=\"rtl\">\n      <header className=\"bg-white border-b sticky top-0 z-50\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16 gap-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 bg-gradient-to-br from-blue-500 to-emerald-500 rounded-xl flex items-center justify-center\">\n                <BookOpen className=\"w-5 h-5 text-white\" />\n              </div>\n              <div>\n                <h1 className=\"font-bold font-arabic text-lg\">ليرن سناب</h1>\n                <p className=\"text-xs text-muted-foreground font-arabic\">مرحباً، {userName}</p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <Link href=\"/upload\">\n                <Button className=\"font-arabic gap-2\" data-testid=\"button-upload-chapter\">\n                  <Upload className=\"w-4 h-4\" />\n                  إضافة فصل\n                </Button>\n              </Link>\n              <Link href=\"/leaderboard\">\n                <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-leaderboard\">\n                  <Trophy className=\"w-5 h-5\" />\n                </Button>\n              </Link>\n              <Link href=\"/analytics\">\n                <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-analytics\">\n                  <BarChart3 className=\"w-5 h-5\" />\n                </Button>\n              </Link>\n              <Link href=\"/content-library\">\n                <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-content-library\">\n                  <Library className=\"w-5 h-5\" />\n                </Button>\n              </Link>\n              <Link href=\"/notifications\">\n                <Button variant=\"ghost\" size=\"icon\" className=\"relative\" data-testid=\"button-notifications\">\n                  <Bell className=\"w-5 h-5\" />\n                  {(unreadCount?.count || 0) > 0 && (\n                    <span className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold\">\n                      {unreadCount?.count}\n                    </span>\n                  )}\n                </Button>\n              </Link>\n              <Button variant=\"ghost\" size=\"icon\" onClick={handleLogout} data-testid=\"button-logout\">\n                <LogOut className=\"w-5 h-5\" />\n              </Button>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8\">\n          <StatsCard icon={Star} label=\"إجمالي النجوم\" value={totalStars} color=\"bg-amber-500\" />\n          <StatsCard icon={BookOpen} label=\"الفصول المكتملة\" value={completedChapters} color=\"bg-emerald-500\" />\n          <StatsCard icon={Users} label=\"عدد الأطفال\" value={children?.length || 0} color=\"bg-blue-500\" />\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n          <div className=\"lg:col-span-2\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-xl font-bold font-arabic\">أطفالي</h2>\n            </div>\n            {loadingChildren ? (\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                {[1, 2].map((i) => (\n                  <Card key={i}>\n                    <CardContent className=\"p-6\">\n                      <div className=\"flex items-start gap-4\">\n                        <Skeleton className=\"w-16 h-16 rounded-full\" />\n                        <div className=\"flex-1 space-y-2\">\n                          <Skeleton className=\"h-5 w-24\" />\n                          <Skeleton className=\"h-4 w-16\" />\n                          <Skeleton className=\"h-4 w-32\" />\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : (\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                {children?.map((child) => (\n                  <ChildCard key={child.id} child={child} chapters={chapters || []} />\n                ))}\n                <AddChildDialog onAdd={() => {}} />\n              </div>\n            )}\n          </div>\n\n          <div>\n            {loadingChapters ? (\n              <Card>\n                <CardHeader>\n                  <Skeleton className=\"h-6 w-32\" />\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  {[1, 2, 3].map((i) => (\n                    <div key={i} className=\"flex items-center gap-3\">\n                      <Skeleton className=\"w-10 h-10 rounded-lg\" />\n                      <div className=\"flex-1 space-y-1\">\n                        <Skeleton className=\"h-4 w-24\" />\n                        <Skeleton className=\"h-3 w-16\" />\n                      </div>\n                    </div>\n                  ))}\n                </CardContent>\n              </Card>\n            ) : (\n              <RecentActivity chapters={chapters || []} />\n            )}\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":15604,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\nimport { runMigrations } from 'stripe-replit-sync';\nimport { getStripeSync } from './stripeClient';\nimport { WebhookHandlers } from './webhookHandlers';\nimport { storage } from './storage';\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\nasync function initStripe() {\n  const databaseUrl = process.env.DATABASE_URL;\n\n  if (!databaseUrl) {\n    console.log('DATABASE_URL not set, skipping Stripe initialization');\n    return;\n  }\n\n  try {\n    console.log('Initializing Stripe schema...');\n    await runMigrations({ databaseUrl });\n    console.log('Stripe schema ready');\n\n    const stripeSync = await getStripeSync();\n\n    console.log('Setting up managed webhook...');\n    const webhookBaseUrl = `https://${process.env.REPLIT_DOMAINS?.split(',')[0]}`;\n    try {\n      const result = await stripeSync.findOrCreateManagedWebhook(\n        `${webhookBaseUrl}/api/stripe/webhook`);\n      if (result?.webhook?.url) {\n        console.log(`Webhook configured: ${result.webhook.url}`);\n      } else {\n        console.log('Webhook setup skipped (no URL returned)');\n      }\n    } catch (webhookError) {\n      console.log('Webhook setup failed, will retry on next restart');\n    }\n\n    console.log('Syncing Stripe data...');\n    stripeSync.syncBackfill()\n      .then(() => {\n        console.log('Stripe data synced');\n      })\n      .catch((err: any) => {\n        console.error('Error syncing Stripe data:', err);\n      });\n  } catch (error) {\n    console.error('Failed to initialize Stripe:', error);\n  }\n}\n\nawait initStripe();\n\n// Seed badges on startup\ntry {\n  await storage.seedBadges();\n  console.log('Badges seeded successfully');\n} catch (error) {\n  console.error('Failed to seed badges:', error);\n}\n\n// Seed sample chapters on startup\ntry {\n  await storage.seedSampleChapters();\n} catch (error) {\n  console.error('Failed to seed sample chapters:', error);\n}\n\napp.post(\n  '/api/stripe/webhook',\n  express.raw({ type: 'application/json' }),\n  async (req, res) => {\n    const signature = req.headers['stripe-signature'];\n\n    if (!signature) {\n      return res.status(400).json({ error: 'Missing stripe-signature' });\n    }\n\n    try {\n      const sig = Array.isArray(signature) ? signature[0] : signature;\n\n      if (!Buffer.isBuffer(req.body)) {\n        console.error('STRIPE WEBHOOK ERROR: req.body is not a Buffer');\n        return res.status(500).json({ error: 'Webhook processing error' });\n      }\n\n      await WebhookHandlers.processWebhook(req.body as Buffer, sig);\n\n      res.status(200).json({ received: true });\n    } catch (error: any) {\n      console.error('Webhook error:', error.message);\n      res.status(400).json({ error: 'Webhook processing error' });\n    }\n  }\n);\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":5189,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"pg\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1417,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/pages/test-stage.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useParams, useLocation, Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { ArrowRight, ArrowLeft, ClipboardCheck, Send, Loader2 } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { Chapter } from \"@shared/schema\";\n\nexport default function TestStage() {\n  const { id } = useParams<{ id: string }>();\n  const [, setLocation] = useLocation();\n  const [currentQuestion, setCurrentQuestion] = useState(0);\n  const [selectedAnswer, setSelectedAnswer] = useState<string | null>(null);\n  const [answers, setAnswers] = useState<string[]>([]);\n\n  const { data: chapter } = useQuery<Chapter>({\n    queryKey: [\"/api/chapters\", id],\n    enabled: !!id,\n  });\n\n  const submitMutation = useMutation({\n    mutationFn: async () => {\n      const practiceAnswers = JSON.parse(localStorage.getItem(`practice_answers_${id}`) || \"[]\");\n      const res = await apiRequest(\"POST\", `/api/chapters/${id}/submit`, {\n        practiceAnswers,\n        testAnswers: answers,\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      localStorage.removeItem(`practice_answers_${id}`);\n      setLocation(`/child/chapter/${id}/results`);\n    },\n  });\n\n  const questions = chapter?.content?.test || [];\n  const question = questions[currentQuestion];\n  const progress = questions.length > 0 ? ((currentQuestion + 1) / questions.length) * 100 : 0;\n\n  const handleAnswer = (answer: string) => {\n    setSelectedAnswer(answer);\n  };\n\n  const handleNext = () => {\n    if (!selectedAnswer) return;\n\n    const newAnswers = [...answers, selectedAnswer];\n    setAnswers(newAnswers);\n    setSelectedAnswer(null);\n\n    if (currentQuestion < questions.length - 1) {\n      setCurrentQuestion(prev => prev + 1);\n    } else {\n      submitMutation.mutate();\n    }\n  };\n\n  if (!chapter || !question) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-purple-50 via-white to-pink-50 flex items-center justify-center\" dir=\"rtl\">\n        <p className=\"font-arabic text-gray-500\">جاري التحميل...</p>\n      </div>\n    );\n  }\n\n  const answerLabels = [\"أ\", \"ب\", \"ج\", \"د\"];\n  const answerKeys = [\"A\", \"B\", \"C\", \"D\"];\n  const isLastQuestion = currentQuestion === questions.length - 1;\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-purple-50 via-white to-pink-50 flex flex-col\" dir=\"rtl\">\n      <header className=\"bg-white/80 backdrop-blur-sm border-b sticky top-0 z-40\">\n        <div className=\"max-w-2xl mx-auto px-4\">\n          <div className=\"flex items-center h-16 gap-4\">\n            <Link href={`/child/chapter/${id}/practice`}>\n              <Button variant=\"ghost\" size=\"icon\" className=\"rounded-xl\">\n                <ArrowRight className=\"w-6 h-6\" />\n              </Button>\n            </Link>\n            <div className=\"flex-1\">\n              <h1 className=\"font-child font-bold text-lg\">الاختبار</h1>\n              <p className=\"text-xs text-muted-foreground font-arabic\">\n                السؤال {currentQuestion + 1} من {questions.length}\n              </p>\n            </div>\n            <div className=\"flex items-center gap-2 bg-purple-100 px-3 py-1.5 rounded-full\">\n              <ClipboardCheck className=\"w-4 h-4 text-purple-600\" />\n              <span className=\"text-sm font-child font-bold text-purple-700\">اختبار</span>\n            </div>\n          </div>\n          <Progress value={progress} className=\"h-2 mb-2\" />\n        </div>\n      </header>\n\n      <main className=\"flex-1 flex flex-col max-w-2xl mx-auto w-full px-4 py-8\">\n        <Card className=\"mb-6 shadow-lg border-0 bg-white/90 backdrop-blur-sm\">\n          <CardContent className=\"p-8\">\n            <p \n              className=\"text-2xl font-arabic leading-relaxed text-gray-800 text-center\"\n              data-testid=\"text-question\"\n            >\n              {question.question}\n            </p>\n          </CardContent>\n        </Card>\n\n        <div className=\"space-y-3 flex-1\">\n          {question.options.map((option, index) => (\n            <Button\n              key={index}\n              variant=\"outline\"\n              className={`w-full h-16 text-lg font-arabic justify-start px-6 rounded-xl transition-all ${\n                selectedAnswer === answerKeys[index]\n                  ? \"border-2 border-purple-500 bg-purple-50\"\n                  : \"hover:bg-gray-50\"\n              }`}\n              onClick={() => handleAnswer(answerKeys[index])}\n              data-testid={`button-answer-${index}`}\n            >\n              <span className={`w-10 h-10 rounded-lg ml-4 flex items-center justify-center font-child font-bold ${\n                selectedAnswer === answerKeys[index]\n                  ? \"bg-purple-500 text-white\"\n                  : \"bg-gray-100 text-gray-600\"\n              }`}>\n                {answerLabels[index]}\n              </span>\n              {option}\n            </Button>\n          ))}\n        </div>\n\n        <Button\n          size=\"lg\"\n          onClick={handleNext}\n          disabled={!selectedAnswer || submitMutation.isPending}\n          className={`h-16 mt-6 font-child font-bold text-xl rounded-xl ${\n            isLastQuestion \n              ? \"bg-gradient-to-r from-child-coral to-child-purple\"\n              : \"bg-gradient-to-r from-purple-500 to-purple-600\"\n          }`}\n          data-testid=\"button-next\"\n        >\n          {submitMutation.isPending ? (\n            <>\n              <Loader2 className=\"w-6 h-6 ml-2 animate-spin\" />\n              جاري الإرسال...\n            </>\n          ) : isLastQuestion ? (\n            <>\n              <Send className=\"w-6 h-6 ml-2\" />\n              إنهاء الاختبار\n            </>\n          ) : (\n            <>\n              التالي\n              <ArrowLeft className=\"w-6 h-6 mr-2\" />\n            </>\n          )}\n        </Button>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":6083,"size_tokens":null},"client/src/pages/results.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useParams, Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Star, Trophy, Home, RefreshCw } from \"lucide-react\";\nimport type { ChapterResult, Chapter } from \"@shared/schema\";\n\nfunction ConfettiPiece({ delay }: { delay: number }) {\n  const colors = [\"bg-child-coral\", \"bg-child-turquoise\", \"bg-child-yellow\", \"bg-child-green\", \"bg-child-purple\", \"bg-amber-400\"];\n  const color = colors[Math.floor(Math.random() * colors.length)];\n  const left = Math.random() * 100;\n  const size = Math.random() * 8 + 4;\n  \n  return (\n    <div \n      className={`absolute rounded-sm ${color} animate-confetti-fall`}\n      style={{ \n        left: `${left}%`, \n        animationDelay: `${delay}ms`,\n        animationDuration: `${3 + Math.random() * 2}s`,\n        top: \"-20px\",\n        width: `${size}px`,\n        height: `${size}px`,\n      }}\n    />\n  );\n}\n\nfunction AnimatedStar({ index, filled }: { index: number; filled: boolean }) {\n  const [show, setShow] = useState(false);\n\n  useEffect(() => {\n    const timer = setTimeout(() => setShow(true), index * 200);\n    return () => clearTimeout(timer);\n  }, [index]);\n\n  if (!show) return <Star className=\"w-12 h-12 text-gray-200\" />;\n\n  return (\n    <Star \n      className={`w-12 h-12 ${filled ? \"text-amber-400 fill-amber-400 animate-star-pop\" : \"text-gray-200\"}`}\n    />\n  );\n}\n\nexport default function ResultsPage() {\n  const { id } = useParams<{ id: string }>();\n\n  const { data: chapter } = useQuery<Chapter>({\n    queryKey: [\"/api/chapters\", id],\n    enabled: !!id,\n  });\n\n  const { data: result } = useQuery<ChapterResult>({\n    queryKey: [\"/api/chapters\", id, \"result\"],\n    enabled: !!id,\n  });\n\n  const stars = result?.stars || 0;\n  const totalScore = result?.totalScore || 0;\n  const practiceScore = result?.practiceScore || 0;\n  const testScore = result?.testScore || 0;\n\n  const messages = [\n    { min: 90, text: \"مذهل! أنت نجم لامع!\", icon: \"trophy\" },\n    { min: 80, text: \"رائع جداً! استمر!\", icon: \"star\" },\n    { min: 70, text: \"أحسنت! عمل جيد!\", icon: \"thumbsup\" },\n    { min: 60, text: \"جيد! يمكنك التحسن!\", icon: \"smile\" },\n    { min: 0, text: \"لا بأس! حاول مرة أخرى!\", icon: \"heart\" },\n  ];\n\n  const percentage = Math.round((totalScore / 15) * 100);\n  const message = messages.find(m => percentage >= m.min) || messages[messages.length - 1];\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-purple-100 via-pink-50 to-amber-100 flex flex-col relative overflow-hidden\" dir=\"rtl\">\n      <div className=\"absolute inset-0 pointer-events-none\">\n        {Array.from({ length: 50 }).map((_, i) => (\n          <ConfettiPiece key={i} delay={i * 100} />\n        ))}\n      </div>\n\n      <main className=\"flex-1 flex flex-col items-center justify-center px-4 py-12 relative z-10\">\n        <div className=\"w-28 h-28 bg-gradient-to-br from-amber-400 to-orange-500 rounded-full flex items-center justify-center mb-6 shadow-2xl animate-bounce-gentle\">\n          <Trophy className=\"w-16 h-16 text-white\" />\n        </div>\n\n        <h1 className=\"text-4xl font-child font-bold text-gray-800 mb-2 text-center\" data-testid=\"text-congrats\">\n          أحسنت!\n        </h1>\n        <p className=\"text-xl font-arabic text-gray-600 mb-8 text-center\">\n          {message.text}\n        </p>\n\n        <div className=\"flex items-center justify-center gap-2 mb-8\">\n          {Array.from({ length: 5 }).map((_, i) => (\n            <AnimatedStar key={i} index={i} filled={i < stars} />\n          ))}\n        </div>\n\n        <Card className=\"w-full max-w-sm mb-8 shadow-xl border-0 bg-white/90 backdrop-blur-sm\">\n          <CardContent className=\"p-6\">\n            <div className=\"text-center mb-4\">\n              <p className=\"text-5xl font-child font-bold text-gray-800\" data-testid=\"text-score\">\n                {totalScore}/15\n              </p>\n              <p className=\"text-lg font-arabic text-gray-500\">النتيجة الإجمالية</p>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4 pt-4 border-t\">\n              <div className=\"text-center\">\n                <p className=\"text-2xl font-child font-bold text-green-600\">{practiceScore}/5</p>\n                <p className=\"text-sm font-arabic text-gray-500\">التمرين</p>\n              </div>\n              <div className=\"text-center\">\n                <p className=\"text-2xl font-child font-bold text-purple-600\">{testScore}/10</p>\n                <p className=\"text-sm font-arabic text-gray-500\">الاختبار</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"w-full max-w-sm mb-8 bg-gradient-to-r from-blue-500 to-purple-500 text-white border-0 shadow-lg\">\n          <CardContent className=\"p-4 text-center\">\n            <p className=\"font-arabic text-lg\">\n              والديك سيرون نتيجتك! استمر في التعلم\n            </p>\n          </CardContent>\n        </Card>\n\n        <div className=\"flex flex-col sm:flex-row gap-4 w-full max-w-sm\">\n          <Link href={`/child/chapter/${id}/learn`} className=\"flex-1\">\n            <Button \n              variant=\"outline\" \n              size=\"lg\" \n              className=\"w-full h-14 font-child font-bold rounded-xl gap-2\"\n              data-testid=\"button-retry\"\n            >\n              <RefreshCw className=\"w-5 h-5\" />\n              إعادة المحاولة\n            </Button>\n          </Link>\n          <Link href=\"/\" className=\"flex-1\">\n            <Button \n              size=\"lg\" \n              className=\"w-full h-14 font-child font-bold rounded-xl gap-2 bg-gradient-to-r from-child-coral to-child-purple\"\n              data-testid=\"button-home\"\n            >\n              <Home className=\"w-5 h-5\" />\n              الرئيسية\n            </Button>\n          </Link>\n        </div>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":6078,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"server/storage.ts":{"content":"import { db } from \"./db\";\nimport { eq, and, desc, sql, gte } from \"drizzle-orm\";\nimport {\n  users,\n  children,\n  chapters,\n  chapterResults,\n  chapterPhotos,\n  learningSessions,\n  badges,\n  childBadges,\n  notifications,\n  sampleChapters,\n  badgeDefinitions,\n  sampleChapterDefinitions,\n  type User,\n  type InsertUser,\n  type Child,\n  type InsertChild,\n  type Chapter,\n  type InsertChapter,\n  type ChapterResult,\n  type InsertChapterResult,\n  type ChapterPhoto,\n  type InsertChapterPhoto,\n  type ChapterContent,\n  type LearningSession,\n  type InsertLearningSession,\n  type Badge,\n  type InsertBadge,\n  type ChildBadge,\n  type InsertChildBadge,\n  type Notification,\n  type InsertNotification,\n  type NotificationPreferences,\n  type SampleChapter,\n  type InsertSampleChapter,\n} from \"@shared/schema\";\n\nexport interface IStorage {\n  // Users\n  createUser(data: InsertUser): Promise<User>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  getUserById(id: string): Promise<User | undefined>;\n\n  // Children\n  createChild(data: InsertChild): Promise<Child>;\n  getChildrenByParent(parentId: string): Promise<Child[]>;\n  getChildById(id: string): Promise<Child | undefined>;\n  updateChildStars(id: string, stars: number): Promise<void>;\n  updateChildStreak(id: string, streak: number): Promise<void>;\n\n  // Chapters\n  createChapter(data: InsertChapter): Promise<Chapter>;\n  getChapterById(id: string): Promise<Chapter | undefined>;\n  getChaptersByParent(parentId: string): Promise<Chapter[]>;\n  getChaptersByChild(childId: string): Promise<Chapter[]>;\n  updateChapterStatus(id: string, status: string): Promise<void>;\n  updateChapterContent(id: string, content: ChapterContent): Promise<void>;\n\n  // Chapter Photos\n  createChapterPhotos(chapterId: string, photos: { photoData: string; pageNumber: number }[]): Promise<ChapterPhoto[]>;\n  getPhotosByChapter(chapterId: string): Promise<ChapterPhoto[]>;\n\n  // Chapter Results\n  createChapterResult(data: InsertChapterResult): Promise<ChapterResult>;\n  getResultByChapter(chapterId: string): Promise<ChapterResult | undefined>;\n  getResultById(id: string): Promise<ChapterResult | undefined>;\n  getResultsByChild(childId: string): Promise<ChapterResult[]>;\n\n  // Learning Sessions\n  createLearningSession(data: InsertLearningSession): Promise<LearningSession>;\n  endLearningSession(id: string, durationSeconds: number): Promise<void>;\n  getSessionsByChild(childId: string): Promise<LearningSession[]>;\n\n  // Analytics\n  getChildAnalytics(childId: string): Promise<{\n    totalLearningTime: number;\n    subjectPerformance: { subject: string; avgScore: number; count: number }[];\n    weeklyProgress: { date: string; chaptersCompleted: number; learningTime: number }[];\n    recentActivity: { date: string; chapterTitle: string; score: number; timeSpent: number }[];\n  }>;\n  getParentAnalytics(parentId: string): Promise<{\n    childrenStats: { childId: string; name: string; totalChapters: number; avgScore: number; totalTime: number }[];\n    subjectOverview: { subject: string; avgScore: number; totalChapters: number }[];\n  }>;\n\n  // Badges\n  getAllBadges(): Promise<Badge[]>;\n  getBadgeById(id: string): Promise<Badge | undefined>;\n  createBadge(data: InsertBadge): Promise<Badge>;\n  seedBadges(): Promise<void>;\n  getChildBadges(childId: string): Promise<(ChildBadge & { badge: Badge })[]>;\n  awardBadge(childId: string, badgeId: string): Promise<ChildBadge | null>;\n  checkAndAwardBadges(childId: string): Promise<Badge[]>;\n  getSiblingLeaderboard(parentId: string): Promise<{ childId: string; name: string; totalStars: number; badgeCount: number; rank: number }[]>;\n\n  // Notifications\n  createNotification(data: InsertNotification): Promise<Notification>;\n  getNotificationsByUser(userId: string): Promise<Notification[]>;\n  markNotificationRead(id: string): Promise<void>;\n  markAllNotificationsRead(userId: string): Promise<void>;\n  getUnreadCount(userId: string): Promise<number>;\n  updateNotificationPreferences(userId: string, preferences: NotificationPreferences): Promise<void>;\n  getNotificationPreferences(userId: string): Promise<NotificationPreferences | null>;\n\n  // Sample Chapters\n  getSampleChapters(): Promise<SampleChapter[]>;\n  getSampleChapterById(id: string): Promise<SampleChapter | undefined>;\n  getSampleChaptersBySubject(subject: string): Promise<SampleChapter[]>;\n  getSampleChaptersByGrade(grade: number): Promise<SampleChapter[]>;\n  seedSampleChapters(): Promise<void>;\n  assignSampleChapterToChild(sampleChapterId: string, childId: string, parentId: string): Promise<Chapter>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // Users\n  async createUser(data: InsertUser): Promise<User> {\n    const [user] = await db.insert(users).values(data).returning();\n    return user;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user;\n  }\n\n  async getUserById(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  // Children\n  async createChild(data: InsertChild): Promise<Child> {\n    const [child] = await db.insert(children).values(data).returning();\n    return child;\n  }\n\n  async getChildrenByParent(parentId: string): Promise<Child[]> {\n    return db.select().from(children).where(eq(children.parentId, parentId));\n  }\n\n  async getChildById(id: string): Promise<Child | undefined> {\n    const [child] = await db.select().from(children).where(eq(children.id, id));\n    return child;\n  }\n\n  async updateChildStars(id: string, stars: number): Promise<void> {\n    await db.update(children).set({ totalStars: stars }).where(eq(children.id, id));\n  }\n\n  async updateChildStreak(id: string, streak: number): Promise<void> {\n    await db.update(children).set({ streak }).where(eq(children.id, id));\n  }\n\n  // Chapters\n  async createChapter(data: InsertChapter): Promise<Chapter> {\n    const [chapter] = await db.insert(chapters).values(data).returning();\n    return chapter;\n  }\n\n  async getChapterById(id: string): Promise<Chapter | undefined> {\n    const [chapter] = await db.select().from(chapters).where(eq(chapters.id, id));\n    return chapter;\n  }\n\n  async getChaptersByParent(parentId: string): Promise<Chapter[]> {\n    return db.select().from(chapters).where(eq(chapters.parentId, parentId)).orderBy(desc(chapters.createdAt));\n  }\n\n  async getChaptersByChild(childId: string): Promise<Chapter[]> {\n    return db.select().from(chapters).where(eq(chapters.childId, childId)).orderBy(desc(chapters.createdAt));\n  }\n\n  async updateChapterStatus(id: string, status: string): Promise<void> {\n    const updateData: any = { status };\n    if (status === \"completed\") {\n      updateData.completedAt = new Date();\n    }\n    await db.update(chapters).set(updateData).where(eq(chapters.id, id));\n  }\n\n  async updateChapterContent(id: string, content: ChapterContent): Promise<void> {\n    await db.update(chapters).set({ content, status: \"ready\" }).where(eq(chapters.id, id));\n  }\n\n  // Chapter Photos\n  async createChapterPhotos(chapterId: string, photos: { photoData: string; pageNumber: number }[]): Promise<ChapterPhoto[]> {\n    const photosData = photos.map((p) => ({\n      chapterId,\n      photoData: p.photoData,\n      pageNumber: p.pageNumber,\n    }));\n    return db.insert(chapterPhotos).values(photosData).returning();\n  }\n\n  async getPhotosByChapter(chapterId: string): Promise<ChapterPhoto[]> {\n    return db.select().from(chapterPhotos).where(eq(chapterPhotos.chapterId, chapterId));\n  }\n\n  // Chapter Results\n  async createChapterResult(data: InsertChapterResult): Promise<ChapterResult> {\n    const [result] = await db.insert(chapterResults).values(data).returning();\n    return result;\n  }\n\n  async getResultByChapter(chapterId: string): Promise<ChapterResult | undefined> {\n    const [result] = await db.select().from(chapterResults).where(eq(chapterResults.chapterId, chapterId));\n    return result;\n  }\n\n  async getResultById(id: string): Promise<ChapterResult | undefined> {\n    const [result] = await db.select().from(chapterResults).where(eq(chapterResults.id, id));\n    return result;\n  }\n\n  async getResultsByChild(childId: string): Promise<ChapterResult[]> {\n    return db.select().from(chapterResults).where(eq(chapterResults.childId, childId));\n  }\n\n  // Learning Sessions\n  async createLearningSession(data: InsertLearningSession): Promise<LearningSession> {\n    const [session] = await db.insert(learningSessions).values(data).returning();\n    return session;\n  }\n\n  async endLearningSession(id: string, durationSeconds: number): Promise<void> {\n    await db.update(learningSessions).set({\n      endedAt: new Date(),\n      durationSeconds,\n    }).where(eq(learningSessions.id, id));\n  }\n\n  async getSessionsByChild(childId: string): Promise<LearningSession[]> {\n    return db.select().from(learningSessions).where(eq(learningSessions.childId, childId)).orderBy(desc(learningSessions.startedAt));\n  }\n\n  // Analytics\n  async getChildAnalytics(childId: string): Promise<{\n    totalLearningTime: number;\n    subjectPerformance: { subject: string; avgScore: number; count: number }[];\n    weeklyProgress: { date: string; chaptersCompleted: number; learningTime: number }[];\n    recentActivity: { date: string; chapterTitle: string; score: number; timeSpent: number }[];\n  }> {\n    // Get total learning time\n    const sessions = await db.select().from(learningSessions).where(eq(learningSessions.childId, childId));\n    const totalLearningTime = sessions.reduce((sum: number, s: LearningSession) => sum + (s.durationSeconds || 0), 0);\n\n    // Get all results with chapter info\n    const results = await db.select({\n      result: chapterResults,\n      chapter: chapters,\n    })\n      .from(chapterResults)\n      .innerJoin(chapters, eq(chapterResults.chapterId, chapters.id))\n      .where(eq(chapterResults.childId, childId))\n      .orderBy(desc(chapterResults.createdAt));\n\n    // Calculate subject performance\n    const subjectMap = new Map<string, { total: number; count: number }>();\n    results.forEach(({ result, chapter }: { result: ChapterResult; chapter: Chapter }) => {\n      const subject = chapter.subject;\n      const score = result.totalScore || 0;\n      const existing = subjectMap.get(subject) || { total: 0, count: 0 };\n      subjectMap.set(subject, { total: existing.total + score, count: existing.count + 1 });\n    });\n    const subjectPerformance = Array.from(subjectMap.entries()).map(([subject, data]) => ({\n      subject,\n      avgScore: Math.round(data.total / data.count),\n      count: data.count,\n    }));\n\n    // Calculate weekly progress (last 7 days)\n    const sevenDaysAgo = new Date();\n    sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\n    \n    const weeklyProgress: { date: string; chaptersCompleted: number; learningTime: number }[] = [];\n    for (let i = 6; i >= 0; i--) {\n      const date = new Date();\n      date.setDate(date.getDate() - i);\n      const dateStr = date.toISOString().split('T')[0];\n      \n      const dayResults = results.filter((r: { result: ChapterResult; chapter: Chapter }) => \n        r.result.createdAt && r.result.createdAt.toISOString().split('T')[0] === dateStr\n      );\n      const daySessions = sessions.filter((s: LearningSession) => \n        s.startedAt && s.startedAt.toISOString().split('T')[0] === dateStr\n      );\n      \n      weeklyProgress.push({\n        date: dateStr,\n        chaptersCompleted: dayResults.length,\n        learningTime: daySessions.reduce((sum: number, s: LearningSession) => sum + (s.durationSeconds || 0), 0),\n      });\n    }\n\n    // Recent activity (last 5)\n    const recentActivity = results.slice(0, 5).map(({ result, chapter }: { result: ChapterResult; chapter: Chapter }) => ({\n      date: result.createdAt?.toISOString().split('T')[0] || '',\n      chapterTitle: chapter.title,\n      score: result.totalScore || 0,\n      timeSpent: result.timeSpentSeconds || 0,\n    }));\n\n    return { totalLearningTime, subjectPerformance, weeklyProgress, recentActivity };\n  }\n\n  // Get analytics for all children of a parent\n  async getParentAnalytics(parentId: string): Promise<{\n    childrenStats: { childId: string; name: string; totalChapters: number; avgScore: number; totalTime: number }[];\n    subjectOverview: { subject: string; avgScore: number; totalChapters: number }[];\n  }> {\n    const childrenList = await this.getChildrenByParent(parentId);\n    \n    const childrenStats = await Promise.all(childrenList.map(async (child) => {\n      const results = await this.getResultsByChild(child.id);\n      const sessions = await this.getSessionsByChild(child.id);\n      \n      const totalScore = results.reduce((sum, r) => sum + (r.totalScore || 0), 0);\n      const avgScore = results.length > 0 ? Math.round(totalScore / results.length) : 0;\n      const totalTime = sessions.reduce((sum, s) => sum + (s.durationSeconds || 0), 0);\n      \n      return {\n        childId: child.id,\n        name: child.name,\n        totalChapters: results.length,\n        avgScore,\n        totalTime,\n      };\n    }));\n\n    // Calculate overall subject overview\n    const allChaptersList = await this.getChaptersByParent(parentId);\n    const allResults = await Promise.all(\n      childrenList.map(child => this.getResultsByChild(child.id))\n    );\n    const flatResults = allResults.flat();\n\n    const subjectMap = new Map<string, { total: number; count: number }>();\n    for (const result of flatResults) {\n      const chapter = allChaptersList.find(c => c.id === result.chapterId);\n      if (chapter) {\n        const existing = subjectMap.get(chapter.subject) || { total: 0, count: 0 };\n        subjectMap.set(chapter.subject, { \n          total: existing.total + (result.totalScore || 0), \n          count: existing.count + 1 \n        });\n      }\n    }\n\n    const subjectOverview = Array.from(subjectMap.entries()).map(([subject, data]) => ({\n      subject,\n      avgScore: data.count > 0 ? Math.round(data.total / data.count) : 0,\n      totalChapters: data.count,\n    }));\n\n    return { childrenStats, subjectOverview };\n  }\n\n  // Badge methods\n  async getAllBadges(): Promise<Badge[]> {\n    return db.select().from(badges);\n  }\n\n  async getBadgeById(id: string): Promise<Badge | undefined> {\n    const [badge] = await db.select().from(badges).where(eq(badges.id, id));\n    return badge;\n  }\n\n  async createBadge(data: InsertBadge): Promise<Badge> {\n    const [badge] = await db.insert(badges).values(data).returning();\n    return badge;\n  }\n\n  async seedBadges(): Promise<void> {\n    const existingBadges = await this.getAllBadges();\n    if (existingBadges.length === 0) {\n      for (const badgeDef of badgeDefinitions) {\n        await this.createBadge(badgeDef);\n      }\n    }\n  }\n\n  async getChildBadges(childId: string): Promise<(ChildBadge & { badge: Badge })[]> {\n    const results = await db\n      .select()\n      .from(childBadges)\n      .innerJoin(badges, eq(childBadges.badgeId, badges.id))\n      .where(eq(childBadges.childId, childId))\n      .orderBy(desc(childBadges.earnedAt));\n    \n    return results.map(r => ({ ...r.child_badges, badge: r.badges }));\n  }\n\n  async awardBadge(childId: string, badgeId: string): Promise<ChildBadge | null> {\n    // Check if already awarded\n    const existing = await db\n      .select()\n      .from(childBadges)\n      .where(and(eq(childBadges.childId, childId), eq(childBadges.badgeId, badgeId)));\n    \n    if (existing.length > 0) {\n      return null; // Already has this badge\n    }\n    \n    const [childBadge] = await db.insert(childBadges).values({ childId, badgeId }).returning();\n    return childBadge;\n  }\n\n  async checkAndAwardBadges(childId: string): Promise<Badge[]> {\n    const allBadges = await this.getAllBadges();\n    const earnedBadges = await this.getChildBadges(childId);\n    const earnedBadgeIds = new Set(earnedBadges.map(cb => cb.badgeId));\n    \n    const child = await this.getChildById(childId);\n    if (!child) return [];\n    \n    const results = await this.getResultsByChild(childId);\n    const sessions = await this.getSessionsByChild(childId);\n    const totalLearningTime = sessions.reduce((sum, s) => sum + (s.durationSeconds || 0), 0);\n    \n    // Get chapters to check subjects\n    const chapters = await this.getChaptersByChild(childId);\n    const subjectCounts = new Map<string, number>();\n    for (const chapter of chapters) {\n      const count = subjectCounts.get(chapter.subject) || 0;\n      subjectCounts.set(chapter.subject, count + 1);\n    }\n    \n    const newlyEarned: Badge[] = [];\n    \n    for (const badge of allBadges) {\n      if (earnedBadgeIds.has(badge.id)) continue;\n      \n      let earned = false;\n      \n      switch (badge.type) {\n        case 'first_chapter':\n          earned = results.length >= badge.requirement;\n          break;\n        case 'perfect_score':\n          earned = results.some(r => r.totalScore === 100);\n          break;\n        case 'streak':\n          earned = (child.streak || 0) >= badge.requirement;\n          break;\n        case 'learning_time':\n          earned = totalLearningTime >= badge.requirement;\n          break;\n        case 'subject_mastery':\n          if (badge.name.toLowerCase().includes('math')) {\n            earned = (subjectCounts.get('math') || 0) >= badge.requirement;\n          } else if (badge.name.toLowerCase().includes('science')) {\n            earned = (subjectCounts.get('science') || 0) >= badge.requirement;\n          }\n          break;\n      }\n      \n      if (earned) {\n        await this.awardBadge(childId, badge.id);\n        newlyEarned.push(badge);\n      }\n    }\n    \n    return newlyEarned;\n  }\n\n  async getSiblingLeaderboard(parentId: string): Promise<{ childId: string; name: string; totalStars: number; badgeCount: number; rank: number }[]> {\n    const childrenList = await this.getChildrenByParent(parentId);\n    \n    const leaderboard = await Promise.all(childrenList.map(async (child) => {\n      const childBadgesList = await this.getChildBadges(child.id);\n      return {\n        childId: child.id,\n        name: child.name,\n        totalStars: child.totalStars || 0,\n        badgeCount: childBadgesList.length,\n        rank: 0,\n      };\n    }));\n    \n    // Sort by stars, then badge count\n    leaderboard.sort((a, b) => {\n      if (b.totalStars !== a.totalStars) return b.totalStars - a.totalStars;\n      return b.badgeCount - a.badgeCount;\n    });\n    \n    // Assign ranks\n    leaderboard.forEach((item, index) => {\n      item.rank = index + 1;\n    });\n    \n    return leaderboard;\n  }\n\n  // Notifications\n  async createNotification(data: InsertNotification): Promise<Notification> {\n    const [notification] = await db.insert(notifications).values(data).returning();\n    return notification;\n  }\n\n  async getNotificationsByUser(userId: string): Promise<Notification[]> {\n    return db.select().from(notifications)\n      .where(eq(notifications.userId, userId))\n      .orderBy(desc(notifications.createdAt));\n  }\n\n  async markNotificationRead(id: string): Promise<void> {\n    await db.update(notifications).set({ read: true }).where(eq(notifications.id, id));\n  }\n\n  async markAllNotificationsRead(userId: string): Promise<void> {\n    await db.update(notifications).set({ read: true }).where(eq(notifications.userId, userId));\n  }\n\n  async getUnreadCount(userId: string): Promise<number> {\n    const result = await db.select({ count: sql<number>`count(*)::int` })\n      .from(notifications)\n      .where(and(eq(notifications.userId, userId), eq(notifications.read, false)));\n    return result[0]?.count || 0;\n  }\n\n  async updateNotificationPreferences(userId: string, preferences: NotificationPreferences): Promise<void> {\n    await db.update(users).set({ notificationPreferences: preferences }).where(eq(users.id, userId));\n  }\n\n  async getNotificationPreferences(userId: string): Promise<NotificationPreferences | null> {\n    const user = await this.getUserById(userId);\n    return user?.notificationPreferences || null;\n  }\n\n  // Sample Chapters\n  async getSampleChapters(): Promise<SampleChapter[]> {\n    return db.select().from(sampleChapters)\n      .where(eq(sampleChapters.isActive, true))\n      .orderBy(sampleChapters.grade, sampleChapters.subject);\n  }\n\n  async getSampleChapterById(id: string): Promise<SampleChapter | undefined> {\n    const [sample] = await db.select().from(sampleChapters).where(eq(sampleChapters.id, id));\n    return sample;\n  }\n\n  async getSampleChaptersBySubject(subject: string): Promise<SampleChapter[]> {\n    return db.select().from(sampleChapters)\n      .where(and(eq(sampleChapters.subject, subject), eq(sampleChapters.isActive, true)))\n      .orderBy(sampleChapters.grade);\n  }\n\n  async getSampleChaptersByGrade(grade: number): Promise<SampleChapter[]> {\n    return db.select().from(sampleChapters)\n      .where(and(eq(sampleChapters.grade, grade), eq(sampleChapters.isActive, true)))\n      .orderBy(sampleChapters.subject);\n  }\n\n  async seedSampleChapters(): Promise<void> {\n    const existingSamples = await db.select().from(sampleChapters);\n    if (existingSamples.length > 0) {\n      console.log(\"Sample chapters already seeded\");\n      return;\n    }\n\n    for (const sample of sampleChapterDefinitions) {\n      await db.insert(sampleChapters).values(sample);\n    }\n    console.log(\"Sample chapters seeded successfully\");\n  }\n\n  async assignSampleChapterToChild(sampleChapterId: string, childId: string, parentId: string): Promise<Chapter> {\n    const sample = await this.getSampleChapterById(sampleChapterId);\n    if (!sample) {\n      throw new Error(\"Sample chapter not found\");\n    }\n\n    const [chapter] = await db.insert(chapters).values({\n      childId,\n      parentId,\n      title: sample.titleAr,\n      subject: sample.subject,\n      grade: sample.grade,\n      content: sample.content,\n      status: \"ready\",\n    }).returning();\n\n    return chapter;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":21893,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/pages/child-welcome.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useParams, Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Star, Flame, Trophy, Sparkles, ChevronLeft, Award } from \"lucide-react\";\nimport type { Child, ChildBadge, Badge } from \"@shared/schema\";\n\nexport default function ChildWelcome() {\n  const { childId } = useParams<{ childId: string }>();\n\n  const { data: child, isLoading } = useQuery<Child>({\n    queryKey: [\"/api/children\", childId],\n    enabled: !!childId,\n  });\n\n  const { data: childBadges } = useQuery<(ChildBadge & { badge: Badge })[]>({\n    queryKey: [\"/api/children\", childId, \"badges\"],\n    enabled: !!childId,\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-pink-100 via-purple-50 to-blue-100 flex items-center justify-center\" dir=\"rtl\">\n        <div className=\"text-center\">\n          <Skeleton className=\"w-32 h-32 rounded-full mx-auto mb-6\" />\n          <Skeleton className=\"h-10 w-48 mx-auto mb-4\" />\n          <Skeleton className=\"h-6 w-64 mx-auto\" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-pink-100 via-purple-50 to-blue-100 flex flex-col\" dir=\"rtl\">\n      <div className=\"flex-1 flex flex-col items-center justify-center p-6 text-center\">\n        <div className=\"w-32 h-32 bg-gradient-to-br from-child-coral to-child-purple rounded-full flex items-center justify-center mb-6 shadow-lg animate-bounce-gentle\">\n          <span className=\"text-6xl font-child font-bold text-white\">\n            {child?.name?.charAt(0) || \"؟\"}\n          </span>\n        </div>\n\n        <h1 className=\"text-4xl font-child font-bold text-gray-800 mb-2\" data-testid=\"text-child-greeting\">\n          مرحباً {child?.name}!\n        </h1>\n        <p className=\"text-xl font-arabic text-gray-600 mb-8\">\n          يسعدنا رؤيتك اليوم\n        </p>\n\n        <div className=\"flex items-center justify-center gap-6 mb-12\">\n          <div className=\"text-center bg-white/60 backdrop-blur-sm rounded-2xl p-4 shadow-md\">\n            <div className=\"flex items-center justify-center gap-2 text-amber-500 mb-1\">\n              <Star className=\"w-8 h-8 fill-current\" />\n              <span className=\"text-3xl font-child font-bold\">{child?.totalStars || 0}</span>\n            </div>\n            <p className=\"text-sm font-arabic text-gray-600\">نجوم</p>\n          </div>\n\n          <div className=\"text-center bg-white/60 backdrop-blur-sm rounded-2xl p-4 shadow-md\">\n            <div className=\"flex items-center justify-center gap-2 text-orange-500 mb-1\">\n              <Flame className=\"w-8 h-8\" />\n              <span className=\"text-3xl font-child font-bold\">{child?.streak || 0}</span>\n            </div>\n            <p className=\"text-sm font-arabic text-gray-600\">أيام متتالية</p>\n          </div>\n\n          <Link href={`/child/${childId}/badges`}>\n            <div className=\"text-center bg-white/60 backdrop-blur-sm rounded-2xl p-4 shadow-md hover-elevate cursor-pointer\" data-testid=\"link-badges\">\n              <div className=\"flex items-center justify-center gap-2 text-child-purple mb-1\">\n                <Award className=\"w-8 h-8\" />\n                <span className=\"text-3xl font-child font-bold\">{childBadges?.length || 0}</span>\n              </div>\n              <p className=\"text-sm font-arabic text-gray-600\">شارات</p>\n            </div>\n          </Link>\n        </div>\n\n        <Link href={`/child/${childId}/lessons`}>\n          <Button \n            size=\"lg\" \n            className=\"h-16 px-12 text-xl font-child font-bold rounded-2xl bg-gradient-to-br from-child-coral to-child-purple hover:opacity-90 shadow-lg gap-3\"\n            data-testid=\"button-start-lessons\"\n          >\n            <Sparkles className=\"w-6 h-6\" />\n            هيا نتعلم!\n            <ChevronLeft className=\"w-6 h-6\" />\n          </Button>\n        </Link>\n      </div>\n\n      <div className=\"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-white/40 to-transparent pointer-events-none\" />\n    </div>\n  );\n}\n","path":null,"size_bytes":4162,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/pages/auth.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { BookOpen, Sparkles, GraduationCap, Star } from \"lucide-react\";\n\nconst loginSchema = z.object({\n  email: z.string().email(\"البريد الإلكتروني غير صحيح\"),\n  password: z.string().min(6, \"كلمة المرور يجب أن تكون 6 أحرف على الأقل\"),\n});\n\nconst registerSchema = loginSchema.extend({\n  fullName: z.string().min(2, \"الاسم يجب أن يكون حرفين على الأقل\"),\n  confirmPassword: z.string(),\n}).refine((data) => data.password === data.confirmPassword, {\n  message: \"كلمة المرور غير متطابقة\",\n  path: [\"confirmPassword\"],\n});\n\ntype LoginForm = z.infer<typeof loginSchema>;\ntype RegisterForm = z.infer<typeof registerSchema>;\n\nexport default function AuthPage() {\n  const [isLogin, setIsLogin] = useState(true);\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  const loginForm = useForm<LoginForm>({\n    resolver: zodResolver(loginSchema),\n    defaultValues: { email: \"\", password: \"\" },\n  });\n\n  const registerForm = useForm<RegisterForm>({\n    resolver: zodResolver(registerSchema),\n    defaultValues: { email: \"\", password: \"\", fullName: \"\", confirmPassword: \"\" },\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async (data: LoginForm) => {\n      const res = await apiRequest(\"POST\", \"/api/auth/login\", data);\n      return res.json();\n    },\n    onSuccess: (data) => {\n      localStorage.setItem(\"userId\", data.user.id);\n      localStorage.setItem(\"userName\", data.user.fullName);\n      toast({ title: \"مرحباً بك!\", description: \"تم تسجيل الدخول بنجاح\" });\n      setLocation(\"/\");\n    },\n    onError: () => {\n      toast({ title: \"خطأ\", description: \"البريد الإلكتروني أو كلمة المرور غير صحيحة\", variant: \"destructive\" });\n    },\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async (data: RegisterForm) => {\n      const res = await apiRequest(\"POST\", \"/api/auth/register\", {\n        email: data.email,\n        password: data.password,\n        fullName: data.fullName,\n      });\n      return res.json();\n    },\n    onSuccess: (data) => {\n      localStorage.setItem(\"userId\", data.user.id);\n      localStorage.setItem(\"userName\", data.user.fullName);\n      toast({ title: \"تم إنشاء الحساب!\", description: \"مرحباً بك في ليرن سناب\" });\n      setLocation(\"/\");\n    },\n    onError: () => {\n      toast({ title: \"خطأ\", description: \"حدث خطأ أثناء إنشاء الحساب\", variant: \"destructive\" });\n    },\n  });\n\n  const features = [\n    { icon: BookOpen, text: \"حوّل صفحات الكتب إلى دروس تفاعلية\" },\n    { icon: Sparkles, text: \"محتوى مولد بالذكاء الاصطناعي\" },\n    { icon: GraduationCap, text: \"تمارين واختبارات تقييمية\" },\n    { icon: Star, text: \"نظام نجوم وإنجازات محفز\" },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-emerald-50 flex\" dir=\"rtl\">\n      <div className=\"flex-1 flex items-center justify-center p-6\">\n        <Card className=\"w-full max-w-md shadow-lg border-0\">\n          <CardHeader className=\"text-center pb-2\">\n            <div className=\"mx-auto w-16 h-16 bg-gradient-to-br from-blue-500 to-emerald-500 rounded-2xl flex items-center justify-center mb-4 shadow-lg\">\n              <BookOpen className=\"w-8 h-8 text-white\" />\n            </div>\n            <CardTitle className=\"text-2xl font-bold font-arabic text-foreground\">\n              {isLogin ? \"تسجيل الدخول\" : \"إنشاء حساب جديد\"}\n            </CardTitle>\n            <CardDescription className=\"font-arabic\">\n              {isLogin ? \"سجل دخولك لمتابعة تعلم أطفالك\" : \"أنشئ حسابك لبدء رحلة التعلم\"}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {isLogin ? (\n              <Form {...loginForm}>\n                <form onSubmit={loginForm.handleSubmit((data) => loginMutation.mutate(data))} className=\"space-y-4\">\n                  <FormField\n                    control={loginForm.control}\n                    name=\"email\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"font-arabic\">البريد الإلكتروني</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"example@email.com\" \n                            type=\"email\" \n                            {...field} \n                            data-testid=\"input-email\"\n                            className=\"text-left\"\n                            dir=\"ltr\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={loginForm.control}\n                    name=\"password\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"font-arabic\">كلمة المرور</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"••••••••\" \n                            type=\"password\" \n                            {...field} \n                            data-testid=\"input-password\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <Button \n                    type=\"submit\" \n                    className=\"w-full font-arabic\" \n                    disabled={loginMutation.isPending}\n                    data-testid=\"button-login\"\n                  >\n                    {loginMutation.isPending ? \"جاري التسجيل...\" : \"تسجيل الدخول\"}\n                  </Button>\n                </form>\n              </Form>\n            ) : (\n              <Form {...registerForm}>\n                <form onSubmit={registerForm.handleSubmit((data) => registerMutation.mutate(data))} className=\"space-y-4\">\n                  <FormField\n                    control={registerForm.control}\n                    name=\"fullName\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"font-arabic\">الاسم الكامل</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"أحمد محمد\" \n                            {...field} \n                            data-testid=\"input-fullname\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={registerForm.control}\n                    name=\"email\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"font-arabic\">البريد الإلكتروني</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"example@email.com\" \n                            type=\"email\" \n                            {...field} \n                            data-testid=\"input-email-register\"\n                            className=\"text-left\"\n                            dir=\"ltr\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={registerForm.control}\n                    name=\"password\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"font-arabic\">كلمة المرور</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"••••••••\" \n                            type=\"password\" \n                            {...field} \n                            data-testid=\"input-password-register\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={registerForm.control}\n                    name=\"confirmPassword\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"font-arabic\">تأكيد كلمة المرور</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"••••••••\" \n                            type=\"password\" \n                            {...field} \n                            data-testid=\"input-confirm-password\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <Button \n                    type=\"submit\" \n                    className=\"w-full font-arabic\" \n                    disabled={registerMutation.isPending}\n                    data-testid=\"button-register\"\n                  >\n                    {registerMutation.isPending ? \"جاري إنشاء الحساب...\" : \"إنشاء حساب\"}\n                  </Button>\n                </form>\n              </Form>\n            )}\n            <div className=\"mt-6 text-center\">\n              <button\n                type=\"button\"\n                onClick={() => setIsLogin(!isLogin)}\n                className=\"text-sm text-muted-foreground hover:text-primary transition-colors font-arabic\"\n                data-testid=\"button-toggle-auth\"\n              >\n                {isLogin ? \"ليس لديك حساب؟ أنشئ حساب جديد\" : \"لديك حساب؟ سجل دخولك\"}\n              </button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"hidden lg:flex flex-1 bg-gradient-to-br from-blue-600 to-emerald-600 items-center justify-center p-12\">\n        <div className=\"text-white max-w-lg\">\n          <h1 className=\"text-4xl font-bold mb-6 font-arabic\">\n            ليرن سناب\n          </h1>\n          <p className=\"text-xl opacity-90 mb-8 font-arabic leading-relaxed\">\n            التطبيق الذكي الذي يحول صفحات الكتب المدرسية إلى تجارب تعلم تفاعلية ممتعة لأطفالك\n          </p>\n          <div className=\"space-y-4\">\n            {features.map((feature, index) => (\n              <div key={index} className=\"flex items-center gap-4 bg-white/10 rounded-xl p-4 backdrop-blur-sm\">\n                <div className=\"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center\">\n                  <feature.icon className=\"w-5 h-5\" />\n                </div>\n                <span className=\"font-arabic text-lg\">{feature.text}</span>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":12110,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/pages/practice-stage.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useParams, useLocation, Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { ArrowRight, CheckCircle, XCircle, Sparkles, ArrowLeft } from \"lucide-react\";\nimport type { Chapter, Question } from \"@shared/schema\";\n\nfunction ConfettiPiece({ delay }: { delay: number }) {\n  const colors = [\"bg-child-coral\", \"bg-child-turquoise\", \"bg-child-yellow\", \"bg-child-green\", \"bg-child-purple\"];\n  const color = colors[Math.floor(Math.random() * colors.length)];\n  const left = Math.random() * 100;\n  \n  return (\n    <div \n      className={`absolute w-3 h-3 rounded-sm ${color} animate-confetti-fall`}\n      style={{ \n        left: `${left}%`, \n        animationDelay: `${delay}ms`,\n        top: \"-20px\"\n      }}\n    />\n  );\n}\n\nfunction FeedbackOverlay({ isCorrect, onContinue }: { isCorrect: boolean; onContinue: () => void }) {\n  useEffect(() => {\n    const timer = setTimeout(onContinue, 2000);\n    return () => clearTimeout(timer);\n  }, [onContinue]);\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm\">\n      {isCorrect && (\n        <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n          {Array.from({ length: 30 }).map((_, i) => (\n            <ConfettiPiece key={i} delay={i * 50} />\n          ))}\n        </div>\n      )}\n      <div className={`text-center animate-scale-in ${isCorrect ? \"text-white\" : \"text-white\"}`}>\n        <div className={`w-32 h-32 rounded-full flex items-center justify-center mx-auto mb-6 ${\n          isCorrect ? \"bg-child-green\" : \"bg-child-coral\"\n        } shadow-2xl`}>\n          {isCorrect ? (\n            <CheckCircle className=\"w-20 h-20\" />\n          ) : (\n            <XCircle className=\"w-20 h-20\" />\n          )}\n        </div>\n        <h2 className=\"text-4xl font-child font-bold mb-2\">\n          {isCorrect ? \"ممتاز!\" : \"حاول مرة أخرى!\"}\n        </h2>\n        <p className=\"text-xl font-arabic opacity-90\">\n          {isCorrect ? \"أحسنت، أجابتك صحيحة\" : \"لا بأس، الخطأ جزء من التعلم\"}\n        </p>\n      </div>\n    </div>\n  );\n}\n\nexport default function PracticeStage() {\n  const { id } = useParams<{ id: string }>();\n  const [, setLocation] = useLocation();\n  const [currentQuestion, setCurrentQuestion] = useState(0);\n  const [selectedAnswer, setSelectedAnswer] = useState<string | null>(null);\n  const [showFeedback, setShowFeedback] = useState(false);\n  const [isCorrect, setIsCorrect] = useState(false);\n  const [answers, setAnswers] = useState<string[]>([]);\n\n  const { data: chapter } = useQuery<Chapter>({\n    queryKey: [\"/api/chapters\", id],\n    enabled: !!id,\n  });\n\n  const questions = chapter?.content?.practice || [];\n  const question = questions[currentQuestion];\n  const progress = questions.length > 0 ? ((currentQuestion + 1) / questions.length) * 100 : 0;\n\n  const handleAnswer = (answer: string) => {\n    setSelectedAnswer(answer);\n  };\n\n  const handleCheck = () => {\n    if (!selectedAnswer || !question) return;\n\n    const correct = selectedAnswer === question.correct;\n    setIsCorrect(correct);\n    setAnswers(prev => [...prev, selectedAnswer]);\n    setShowFeedback(true);\n  };\n\n  const handleContinue = () => {\n    setShowFeedback(false);\n    setSelectedAnswer(null);\n    \n    if (currentQuestion < questions.length - 1) {\n      setCurrentQuestion(prev => prev + 1);\n    } else {\n      localStorage.setItem(`practice_answers_${id}`, JSON.stringify(answers));\n      setLocation(`/child/chapter/${id}/test`);\n    }\n  };\n\n  if (!chapter || !question) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-green-50 via-white to-teal-50 flex items-center justify-center\" dir=\"rtl\">\n        <p className=\"font-arabic text-gray-500\">جاري التحميل...</p>\n      </div>\n    );\n  }\n\n  const answerLabels = [\"أ\", \"ب\", \"ج\", \"د\"];\n  const answerKeys = [\"A\", \"B\", \"C\", \"D\"];\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-green-50 via-white to-teal-50 flex flex-col\" dir=\"rtl\">\n      {showFeedback && (\n        <FeedbackOverlay isCorrect={isCorrect} onContinue={handleContinue} />\n      )}\n\n      <header className=\"bg-white/80 backdrop-blur-sm border-b sticky top-0 z-40\">\n        <div className=\"max-w-2xl mx-auto px-4\">\n          <div className=\"flex items-center h-16 gap-4\">\n            <Link href={`/child/chapter/${id}/learn`}>\n              <Button variant=\"ghost\" size=\"icon\" className=\"rounded-xl\">\n                <ArrowRight className=\"w-6 h-6\" />\n              </Button>\n            </Link>\n            <div className=\"flex-1\">\n              <h1 className=\"font-child font-bold text-lg\">تمرين</h1>\n              <p className=\"text-xs text-muted-foreground font-arabic\">\n                السؤال {currentQuestion + 1} من {questions.length}\n              </p>\n            </div>\n            <div className=\"flex items-center gap-2 bg-green-100 px-3 py-1.5 rounded-full\">\n              <Sparkles className=\"w-4 h-4 text-green-600\" />\n              <span className=\"text-sm font-child font-bold text-green-700\">تمرين</span>\n            </div>\n          </div>\n          <Progress value={progress} className=\"h-2 mb-2\" />\n        </div>\n      </header>\n\n      <main className=\"flex-1 flex flex-col max-w-2xl mx-auto w-full px-4 py-8\">\n        <Card className=\"mb-6 shadow-lg border-0 bg-white/90 backdrop-blur-sm\">\n          <CardContent className=\"p-8\">\n            <p \n              className=\"text-2xl font-arabic leading-relaxed text-gray-800 text-center\"\n              data-testid=\"text-question\"\n            >\n              {question.question}\n            </p>\n          </CardContent>\n        </Card>\n\n        <div className=\"space-y-3 flex-1\">\n          {question.options.map((option, index) => (\n            <Button\n              key={index}\n              variant=\"outline\"\n              className={`w-full h-16 text-lg font-arabic justify-start px-6 rounded-xl transition-all ${\n                selectedAnswer === answerKeys[index]\n                  ? \"border-2 border-green-500 bg-green-50\"\n                  : \"hover:bg-gray-50\"\n              }`}\n              onClick={() => handleAnswer(answerKeys[index])}\n              data-testid={`button-answer-${index}`}\n            >\n              <span className={`w-10 h-10 rounded-lg ml-4 flex items-center justify-center font-child font-bold ${\n                selectedAnswer === answerKeys[index]\n                  ? \"bg-green-500 text-white\"\n                  : \"bg-gray-100 text-gray-600\"\n              }`}>\n                {answerLabels[index]}\n              </span>\n              {option}\n            </Button>\n          ))}\n        </div>\n\n        <Button\n          size=\"lg\"\n          onClick={handleCheck}\n          disabled={!selectedAnswer}\n          className=\"h-16 mt-6 font-child font-bold text-xl rounded-xl bg-gradient-to-r from-green-500 to-emerald-600\"\n          data-testid=\"button-check\"\n        >\n          <CheckCircle className=\"w-6 h-6 ml-2\" />\n          تحقق من الإجابة\n        </Button>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":7318,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { type Server } from \"http\";\nimport bcrypt from \"bcrypt\";\nimport { storage } from \"./storage\";\nimport { processChapterWithAI, calculateScores } from \"./ai-service\";\nimport { stripeService } from \"./stripeService\";\nimport { getStripePublishableKey } from \"./stripeClient\";\nimport { insertUserSchema, insertChildSchema, insertChapterSchema } from \"@shared/schema\";\nimport { z } from \"zod\";\n\nconst SALT_ROUNDS = 10;\n\nexport async function registerRoutes(httpServer: Server, app: Express): Promise<void> {\n  // Auth routes\n  app.post(\"/api/auth/register\", async (req, res) => {\n    try {\n      const data = insertUserSchema.parse(req.body);\n      \n      const existing = await storage.getUserByEmail(data.email);\n      if (existing) {\n        return res.status(400).json({ error: \"البريد الإلكتروني مسجل مسبقاً\" });\n      }\n\n      // Hash the password before storing\n      const hashedPassword = await bcrypt.hash(data.password, SALT_ROUNDS);\n      const user = await storage.createUser({\n        ...data,\n        password: hashedPassword,\n      });\n      \n      res.json({ user: { id: user.id, email: user.email, fullName: user.fullName } });\n    } catch (error) {\n      console.error(\"Register error:\", error);\n      res.status(400).json({ error: \"فشل إنشاء الحساب\" });\n    }\n  });\n\n  app.post(\"/api/auth/login\", async (req, res) => {\n    try {\n      const { email, password } = req.body;\n      \n      const user = await storage.getUserByEmail(email);\n      if (!user) {\n        return res.status(401).json({ error: \"بيانات الدخول غير صحيحة\" });\n      }\n\n      // Compare password with hashed password\n      const isValidPassword = await bcrypt.compare(password, user.password);\n      if (!isValidPassword) {\n        return res.status(401).json({ error: \"بيانات الدخول غير صحيحة\" });\n      }\n\n      res.json({ user: { id: user.id, email: user.email, fullName: user.fullName } });\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      res.status(400).json({ error: \"فشل تسجيل الدخول\" });\n    }\n  });\n\n  // Children routes\n  app.get(\"/api/children\", async (req, res) => {\n    try {\n      const parentId = req.query.parentId as string;\n      if (!parentId) {\n        return res.status(400).json({ error: \"parentId مطلوب\" });\n      }\n      const childrenList = await storage.getChildrenByParent(parentId);\n      res.json(childrenList);\n    } catch (error) {\n      console.error(\"Get children error:\", error);\n      res.status(500).json({ error: \"فشل جلب الأطفال\" });\n    }\n  });\n\n  app.get(\"/api/children/:id\", async (req, res) => {\n    try {\n      const child = await storage.getChildById(req.params.id);\n      if (!child) {\n        return res.status(404).json({ error: \"الطفل غير موجود\" });\n      }\n      res.json(child);\n    } catch (error) {\n      console.error(\"Get child error:\", error);\n      res.status(500).json({ error: \"فشل جلب الطفل\" });\n    }\n  });\n\n  app.get(\"/api/children/:childId/chapters\", async (req, res) => {\n    try {\n      const chaptersList = await storage.getChaptersByChild(req.params.childId);\n      res.json(chaptersList);\n    } catch (error) {\n      console.error(\"Get child chapters error:\", error);\n      res.status(500).json({ error: \"فشل جلب الفصول\" });\n    }\n  });\n\n  app.get(\"/api/children/:childId/results\", async (req, res) => {\n    try {\n      const results = await storage.getResultsByChild(req.params.childId);\n      res.json(results);\n    } catch (error) {\n      console.error(\"Get child results error:\", error);\n      res.status(500).json({ error: \"فشل جلب النتائج\" });\n    }\n  });\n\n  app.post(\"/api/children\", async (req, res) => {\n    try {\n      const data = insertChildSchema.parse(req.body);\n      const child = await storage.createChild(data);\n      res.json(child);\n    } catch (error) {\n      console.error(\"Create child error:\", error);\n      res.status(400).json({ error: \"فشل إضافة الطفل\" });\n    }\n  });\n\n  // Chapters routes\n  app.get(\"/api/chapters\", async (req, res) => {\n    try {\n      const parentId = req.query.parentId as string;\n      if (!parentId) {\n        return res.status(400).json({ error: \"parentId مطلوب\" });\n      }\n      const chaptersList = await storage.getChaptersByParent(parentId);\n      res.json(chaptersList);\n    } catch (error) {\n      console.error(\"Get chapters error:\", error);\n      res.status(500).json({ error: \"فشل جلب الفصول\" });\n    }\n  });\n\n  app.get(\"/api/chapters/:id\", async (req, res) => {\n    try {\n      const chapter = await storage.getChapterById(req.params.id);\n      if (!chapter) {\n        return res.status(404).json({ error: \"الفصل غير موجود\" });\n      }\n      res.json(chapter);\n    } catch (error) {\n      console.error(\"Get chapter error:\", error);\n      res.status(500).json({ error: \"فشل جلب الفصل\" });\n    }\n  });\n\n  app.get(\"/api/chapters/:id/result\", async (req, res) => {\n    try {\n      const result = await storage.getResultByChapter(req.params.id);\n      if (!result) {\n        return res.status(404).json({ error: \"النتيجة غير موجودة\" });\n      }\n      res.json(result);\n    } catch (error) {\n      console.error(\"Get chapter result error:\", error);\n      res.status(500).json({ error: \"فشل جلب النتيجة\" });\n    }\n  });\n\n  const createChapterSchema = insertChapterSchema.extend({\n    photos: z.array(z.object({\n      photoData: z.string(),\n      pageNumber: z.number(),\n    })),\n  });\n\n  app.post(\"/api/chapters\", async (req, res) => {\n    try {\n      const data = createChapterSchema.parse(req.body);\n      const { photos, ...chapterData } = data;\n\n      // Create the chapter\n      const chapter = await storage.createChapter(chapterData);\n\n      // Save photos\n      if (photos.length > 0) {\n        await storage.createChapterPhotos(chapter.id, photos);\n      }\n\n      // Start AI processing in background\n      processChapterInBackground(chapter.id, photos.map(p => p.photoData), data.subject, data.grade);\n\n      res.json({ chapter });\n    } catch (error) {\n      console.error(\"Create chapter error:\", error);\n      res.status(400).json({ error: \"فشل إنشاء الفصل\" });\n    }\n  });\n\n  // Background processing function\n  async function processChapterInBackground(chapterId: string, photos: string[], subject: string, grade: number) {\n    try {\n      console.log(`Starting AI processing for chapter ${chapterId}...`);\n      \n      const content = await processChapterWithAI(photos, subject, grade);\n      \n      await storage.updateChapterContent(chapterId, content);\n      \n      console.log(`Chapter ${chapterId} processed successfully!`);\n    } catch (error) {\n      console.error(`Failed to process chapter ${chapterId}:`, error);\n      await storage.updateChapterStatus(chapterId, \"error\");\n    }\n  }\n\n  // Submit answers\n  const submitAnswersSchema = z.object({\n    practiceAnswers: z.array(z.string()),\n    testAnswers: z.array(z.string()),\n  });\n\n  app.post(\"/api/chapters/:id/submit\", async (req, res) => {\n    try {\n      const { practiceAnswers, testAnswers } = submitAnswersSchema.parse(req.body);\n      const chapterId = req.params.id;\n\n      const chapter = await storage.getChapterById(chapterId);\n      if (!chapter || !chapter.content) {\n        return res.status(404).json({ error: \"الفصل غير موجود\" });\n      }\n\n      const content = chapter.content;\n      const { practiceScore, testScore, totalScore, stars } = calculateScores(\n        practiceAnswers,\n        testAnswers,\n        content.practice,\n        content.test\n      );\n\n      const result = await storage.createChapterResult({\n        chapterId,\n        childId: chapter.childId,\n        practiceScore,\n        testScore,\n        totalScore,\n        stars,\n        timeSpentSeconds: 0, // TODO: track actual time\n        answers: { practiceAnswers, testAnswers },\n      });\n\n      // Update chapter status\n      await storage.updateChapterStatus(chapterId, \"completed\");\n\n      // Update child's total stars\n      const child = await storage.getChildById(chapter.childId);\n      if (child) {\n        await storage.updateChildStars(child.id, (child.totalStars || 0) + stars);\n        \n        // Create notification for parent about chapter completion\n        const parentPrefs = await storage.getNotificationPreferences(chapter.parentId);\n        if (parentPrefs?.chapterComplete !== false) {\n          await storage.createNotification({\n            userId: chapter.parentId,\n            type: \"chapter_complete\",\n            title: \"Chapter Completed!\",\n            titleAr: \"تم إكمال الفصل!\",\n            message: `${child.name} completed \"${chapter.title}\" with a score of ${totalScore}% and earned ${stars} stars!`,\n            messageAr: `${child.name} أكمل \"${chapter.title}\" بنتيجة ${totalScore}٪ وحصل على ${stars} نجوم!`,\n            data: { childId: child.id, chapterId },\n          });\n        }\n      }\n\n      res.json({ result });\n    } catch (error) {\n      console.error(\"Submit answers error:\", error);\n      res.status(400).json({ error: \"فشل إرسال الإجابات\" });\n    }\n  });\n\n  // Results routes\n  app.get(\"/api/results/:id\", async (req, res) => {\n    try {\n      const result = await storage.getResultById(req.params.id);\n      if (!result) {\n        return res.status(404).json({ error: \"النتيجة غير موجودة\" });\n      }\n      res.json(result);\n    } catch (error) {\n      console.error(\"Get result error:\", error);\n      res.status(500).json({ error: \"فشل جلب النتيجة\" });\n    }\n  });\n\n  // Stripe routes\n  app.get(\"/api/stripe/config\", async (req, res) => {\n    try {\n      const publishableKey = await getStripePublishableKey();\n      res.json({ publishableKey });\n    } catch (error) {\n      console.error(\"Get Stripe config error:\", error);\n      res.status(500).json({ error: \"Failed to get Stripe config\" });\n    }\n  });\n\n  app.get(\"/api/stripe/products\", async (req, res) => {\n    try {\n      const rows = await stripeService.listProductsWithPrices();\n      \n      const productsMap = new Map();\n      for (const row of rows as any[]) {\n        if (!productsMap.has(row.product_id)) {\n          productsMap.set(row.product_id, {\n            id: row.product_id,\n            name: row.product_name,\n            description: row.product_description,\n            active: row.product_active,\n            metadata: row.product_metadata,\n            prices: []\n          });\n        }\n        if (row.price_id) {\n          productsMap.get(row.product_id).prices.push({\n            id: row.price_id,\n            unit_amount: row.unit_amount,\n            currency: row.currency,\n            recurring: row.recurring,\n            active: row.price_active,\n          });\n        }\n      }\n\n      res.json({ data: Array.from(productsMap.values()) });\n    } catch (error) {\n      console.error(\"Get products error:\", error);\n      res.status(500).json({ error: \"فشل جلب المنتجات\" });\n    }\n  });\n\n  app.get(\"/api/stripe/subscription\", async (req, res) => {\n    try {\n      const userId = req.query.userId as string;\n      if (!userId) {\n        return res.status(400).json({ error: \"userId مطلوب\" });\n      }\n\n      const user = await stripeService.getUser(userId);\n      if (!user?.stripeSubscriptionId) {\n        return res.json({ subscription: null });\n      }\n\n      const subscription = await stripeService.getSubscription(user.stripeSubscriptionId);\n      res.json({ subscription });\n    } catch (error) {\n      console.error(\"Get subscription error:\", error);\n      res.status(500).json({ error: \"فشل جلب الاشتراك\" });\n    }\n  });\n\n  app.post(\"/api/stripe/checkout\", async (req, res) => {\n    try {\n      const { userId, priceId } = req.body;\n      \n      if (!userId || !priceId) {\n        return res.status(400).json({ error: \"userId و priceId مطلوبان\" });\n      }\n\n      const user = await stripeService.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ error: \"المستخدم غير موجود\" });\n      }\n\n      let customerId = user.stripeCustomerId;\n      if (!customerId) {\n        const customer = await stripeService.createCustomer(user.email, user.id, user.fullName);\n        await stripeService.updateUserStripeInfo(user.id, { stripeCustomerId: customer.id });\n        customerId = customer.id;\n      }\n\n      const baseUrl = `${req.protocol}://${req.get('host')}`;\n      const session = await stripeService.createCheckoutSession(\n        customerId,\n        priceId,\n        `${baseUrl}/dashboard?subscription=success`,\n        `${baseUrl}/dashboard?subscription=cancelled`\n      );\n\n      res.json({ url: session.url });\n    } catch (error) {\n      console.error(\"Create checkout error:\", error);\n      res.status(500).json({ error: \"فشل إنشاء جلسة الدفع\" });\n    }\n  });\n\n  app.post(\"/api/stripe/portal\", async (req, res) => {\n    try {\n      const { userId } = req.body;\n      \n      if (!userId) {\n        return res.status(400).json({ error: \"userId مطلوب\" });\n      }\n\n      const user = await stripeService.getUser(userId);\n      if (!user?.stripeCustomerId) {\n        return res.status(400).json({ error: \"لا يوجد حساب Stripe مرتبط\" });\n      }\n\n      const baseUrl = `${req.protocol}://${req.get('host')}`;\n      const session = await stripeService.createCustomerPortalSession(\n        user.stripeCustomerId,\n        `${baseUrl}/dashboard`\n      );\n\n      res.json({ url: session.url });\n    } catch (error) {\n      console.error(\"Create portal error:\", error);\n      res.status(500).json({ error: \"فشل فتح بوابة الاشتراك\" });\n    }\n  });\n\n  // Analytics routes\n  app.get(\"/api/analytics/parent/:parentId\", async (req, res) => {\n    try {\n      const analytics = await storage.getParentAnalytics(req.params.parentId);\n      res.json(analytics);\n    } catch (error) {\n      console.error(\"Get parent analytics error:\", error);\n      res.status(500).json({ error: \"فشل جلب التحليلات\" });\n    }\n  });\n\n  app.get(\"/api/analytics/child/:childId\", async (req, res) => {\n    try {\n      const analytics = await storage.getChildAnalytics(req.params.childId);\n      res.json(analytics);\n    } catch (error) {\n      console.error(\"Get child analytics error:\", error);\n      res.status(500).json({ error: \"فشل جلب تحليلات الطفل\" });\n    }\n  });\n\n  // Learning session tracking\n  const startSessionSchema = z.object({\n    childId: z.string().min(1),\n    chapterId: z.string().min(1),\n    stage: z.enum([\"learn\", \"practice\", \"test\"]),\n  });\n\n  app.post(\"/api/sessions/start\", async (req, res) => {\n    try {\n      const data = startSessionSchema.parse(req.body);\n      const session = await storage.createLearningSession(data);\n      res.json(session);\n    } catch (error) {\n      console.error(\"Start session error:\", error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"بيانات غير صالحة\" });\n      }\n      res.status(500).json({ error: \"فشل بدء الجلسة\" });\n    }\n  });\n\n  const endSessionSchema = z.object({\n    durationSeconds: z.number().min(0),\n  });\n\n  app.post(\"/api/sessions/:id/end\", async (req, res) => {\n    try {\n      const data = endSessionSchema.parse(req.body);\n      await storage.endLearningSession(req.params.id, data.durationSeconds);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"End session error:\", error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"بيانات غير صالحة\" });\n      }\n      res.status(500).json({ error: \"فشل إنهاء الجلسة\" });\n    }\n  });\n\n  // Badge routes\n  app.get(\"/api/badges\", async (req, res) => {\n    try {\n      const badgesList = await storage.getAllBadges();\n      res.json(badgesList);\n    } catch (error) {\n      console.error(\"Get badges error:\", error);\n      res.status(500).json({ error: \"فشل جلب الشارات\" });\n    }\n  });\n\n  const childIdParamSchema = z.object({\n    id: z.string().min(1),\n  });\n\n  app.get(\"/api/children/:id/badges\", async (req, res) => {\n    try {\n      const { id } = childIdParamSchema.parse(req.params);\n      const child = await storage.getChildById(id);\n      if (!child) {\n        return res.status(404).json({ error: \"الطفل غير موجود\" });\n      }\n      const childBadgesList = await storage.getChildBadges(id);\n      res.json(childBadgesList);\n    } catch (error) {\n      console.error(\"Get child badges error:\", error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"معرف غير صالح\" });\n      }\n      res.status(500).json({ error: \"فشل جلب شارات الطفل\" });\n    }\n  });\n\n  app.post(\"/api/children/:id/check-badges\", async (req, res) => {\n    try {\n      const { id } = childIdParamSchema.parse(req.params);\n      const child = await storage.getChildById(id);\n      if (!child) {\n        return res.status(404).json({ error: \"الطفل غير موجود\" });\n      }\n      const newBadges = await storage.checkAndAwardBadges(id);\n      res.json(newBadges);\n    } catch (error) {\n      console.error(\"Check badges error:\", error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"معرف غير صالح\" });\n      }\n      res.status(500).json({ error: \"فشل التحقق من الشارات\" });\n    }\n  });\n\n  const parentIdParamSchema = z.object({\n    id: z.string().min(1),\n  });\n\n  app.get(\"/api/parents/:id/leaderboard\", async (req, res) => {\n    try {\n      const { id } = parentIdParamSchema.parse(req.params);\n      const parent = await storage.getUserById(id);\n      if (!parent) {\n        return res.status(404).json({ error: \"المستخدم غير موجود\" });\n      }\n      const leaderboard = await storage.getSiblingLeaderboard(id);\n      res.json(leaderboard);\n    } catch (error) {\n      console.error(\"Get leaderboard error:\", error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"معرف غير صالح\" });\n      }\n      res.status(500).json({ error: \"فشل جلب لوحة المتصدرين\" });\n    }\n  });\n\n  // Notification routes\n  const userIdParamSchema = z.object({\n    userId: z.string().min(1),\n  });\n\n  app.get(\"/api/users/:userId/notifications\", async (req, res) => {\n    try {\n      const { userId } = userIdParamSchema.parse(req.params);\n      const user = await storage.getUserById(userId);\n      if (!user) {\n        return res.status(404).json({ error: \"المستخدم غير موجود\" });\n      }\n      const notificationsList = await storage.getNotificationsByUser(userId);\n      res.json(notificationsList);\n    } catch (error) {\n      console.error(\"Get notifications error:\", error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"معرف غير صالح\" });\n      }\n      res.status(500).json({ error: \"فشل جلب الإشعارات\" });\n    }\n  });\n\n  app.get(\"/api/users/:userId/notifications/unread-count\", async (req, res) => {\n    try {\n      const { userId } = userIdParamSchema.parse(req.params);\n      const user = await storage.getUserById(userId);\n      if (!user) {\n        return res.status(404).json({ error: \"المستخدم غير موجود\" });\n      }\n      const count = await storage.getUnreadCount(userId);\n      res.json({ count });\n    } catch (error) {\n      console.error(\"Get unread count error:\", error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"معرف غير صالح\" });\n      }\n      res.status(500).json({ error: \"فشل جلب عدد الإشعارات\" });\n    }\n  });\n\n  const notificationIdParamSchema = z.object({\n    id: z.string().min(1),\n  });\n\n  app.patch(\"/api/notifications/:id/read\", async (req, res) => {\n    try {\n      const { id } = notificationIdParamSchema.parse(req.params);\n      await storage.markNotificationRead(id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Mark notification read error:\", error);\n      res.status(500).json({ error: \"فشل تحديث الإشعار\" });\n    }\n  });\n\n  app.patch(\"/api/users/:userId/notifications/read-all\", async (req, res) => {\n    try {\n      const { userId } = userIdParamSchema.parse(req.params);\n      await storage.markAllNotificationsRead(userId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Mark all read error:\", error);\n      res.status(500).json({ error: \"فشل تحديث الإشعارات\" });\n    }\n  });\n\n  const notificationPreferencesSchema = z.object({\n    chapterComplete: z.boolean().default(true),\n    badgeEarned: z.boolean().default(true),\n    weeklyReport: z.boolean().default(true),\n    streakReminder: z.boolean().default(false),\n  });\n\n  app.get(\"/api/users/:userId/notification-preferences\", async (req, res) => {\n    try {\n      const { userId } = userIdParamSchema.parse(req.params);\n      const preferences = await storage.getNotificationPreferences(userId);\n      res.json(preferences || { chapterComplete: true, badgeEarned: true, weeklyReport: true, streakReminder: false });\n    } catch (error) {\n      console.error(\"Get preferences error:\", error);\n      res.status(500).json({ error: \"فشل جلب الإعدادات\" });\n    }\n  });\n\n  app.patch(\"/api/users/:userId/notification-preferences\", async (req, res) => {\n    try {\n      const { userId } = userIdParamSchema.parse(req.params);\n      const preferences = notificationPreferencesSchema.parse(req.body);\n      const user = await storage.getUserById(userId);\n      if (!user) {\n        return res.status(404).json({ error: \"المستخدم غير موجود\" });\n      }\n      await storage.updateNotificationPreferences(userId, preferences);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Update preferences error:\", error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"بيانات غير صالحة\" });\n      }\n      res.status(500).json({ error: \"فشل تحديث الإعدادات\" });\n    }\n  });\n\n  // ============= Sample Chapters / Content Library Routes =============\n  \n  const sampleChaptersQuerySchema = z.object({\n    subject: z.string().optional(),\n    grade: z.string().regex(/^\\d+$/, \"يجب أن يكون الصف رقماً\").optional(),\n  });\n\n  app.get(\"/api/sample-chapters\", async (req, res) => {\n    try {\n      const parseResult = sampleChaptersQuerySchema.safeParse(req.query);\n      if (!parseResult.success) {\n        return res.status(400).json({ error: \"معايير البحث غير صالحة\" });\n      }\n      \n      const { subject, grade } = parseResult.data;\n      \n      let samples = await storage.getSampleChapters();\n      \n      if (subject) {\n        samples = samples.filter(s => s.subject === subject);\n      }\n      \n      if (grade) {\n        const gradeNum = parseInt(grade, 10);\n        samples = samples.filter(s => s.grade === gradeNum);\n      }\n      \n      res.json(samples);\n    } catch (error) {\n      console.error(\"Get sample chapters error:\", error);\n      res.status(500).json({ error: \"فشل جلب المحتوى التعليمي\" });\n    }\n  });\n\n  const sampleChapterIdSchema = z.object({\n    sampleId: z.string().min(1),\n  });\n\n  app.get(\"/api/sample-chapters/:sampleId\", async (req, res) => {\n    try {\n      const { sampleId } = sampleChapterIdSchema.parse(req.params);\n      const sample = await storage.getSampleChapterById(sampleId);\n      \n      if (!sample) {\n        return res.status(404).json({ error: \"الفصل غير موجود\" });\n      }\n      \n      res.json(sample);\n    } catch (error) {\n      console.error(\"Get sample chapter error:\", error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"معرف غير صالح\" });\n      }\n      res.status(500).json({ error: \"فشل جلب الفصل\" });\n    }\n  });\n\n  const assignSampleChapterSchema = z.object({\n    childId: z.string().min(1),\n    parentId: z.string().min(1),\n  });\n\n  app.post(\"/api/sample-chapters/:sampleId/assign\", async (req, res) => {\n    try {\n      const { sampleId } = sampleChapterIdSchema.parse(req.params);\n      const { childId, parentId } = assignSampleChapterSchema.parse(req.body);\n      \n      const sample = await storage.getSampleChapterById(sampleId);\n      if (!sample) {\n        return res.status(404).json({ error: \"الفصل غير موجود\" });\n      }\n      \n      const child = await storage.getChildById(childId);\n      if (!child || child.parentId !== parentId) {\n        return res.status(403).json({ error: \"ليس لديك صلاحية لهذا الطفل\" });\n      }\n      \n      const chapter = await storage.assignSampleChapterToChild(sampleId, childId, parentId);\n      res.json(chapter);\n    } catch (error) {\n      console.error(\"Assign sample chapter error:\", error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"بيانات غير صالحة\" });\n      }\n      res.status(500).json({ error: \"فشل إسناد الفصل\" });\n    }\n  });\n}\n","path":null,"size_bytes":25322,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 0 0% 100%;\n  --foreground: 222 47% 11%;\n  --border: 220 13% 91%;\n  --card: 0 0% 98%;\n  --card-foreground: 222 47% 11%;\n  --card-border: 220 13% 95%;\n  --sidebar: 220 14% 96%;\n  --sidebar-foreground: 222 47% 11%;\n  --sidebar-border: 220 13% 92%;\n  --sidebar-primary: 217 91% 60%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 220 14% 91%;\n  --sidebar-accent-foreground: 222 47% 11%;\n  --sidebar-ring: 217 91% 60%;\n  --popover: 220 14% 94%;\n  --popover-foreground: 222 47% 11%;\n  --popover-border: 220 13% 90%;\n  --primary: 217 91% 60%;\n  --primary-foreground: 0 0% 100%;\n  --secondary: 220 14% 89%;\n  --secondary-foreground: 222 47% 11%;\n  --muted: 220 14% 92%;\n  --muted-foreground: 215 16% 47%;\n  --accent: 220 13% 93%;\n  --accent-foreground: 222 47% 11%;\n  --destructive: 0 84% 60%;\n  --destructive-foreground: 0 0% 100%;\n  --input: 215 20% 65%;\n  --ring: 217 91% 60%;\n  --chart-1: 217 91% 60%;\n  --chart-2: 142 76% 36%;\n  --chart-3: 38 92% 50%;\n  --chart-4: 262 83% 58%;\n  --chart-5: 173 58% 39%;\n  --font-sans: Cairo, Inter, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(220 13% 91% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(220 13% 91% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(220 13% 91% / 0.00), 0px 1px 2px -1px hsl(220 13% 91% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(220 13% 91% / 0.00), 0px 1px 2px -1px hsl(220 13% 91% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(220 13% 91% / 0.00), 0px 2px 4px -1px hsl(220 13% 91% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(220 13% 91% / 0.00), 0px 4px 6px -1px hsl(220 13% 91% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(220 13% 91% / 0.00), 0px 8px 10px -1px hsl(220 13% 91% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(220 13% 91% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 222 47% 11%;\n  --foreground: 0 0% 98%;\n  --border: 215 16% 22%;\n  --card: 220 13% 13%;\n  --card-foreground: 0 0% 98%;\n  --card-border: 215 16% 17%;\n  --sidebar: 220 14% 15%;\n  --sidebar-foreground: 0 0% 98%;\n  --sidebar-border: 215 16% 19%;\n  --sidebar-primary: 217 91% 60%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 220 14% 18%;\n  --sidebar-accent-foreground: 0 0% 98%;\n  --sidebar-ring: 217 91% 60%;\n  --popover: 220 14% 17%;\n  --popover-foreground: 0 0% 98%;\n  --popover-border: 215 16% 21%;\n  --primary: 217 91% 60%;\n  --primary-foreground: 0 0% 100%;\n  --secondary: 220 14% 20%;\n  --secondary-foreground: 0 0% 98%;\n  --muted: 220 14% 19%;\n  --muted-foreground: 215 16% 65%;\n  --accent: 220 13% 18%;\n  --accent-foreground: 0 0% 98%;\n  --destructive: 0 84% 60%;\n  --destructive-foreground: 0 0% 100%;\n  --input: 215 20% 40%;\n  --ring: 217 91% 60%;\n  --chart-1: 217 91% 75%;\n  --chart-2: 142 76% 65%;\n  --chart-3: 38 92% 70%;\n  --chart-4: 262 83% 75%;\n  --chart-5: 173 58% 65%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(215 16% 22% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(215 16% 22% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(215 16% 22% / 0.00), 0px 1px 2px -1px hsl(215 16% 22% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(215 16% 22% / 0.00), 0px 1px 2px -1px hsl(215 16% 22% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(215 16% 22% / 0.00), 0px 2px 4px -1px hsl(215 16% 22% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(215 16% 22% / 0.00), 0px 4px 6px -1px hsl(215 16% 22% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(215 16% 22% / 0.00), 0px 8px 10px -1px hsl(215 16% 22% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(215 16% 22% / 0.00);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","path":null,"size_bytes":10746,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/pages/learn-stage.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useParams, useLocation, Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ArrowRight, ArrowLeft, BookOpen, Sparkles, Volume2, VolumeX, Pause, Play, Square } from \"lucide-react\";\nimport { useSpeech } from \"@/hooks/use-speech\";\nimport type { Chapter } from \"@shared/schema\";\n\nexport default function LearnStage() {\n  const { id } = useParams<{ id: string }>();\n  const [, setLocation] = useLocation();\n  const [currentParagraph, setCurrentParagraph] = useState(0);\n  const [autoNarrate, setAutoNarrate] = useState(false);\n\n  const { speak, stop, pause, resume, isSpeaking, isPaused, isSupported } = useSpeech({\n    lang: \"ar-SA\",\n    rate: 0.85,\n  });\n\n  const { data: chapter, isLoading } = useQuery<Chapter>({\n    queryKey: [\"/api/chapters\", id],\n    enabled: !!id,\n  });\n\n  const content = chapter?.content;\n  const paragraphs = content?.explanation.paragraphs || [];\n  const progress = paragraphs.length > 0 ? ((currentParagraph + 1) / paragraphs.length) * 100 : 0;\n\n  useEffect(() => {\n    if (autoNarrate && paragraphs[currentParagraph]) {\n      speak(paragraphs[currentParagraph]);\n    }\n  }, [currentParagraph, autoNarrate, paragraphs, speak]);\n\n  useEffect(() => {\n    return () => stop();\n  }, [stop]);\n\n  const handlePlayPause = () => {\n    if (isSpeaking && !isPaused) {\n      pause();\n    } else if (isPaused) {\n      resume();\n    } else {\n      speak(paragraphs[currentParagraph]);\n    }\n  };\n\n  const handleStop = () => {\n    stop();\n  };\n\n  const toggleAutoNarrate = () => {\n    if (autoNarrate) {\n      stop();\n      setAutoNarrate(false);\n    } else {\n      setAutoNarrate(true);\n      speak(paragraphs[currentParagraph]);\n    }\n  };\n\n  const handleNext = () => {\n    stop();\n    if (currentParagraph < paragraphs.length - 1) {\n      setCurrentParagraph(prev => prev + 1);\n    } else {\n      setLocation(`/child/chapter/${id}/practice`);\n    }\n  };\n\n  const handlePrev = () => {\n    stop();\n    if (currentParagraph > 0) {\n      setCurrentParagraph(prev => prev - 1);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50\" dir=\"rtl\">\n        <div className=\"max-w-2xl mx-auto p-6 pt-20\">\n          <Skeleton className=\"h-3 w-full mb-8\" />\n          <Skeleton className=\"h-64 w-full rounded-2xl\" />\n        </div>\n      </div>\n    );\n  }\n\n  if (!chapter || !content) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center\" dir=\"rtl\">\n        <Card className=\"text-center p-8\">\n          <BookOpen className=\"w-16 h-16 mx-auto text-gray-400 mb-4\" />\n          <h2 className=\"text-xl font-child font-bold mb-2\">الدرس غير موجود</h2>\n          <Link href=\"/\">\n            <Button className=\"font-arabic\">العودة</Button>\n          </Link>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex flex-col\" dir=\"rtl\">\n      <header className=\"bg-white/80 backdrop-blur-sm border-b sticky top-0 z-50\">\n        <div className=\"max-w-2xl mx-auto px-4\">\n          <div className=\"flex items-center h-16 gap-4\">\n            <Link href={`/child/chapter/${id}`}>\n              <Button variant=\"ghost\" size=\"icon\" className=\"rounded-xl\">\n                <ArrowRight className=\"w-6 h-6\" />\n              </Button>\n            </Link>\n            <div className=\"flex-1\">\n              <h1 className=\"font-child font-bold text-lg\">{content.topic}</h1>\n              <p className=\"text-xs text-muted-foreground font-arabic\">\n                {currentParagraph + 1} من {paragraphs.length}\n              </p>\n            </div>\n            <div className=\"flex items-center gap-2 bg-blue-100 px-3 py-1.5 rounded-full\">\n              <BookOpen className=\"w-4 h-4 text-blue-600\" />\n              <span className=\"text-sm font-child font-bold text-blue-700\">تعلّم</span>\n            </div>\n            {isSupported && (\n              <Button\n                variant={autoNarrate ? \"default\" : \"outline\"}\n                size=\"icon\"\n                onClick={toggleAutoNarrate}\n                className=\"rounded-xl\"\n                data-testid=\"button-toggle-narration\"\n                title={autoNarrate ? \"إيقاف القراءة التلقائية\" : \"تفعيل القراءة التلقائية\"}\n              >\n                {autoNarrate ? <Volume2 className=\"w-5 h-5\" /> : <VolumeX className=\"w-5 h-5\" />}\n              </Button>\n            )}\n          </div>\n          <Progress value={progress} className=\"h-2 mb-2\" />\n        </div>\n      </header>\n\n      <main className=\"flex-1 flex flex-col max-w-2xl mx-auto w-full px-4 py-8\">\n        <Card className=\"flex-1 flex flex-col shadow-lg border-0 bg-white/90 backdrop-blur-sm\">\n          <CardContent className=\"flex-1 flex flex-col p-8\">\n            <div className=\"flex-1 flex items-center justify-center\">\n              <p \n                className=\"text-2xl font-arabic leading-loose text-gray-800 text-center animate-slide-up\"\n                key={currentParagraph}\n                data-testid={`text-paragraph-${currentParagraph}`}\n              >\n                {paragraphs[currentParagraph]}\n              </p>\n            </div>\n\n            {isSupported && (\n              <div className=\"flex items-center justify-center gap-3 pt-4 border-t border-gray-100\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={handlePlayPause}\n                  className=\"rounded-full bg-blue-50 text-blue-600 hover:bg-blue-100\"\n                  data-testid=\"button-play-pause\"\n                  title={isSpeaking && !isPaused ? \"إيقاف مؤقت\" : \"تشغيل\"}\n                >\n                  {isSpeaking && !isPaused ? (\n                    <Pause className=\"w-5 h-5\" />\n                  ) : (\n                    <Play className=\"w-5 h-5\" />\n                  )}\n                </Button>\n                {isSpeaking && (\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    onClick={handleStop}\n                    className=\"rounded-full bg-red-50 text-red-600 hover:bg-red-100\"\n                    data-testid=\"button-stop\"\n                    title=\"إيقاف\"\n                  >\n                    <Square className=\"w-4 h-4\" />\n                  </Button>\n                )}\n                <span className=\"text-sm font-arabic text-muted-foreground\">\n                  {isSpeaking \n                    ? isPaused \n                      ? \"متوقف مؤقتاً\" \n                      : \"جارٍ القراءة...\" \n                    : \"اضغط للاستماع\"}\n                </span>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <div className=\"flex items-center justify-between gap-4 mt-6\">\n          <Button\n            variant=\"outline\"\n            size=\"lg\"\n            onClick={handlePrev}\n            disabled={currentParagraph === 0}\n            className=\"h-14 px-6 font-child font-bold rounded-xl\"\n            data-testid=\"button-prev\"\n          >\n            <ArrowRight className=\"w-5 h-5 ml-2\" />\n            السابق\n          </Button>\n\n          <div className=\"flex items-center gap-2\">\n            {paragraphs.map((_, i) => (\n              <div\n                key={i}\n                className={`w-2.5 h-2.5 rounded-full transition-colors ${\n                  i === currentParagraph \n                    ? \"bg-blue-600\" \n                    : i < currentParagraph \n                      ? \"bg-blue-300\" \n                      : \"bg-gray-200\"\n                }`}\n              />\n            ))}\n          </div>\n\n          <Button\n            size=\"lg\"\n            onClick={handleNext}\n            className=\"h-14 px-6 font-child font-bold rounded-xl bg-gradient-to-r from-blue-500 to-blue-600\"\n            data-testid=\"button-next\"\n          >\n            {currentParagraph === paragraphs.length - 1 ? (\n              <>\n                <Sparkles className=\"w-5 h-5 ml-2\" />\n                ابدأ التمرين\n              </>\n            ) : (\n              <>\n                التالي\n                <ArrowLeft className=\"w-5 h-5 mr-2\" />\n              </>\n            )}\n          </Button>\n        </div>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":8702,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/pages/report.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useParams, Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { \n  ArrowRight, \n  Star, \n  CheckCircle, \n  XCircle, \n  Clock, \n  TrendingUp,\n  AlertTriangle,\n  BookOpen,\n  RefreshCw,\n  Download,\n  Loader2\n} from \"lucide-react\";\nimport { exportReportToPDF } from \"@/lib/pdf-export\";\nimport type { ChapterResult, Chapter, Child } from \"@shared/schema\";\n\nfunction CircularProgress({ value, size = 120, strokeWidth = 10 }: { value: number; size?: number; strokeWidth?: number }) {\n  const radius = (size - strokeWidth) / 2;\n  const circumference = radius * 2 * Math.PI;\n  const offset = circumference - (value / 100) * circumference;\n\n  return (\n    <div className=\"relative inline-flex items-center justify-center\">\n      <svg width={size} height={size} className=\"-rotate-90\">\n        <circle\n          cx={size / 2}\n          cy={size / 2}\n          r={radius}\n          fill=\"none\"\n          stroke=\"hsl(var(--muted))\"\n          strokeWidth={strokeWidth}\n        />\n        <circle\n          cx={size / 2}\n          cy={size / 2}\n          r={radius}\n          fill=\"none\"\n          stroke=\"hsl(var(--primary))\"\n          strokeWidth={strokeWidth}\n          strokeDasharray={circumference}\n          strokeDashoffset={offset}\n          strokeLinecap=\"round\"\n          className=\"transition-all duration-1000 ease-out\"\n        />\n      </svg>\n      <div className=\"absolute inset-0 flex flex-col items-center justify-center\">\n        <span className=\"text-3xl font-bold\">{Math.round(value)}%</span>\n        <span className=\"text-sm text-muted-foreground font-arabic\">النتيجة</span>\n      </div>\n    </div>\n  );\n}\n\nexport default function ReportPage() {\n  const { resultId } = useParams<{ resultId: string }>();\n  const [isExporting, setIsExporting] = useState(false);\n\n  const { data: result, isLoading: loadingResult } = useQuery<ChapterResult>({\n    queryKey: [\"/api/results\", resultId],\n    enabled: !!resultId,\n  });\n\n  const { data: chapter } = useQuery<Chapter>({\n    queryKey: [\"/api/chapters\", result?.chapterId],\n    enabled: !!result?.chapterId,\n  });\n\n  const { data: child } = useQuery<Child>({\n    queryKey: [\"/api/children\", result?.childId],\n    enabled: !!result?.childId,\n  });\n\n  const handleExportPDF = async () => {\n    if (!result || !chapter) return;\n    \n    setIsExporting(true);\n    try {\n      await exportReportToPDF({ result, chapter, child });\n    } catch (error) {\n      console.error(\"Failed to export PDF:\", error);\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  if (loadingResult || !result) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\" dir=\"rtl\">\n        <p className=\"font-arabic text-muted-foreground\">جاري التحميل...</p>\n      </div>\n    );\n  }\n\n  const percentage = Math.round((result.totalScore! / 15) * 100);\n  const practiceQuestions = chapter?.content?.practice || [];\n  const testQuestions = chapter?.content?.test || [];\n  const answers = result.answers as { practiceAnswers: string[]; testAnswers: string[] } | null;\n\n  const practiceResults = practiceQuestions.map((q, i) => ({\n    question: q.question,\n    correct: q.correct,\n    answered: answers?.practiceAnswers?.[i] || \"\",\n    isCorrect: answers?.practiceAnswers?.[i] === q.correct,\n  }));\n\n  const testResults = testQuestions.map((q, i) => ({\n    question: q.question,\n    correct: q.correct,\n    answered: answers?.testAnswers?.[i] || \"\",\n    isCorrect: answers?.testAnswers?.[i] === q.correct,\n  }));\n\n  const strengths = [...practiceResults, ...testResults].filter(r => r.isCorrect);\n  const weaknesses = [...practiceResults, ...testResults].filter(r => !r.isCorrect);\n\n  const timeMinutes = Math.floor((result.timeSpentSeconds || 0) / 60);\n  const timeSeconds = (result.timeSpentSeconds || 0) % 60;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\" dir=\"rtl\">\n      <header className=\"bg-white border-b sticky top-0 z-50\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16 gap-4\">\n            <div className=\"flex items-center gap-4\">\n              <Link href=\"/\">\n                <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n                  <ArrowRight className=\"w-5 h-5\" />\n                </Button>\n              </Link>\n              <div>\n                <h1 className=\"font-bold font-arabic\">تقرير الأداء</h1>\n                <p className=\"text-xs text-muted-foreground font-arabic\">{chapter?.title}</p>\n              </div>\n            </div>\n            <Button \n              variant=\"outline\" \n              onClick={handleExportPDF}\n              disabled={isExporting || !chapter}\n              className=\"font-arabic gap-2\"\n              data-testid=\"button-export-pdf\"\n            >\n              {isExporting ? (\n                <Loader2 className=\"w-4 h-4 animate-spin\" />\n              ) : (\n                <Download className=\"w-4 h-4\" />\n              )}\n              تحميل PDF\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\n          <Card className=\"md:col-span-1\">\n            <CardContent className=\"p-6 flex flex-col items-center justify-center\">\n              <CircularProgress value={percentage} />\n              <div className=\"flex items-center gap-1 mt-4\">\n                {Array.from({ length: 5 }).map((_, i) => (\n                  <Star \n                    key={i} \n                    className={`w-6 h-6 ${i < (result.stars || 0) ? \"text-amber-400 fill-amber-400\" : \"text-gray-200\"}`}\n                  />\n                ))}\n              </div>\n              <p className=\"font-arabic text-muted-foreground mt-2\">\n                {result.totalScore}/15 نقطة\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"md:col-span-2\">\n            <CardHeader>\n              <CardTitle className=\"font-arabic text-lg\">ملخص النتائج</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div>\n                <div className=\"flex items-center justify-between mb-2\">\n                  <span className=\"font-arabic\">التمرين (5 أسئلة)</span>\n                  <Badge variant=\"secondary\">{result.practiceScore}/5</Badge>\n                </div>\n                <Progress value={((result.practiceScore || 0) / 5) * 100} className=\"h-2\" />\n              </div>\n              <div>\n                <div className=\"flex items-center justify-between mb-2\">\n                  <span className=\"font-arabic\">الاختبار (10 أسئلة)</span>\n                  <Badge variant=\"secondary\">{result.testScore}/10</Badge>\n                </div>\n                <Progress value={((result.testScore || 0) / 10) * 100} className=\"h-2\" />\n              </div>\n              <div className=\"flex items-center gap-4 pt-4 border-t\">\n                <div className=\"flex items-center gap-2 text-muted-foreground\">\n                  <Clock className=\"w-4 h-4\" />\n                  <span className=\"font-arabic text-sm\">\n                    {timeMinutes > 0 ? `${timeMinutes} دقيقة و ` : \"\"}{timeSeconds} ثانية\n                  </span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"font-arabic text-lg flex items-center gap-2 text-green-700\">\n                <CheckCircle className=\"w-5 h-5\" />\n                نقاط القوة ({strengths.length})\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {strengths.length === 0 ? (\n                <p className=\"text-muted-foreground font-arabic text-center py-4\">لا توجد إجابات صحيحة</p>\n              ) : (\n                <ul className=\"space-y-2\">\n                  {strengths.slice(0, 5).map((item, i) => (\n                    <li key={i} className=\"flex items-start gap-2 text-sm\">\n                      <CheckCircle className=\"w-4 h-4 text-green-500 mt-0.5 shrink-0\" />\n                      <span className=\"font-arabic text-gray-700 line-clamp-2\">{item.question}</span>\n                    </li>\n                  ))}\n                </ul>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"font-arabic text-lg flex items-center gap-2 text-amber-700\">\n                <AlertTriangle className=\"w-5 h-5\" />\n                يحتاج تحسين ({weaknesses.length})\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {weaknesses.length === 0 ? (\n                <p className=\"text-green-600 font-arabic text-center py-4\">ممتاز! كل الإجابات صحيحة</p>\n              ) : (\n                <ul className=\"space-y-2\">\n                  {weaknesses.slice(0, 5).map((item, i) => (\n                    <li key={i} className=\"flex items-start gap-2 text-sm\">\n                      <XCircle className=\"w-4 h-4 text-red-500 mt-0.5 shrink-0\" />\n                      <span className=\"font-arabic text-gray-700 line-clamp-2\">{item.question}</span>\n                    </li>\n                  ))}\n                </ul>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n\n        {weaknesses.length > 0 && (\n          <Card className=\"mb-8 bg-gradient-to-br from-blue-50 to-emerald-50 border-blue-200\">\n            <CardHeader>\n              <CardTitle className=\"font-arabic text-lg flex items-center gap-2 text-blue-800\">\n                <TrendingUp className=\"w-5 h-5\" />\n                توصيات للتحسين\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <ul className=\"space-y-3 font-arabic text-blue-900\">\n                <li className=\"flex items-start gap-2\">\n                  <span className=\"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center text-sm shrink-0\">1</span>\n                  راجع الأسئلة التي أخطأت فيها وحاول فهم السبب\n                </li>\n                <li className=\"flex items-start gap-2\">\n                  <span className=\"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center text-sm shrink-0\">2</span>\n                  أعد قراءة الشرح وركز على النقاط الصعبة\n                </li>\n                <li className=\"flex items-start gap-2\">\n                  <span className=\"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center text-sm shrink-0\">3</span>\n                  حاول الاختبار مرة أخرى بعد المراجعة\n                </li>\n              </ul>\n            </CardContent>\n          </Card>\n        )}\n\n        <div className=\"flex flex-col sm:flex-row gap-4\">\n          <Link href={`/child/chapter/${result.chapterId}/learn`} className=\"flex-1\">\n            <Button variant=\"outline\" size=\"lg\" className=\"w-full font-arabic gap-2\">\n              <RefreshCw className=\"w-5 h-5\" />\n              إعادة الفصل\n            </Button>\n          </Link>\n          <Link href=\"/\" className=\"flex-1\">\n            <Button size=\"lg\" className=\"w-full font-arabic gap-2\">\n              <BookOpen className=\"w-5 h-5\" />\n              العودة للرئيسية\n            </Button>\n          </Link>\n        </div>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":11967,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/pages/processing.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation, useParams, Link } from \"wouter\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { \n  Loader2, \n  Sparkles, \n  BookOpen, \n  CheckCircle,\n  ArrowRight,\n  Brain,\n  FileText,\n  ClipboardCheck\n} from \"lucide-react\";\nimport type { Chapter } from \"@shared/schema\";\n\nconst processingSteps = [\n  { icon: FileText, label: \"تحليل الصور\", description: \"قراءة محتوى الصفحات\" },\n  { icon: Brain, label: \"فهم المحتوى\", description: \"استخراج المفاهيم الأساسية\" },\n  { icon: Sparkles, label: \"إنشاء الشرح\", description: \"تبسيط المحتوى للأطفال\" },\n  { icon: ClipboardCheck, label: \"إنشاء الأسئلة\", description: \"تحضير تمارين واختبار\" },\n];\n\nconst didYouKnow = [\n  \"الدماغ البشري يستطيع تخزين 2.5 بيتابايت من المعلومات!\",\n  \"النحل يستطيع التعرف على الوجوه البشرية!\",\n  \"القلب ينبض حوالي 100,000 مرة في اليوم!\",\n  \"الضوء يسافر بسرعة 300,000 كيلومتر في الثانية!\",\n  \"الماء يغطي 71% من سطح الأرض!\",\n];\n\nexport default function ProcessingPage() {\n  const { id } = useParams<{ id: string }>();\n  const [, setLocation] = useLocation();\n  const [currentStep, setCurrentStep] = useState(0);\n  const [progress, setProgress] = useState(0);\n  const [fact, setFact] = useState(didYouKnow[0]);\n\n  const { data: chapter } = useQuery<Chapter>({\n    queryKey: [\"/api/chapters\", id],\n    refetchInterval: 2000,\n    enabled: !!id,\n  });\n\n  useEffect(() => {\n    if (chapter?.status === \"ready\" || chapter?.status === \"completed\") {\n      setLocation(`/chapter/${id}`);\n    }\n  }, [chapter?.status, id, setLocation]);\n\n  useEffect(() => {\n    const stepInterval = setInterval(() => {\n      setCurrentStep(prev => (prev + 1) % processingSteps.length);\n    }, 4000);\n\n    const progressInterval = setInterval(() => {\n      setProgress(prev => {\n        if (prev >= 95) return 95;\n        return prev + Math.random() * 3;\n      });\n    }, 500);\n\n    const factInterval = setInterval(() => {\n      setFact(didYouKnow[Math.floor(Math.random() * didYouKnow.length)]);\n    }, 6000);\n\n    return () => {\n      clearInterval(stepInterval);\n      clearInterval(progressInterval);\n      clearInterval(factInterval);\n    };\n  }, []);\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-emerald-50\" dir=\"rtl\">\n      <header className=\"bg-white/80 backdrop-blur-sm border-b sticky top-0 z-50\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center h-16 gap-4\">\n            <Link href=\"/\">\n              <Button variant=\"ghost\" size=\"icon\">\n                <ArrowRight className=\"w-5 h-5\" />\n              </Button>\n            </Link>\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 bg-gradient-to-br from-blue-500 to-emerald-500 rounded-xl flex items-center justify-center\">\n                <BookOpen className=\"w-5 h-5 text-white\" />\n              </div>\n              <div>\n                <h1 className=\"font-bold font-arabic\">جاري المعالجة</h1>\n                <p className=\"text-xs text-muted-foreground font-arabic\">يتم تحضير الفصل...</p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-2xl mx-auto px-4 py-16\">\n        <div className=\"text-center mb-12\">\n          <div className=\"w-24 h-24 bg-gradient-to-br from-blue-500 to-emerald-500 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg animate-pulse-glow\">\n            <Loader2 className=\"w-12 h-12 text-white animate-spin\" />\n          </div>\n          <h1 className=\"text-3xl font-bold font-arabic mb-3\">\n            جاري تحضير الفصل\n          </h1>\n          <p className=\"text-muted-foreground font-arabic text-lg\">\n            الذكاء الاصطناعي يعمل على إنشاء محتوى تعليمي مميز\n          </p>\n        </div>\n\n        <Card className=\"mb-8\">\n          <CardContent className=\"py-6\">\n            <div className=\"mb-4\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"font-arabic text-sm text-muted-foreground\">التقدم</span>\n                <span className=\"font-arabic text-sm font-medium\">{Math.round(progress)}%</span>\n              </div>\n              <Progress value={progress} className=\"h-3\" />\n            </div>\n\n            <div className=\"space-y-4 mt-6\">\n              {processingSteps.map((step, index) => (\n                <div \n                  key={index} \n                  className={`flex items-center gap-4 p-3 rounded-lg transition-all duration-300 ${\n                    index === currentStep \n                      ? \"bg-primary/10 scale-[1.02]\" \n                      : index < currentStep \n                        ? \"opacity-50\" \n                        : \"opacity-30\"\n                  }`}\n                >\n                  <div className={`w-10 h-10 rounded-lg flex items-center justify-center transition-colors ${\n                    index === currentStep \n                      ? \"bg-primary text-white\" \n                      : index < currentStep \n                        ? \"bg-green-100 text-green-600\" \n                        : \"bg-muted text-muted-foreground\"\n                  }`}>\n                    {index < currentStep ? (\n                      <CheckCircle className=\"w-5 h-5\" />\n                    ) : (\n                      <step.icon className=\"w-5 h-5\" />\n                    )}\n                  </div>\n                  <div>\n                    <p className=\"font-arabic font-medium\">{step.label}</p>\n                    <p className=\"text-sm text-muted-foreground font-arabic\">{step.description}</p>\n                  </div>\n                  {index === currentStep && (\n                    <Loader2 className=\"w-5 h-5 text-primary animate-spin mr-auto\" />\n                  )}\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-gradient-to-br from-amber-50 to-orange-50 border-amber-200\">\n          <CardContent className=\"py-6\">\n            <div className=\"flex items-start gap-4\">\n              <div className=\"w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center shrink-0\">\n                <Sparkles className=\"w-6 h-6 text-amber-600\" />\n              </div>\n              <div>\n                <h3 className=\"font-bold font-arabic text-amber-800 mb-1\">هل تعلم؟</h3>\n                <p className=\"font-arabic text-amber-700 animate-slide-up\" key={fact}>\n                  {fact}\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <p className=\"text-center text-muted-foreground font-arabic mt-8 text-sm\">\n          المعالجة تستغرق عادة 30-60 ثانية\n        </p>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":7319,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, timestamp, jsonb, boolean } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Notification preferences type\nexport const notificationPreferencesSchema = z.object({\n  chapterComplete: z.boolean().default(true),\n  badgeEarned: z.boolean().default(true),\n  weeklyReport: z.boolean().default(true),\n  streakReminder: z.boolean().default(false),\n});\nexport type NotificationPreferences = z.infer<typeof notificationPreferencesSchema>;\n\n// Users (Parents)\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\", { length: 36 }).primaryKey().default(sql`gen_random_uuid()`),\n  email: text(\"email\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  fullName: text(\"full_name\").notNull(),\n  subscriptionTier: text(\"subscription_tier\").default(\"free\"),\n  subscriptionStatus: text(\"subscription_status\").default(\"active\"),\n  stripeCustomerId: text(\"stripe_customer_id\"),\n  stripeSubscriptionId: text(\"stripe_subscription_id\"),\n  notificationPreferences: jsonb(\"notification_preferences\").$type<NotificationPreferences>().default({ chapterComplete: true, badgeEarned: true, weeklyReport: true, streakReminder: false }),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  email: true,\n  password: true,\n  fullName: true,\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\n// Children\nexport const children = pgTable(\"children\", {\n  id: varchar(\"id\", { length: 36 }).primaryKey().default(sql`gen_random_uuid()`),\n  parentId: varchar(\"parent_id\", { length: 36 }).notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  name: text(\"name\").notNull(),\n  age: integer(\"age\").notNull(),\n  avatarUrl: text(\"avatar_url\"),\n  totalStars: integer(\"total_stars\").default(0),\n  streak: integer(\"streak\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertChildSchema = createInsertSchema(children).pick({\n  parentId: true,\n  name: true,\n  age: true,\n  avatarUrl: true,\n});\n\nexport type InsertChild = z.infer<typeof insertChildSchema>;\nexport type Child = typeof children.$inferSelect;\n\n// Chapter Content Types\nexport const questionSchema = z.object({\n  question: z.string(),\n  options: z.array(z.string()).length(4),\n  correct: z.enum([\"A\", \"B\", \"C\", \"D\"]),\n  difficulty: z.enum([\"easy\", \"medium\", \"hard\"]),\n});\n\nexport const chapterContentSchema = z.object({\n  subject: z.string(),\n  grade: z.number(),\n  topic: z.string(),\n  explanation: z.object({\n    paragraphs: z.array(z.string()),\n  }),\n  practice: z.array(questionSchema),\n  test: z.array(questionSchema),\n});\n\nexport type Question = z.infer<typeof questionSchema>;\nexport type ChapterContent = z.infer<typeof chapterContentSchema>;\n\n// Chapters\nexport const chapters = pgTable(\"chapters\", {\n  id: varchar(\"id\", { length: 36 }).primaryKey().default(sql`gen_random_uuid()`),\n  childId: varchar(\"child_id\", { length: 36 }).notNull().references(() => children.id, { onDelete: \"cascade\" }),\n  parentId: varchar(\"parent_id\", { length: 36 }).notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  title: text(\"title\").notNull(),\n  subject: text(\"subject\").notNull(),\n  grade: integer(\"grade\").notNull(),\n  content: jsonb(\"content\").$type<ChapterContent>(),\n  status: text(\"status\").default(\"processing\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  completedAt: timestamp(\"completed_at\"),\n});\n\nexport const insertChapterSchema = createInsertSchema(chapters).pick({\n  childId: true,\n  parentId: true,\n  title: true,\n  subject: true,\n  grade: true,\n});\n\nexport type InsertChapter = z.infer<typeof insertChapterSchema>;\nexport type Chapter = typeof chapters.$inferSelect;\n\n// Chapter Results\nexport const chapterResults = pgTable(\"chapter_results\", {\n  id: varchar(\"id\", { length: 36 }).primaryKey().default(sql`gen_random_uuid()`),\n  chapterId: varchar(\"chapter_id\", { length: 36 }).notNull().references(() => chapters.id, { onDelete: \"cascade\" }),\n  childId: varchar(\"child_id\", { length: 36 }).notNull().references(() => children.id, { onDelete: \"cascade\" }),\n  practiceScore: integer(\"practice_score\"),\n  testScore: integer(\"test_score\"),\n  totalScore: integer(\"total_score\"),\n  stars: integer(\"stars\"),\n  timeSpentSeconds: integer(\"time_spent_seconds\"),\n  answers: jsonb(\"answers\").$type<{ practiceAnswers: string[]; testAnswers: string[] }>(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertChapterResultSchema = createInsertSchema(chapterResults).pick({\n  chapterId: true,\n  childId: true,\n  practiceScore: true,\n  testScore: true,\n  totalScore: true,\n  stars: true,\n  timeSpentSeconds: true,\n  answers: true,\n});\n\nexport type InsertChapterResult = z.infer<typeof insertChapterResultSchema>;\nexport type ChapterResult = typeof chapterResults.$inferSelect;\n\n// Chapter Photos\nexport const chapterPhotos = pgTable(\"chapter_photos\", {\n  id: varchar(\"id\", { length: 36 }).primaryKey().default(sql`gen_random_uuid()`),\n  chapterId: varchar(\"chapter_id\", { length: 36 }).notNull().references(() => chapters.id, { onDelete: \"cascade\" }),\n  photoData: text(\"photo_data\").notNull(),\n  pageNumber: integer(\"page_number\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertChapterPhotoSchema = createInsertSchema(chapterPhotos).pick({\n  chapterId: true,\n  photoData: true,\n  pageNumber: true,\n});\n\nexport type InsertChapterPhoto = z.infer<typeof insertChapterPhotoSchema>;\nexport type ChapterPhoto = typeof chapterPhotos.$inferSelect;\n\n// Learning Sessions - track detailed learning activity\nexport const learningSessions = pgTable(\"learning_sessions\", {\n  id: varchar(\"id\", { length: 36 }).primaryKey().default(sql`gen_random_uuid()`),\n  childId: varchar(\"child_id\", { length: 36 }).notNull().references(() => children.id, { onDelete: \"cascade\" }),\n  chapterId: varchar(\"chapter_id\", { length: 36 }).notNull().references(() => chapters.id, { onDelete: \"cascade\" }),\n  stage: text(\"stage\").notNull(), // 'learn', 'practice', 'test'\n  startedAt: timestamp(\"started_at\").defaultNow(),\n  endedAt: timestamp(\"ended_at\"),\n  durationSeconds: integer(\"duration_seconds\").default(0),\n});\n\nexport const insertLearningSessionSchema = createInsertSchema(learningSessions).pick({\n  childId: true,\n  chapterId: true,\n  stage: true,\n});\n\nexport type InsertLearningSession = z.infer<typeof insertLearningSessionSchema>;\nexport type LearningSession = typeof learningSessions.$inferSelect;\n\n// Badges - achievement types\nexport const badges = pgTable(\"badges\", {\n  id: varchar(\"id\", { length: 36 }).primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  nameAr: text(\"name_ar\").notNull(),\n  description: text(\"description\").notNull(),\n  descriptionAr: text(\"description_ar\").notNull(),\n  icon: text(\"icon\").notNull(),\n  color: text(\"color\").notNull(),\n  type: text(\"type\").notNull(), // 'first_chapter', 'perfect_score', 'streak', 'subject_mastery', 'learning_time'\n  requirement: integer(\"requirement\").notNull(), // e.g., 7 for 7-day streak, 100 for perfect score\n  rarity: text(\"rarity\").default(\"common\"), // 'common', 'rare', 'epic', 'legendary'\n});\n\nexport const insertBadgeSchema = createInsertSchema(badges).omit({ id: true });\nexport type InsertBadge = z.infer<typeof insertBadgeSchema>;\nexport type Badge = typeof badges.$inferSelect;\n\n// Child Badges - junction table for earned badges\nexport const childBadges = pgTable(\"child_badges\", {\n  id: varchar(\"id\", { length: 36 }).primaryKey().default(sql`gen_random_uuid()`),\n  childId: varchar(\"child_id\", { length: 36 }).notNull().references(() => children.id, { onDelete: \"cascade\" }),\n  badgeId: varchar(\"badge_id\", { length: 36 }).notNull().references(() => badges.id, { onDelete: \"cascade\" }),\n  earnedAt: timestamp(\"earned_at\").defaultNow(),\n  notified: boolean(\"notified\").default(false),\n});\n\nexport const insertChildBadgeSchema = createInsertSchema(childBadges).pick({\n  childId: true,\n  badgeId: true,\n});\nexport type InsertChildBadge = z.infer<typeof insertChildBadgeSchema>;\nexport type ChildBadge = typeof childBadges.$inferSelect;\n\n// Subject icons and colors mapping\nexport const subjectConfig = {\n  math: { icon: \"Calculator\", color: \"from-blue-400 to-blue-600\", emoji: \"🔢\" },\n  science: { icon: \"Beaker\", color: \"from-green-400 to-green-600\", emoji: \"🔬\" },\n  arabic: { icon: \"BookOpen\", color: \"from-amber-400 to-amber-600\", emoji: \"📖\" },\n  english: { icon: \"Globe\", color: \"from-purple-400 to-purple-600\", emoji: \"🌍\" },\n  islamic: { icon: \"Moon\", color: \"from-emerald-400 to-emerald-600\", emoji: \"🌙\" },\n  social: { icon: \"Users\", color: \"from-pink-400 to-pink-600\", emoji: \"👥\" },\n} as const;\n\n// Notifications table\nexport const notifications = pgTable(\"notifications\", {\n  id: varchar(\"id\", { length: 36 }).primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\", { length: 36 }).notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  type: text(\"type\").notNull(), // 'chapter_complete', 'badge_earned', 'weekly_report', 'streak_reminder'\n  title: text(\"title\").notNull(),\n  titleAr: text(\"title_ar\").notNull(),\n  message: text(\"message\").notNull(),\n  messageAr: text(\"message_ar\").notNull(),\n  data: jsonb(\"data\").$type<{ childId?: string; chapterId?: string; badgeId?: string }>(),\n  read: boolean(\"read\").default(false),\n  emailSent: boolean(\"email_sent\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertNotificationSchema = createInsertSchema(notifications).omit({ id: true, read: true, emailSent: true, createdAt: true });\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\nexport type Notification = typeof notifications.$inferSelect;\n\n// Sample Chapters - pre-generated demo content library\nexport const sampleChapters = pgTable(\"sample_chapters\", {\n  id: varchar(\"id\", { length: 36 }).primaryKey().default(sql`gen_random_uuid()`),\n  title: text(\"title\").notNull(),\n  titleAr: text(\"title_ar\").notNull(),\n  subject: text(\"subject\").notNull(),\n  grade: integer(\"grade\").notNull(),\n  description: text(\"description\").notNull(),\n  descriptionAr: text(\"description_ar\").notNull(),\n  content: jsonb(\"content\").$type<ChapterContent>(),\n  previewImage: text(\"preview_image\"),\n  difficulty: text(\"difficulty\").default(\"medium\"), // 'easy', 'medium', 'hard'\n  estimatedMinutes: integer(\"estimated_minutes\").default(15),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertSampleChapterSchema = createInsertSchema(sampleChapters).omit({ id: true, isActive: true, createdAt: true });\nexport type InsertSampleChapter = z.infer<typeof insertSampleChapterSchema>;\nexport type SampleChapter = typeof sampleChapters.$inferSelect;\n\n// Predefined badge definitions for seeding\nexport const badgeDefinitions = [\n  { name: \"First Steps\", nameAr: \"أولى الخطوات\", description: \"Complete your first chapter\", descriptionAr: \"أكمل أول فصل لك\", icon: \"Footprints\", color: \"amber\", type: \"first_chapter\", requirement: 1, rarity: \"common\" },\n  { name: \"Perfect Score\", nameAr: \"درجة مثالية\", description: \"Score 100% on a test\", descriptionAr: \"احصل على ١٠٠٪ في الاختبار\", icon: \"Star\", color: \"yellow\", type: \"perfect_score\", requirement: 100, rarity: \"rare\" },\n  { name: \"Week Warrior\", nameAr: \"محارب الأسبوع\", description: \"7 day learning streak\", descriptionAr: \"سلسلة تعلم ٧ أيام\", icon: \"Flame\", color: \"orange\", type: \"streak\", requirement: 7, rarity: \"rare\" },\n  { name: \"Month Master\", nameAr: \"سيد الشهر\", description: \"30 day learning streak\", descriptionAr: \"سلسلة تعلم ٣٠ يوم\", icon: \"Trophy\", color: \"purple\", type: \"streak\", requirement: 30, rarity: \"epic\" },\n  { name: \"Math Wizard\", nameAr: \"ساحر الرياضيات\", description: \"Complete 10 math chapters\", descriptionAr: \"أكمل ١٠ فصول رياضيات\", icon: \"Calculator\", color: \"blue\", type: \"subject_mastery\", requirement: 10, rarity: \"epic\" },\n  { name: \"Science Explorer\", nameAr: \"مستكشف العلوم\", description: \"Complete 10 science chapters\", descriptionAr: \"أكمل ١٠ فصول علوم\", icon: \"Beaker\", color: \"green\", type: \"subject_mastery\", requirement: 10, rarity: \"epic\" },\n  { name: \"Bookworm\", nameAr: \"عاشق الكتب\", description: \"Read for 5 hours total\", descriptionAr: \"اقرأ لمدة ٥ ساعات\", icon: \"BookOpen\", color: \"teal\", type: \"learning_time\", requirement: 18000, rarity: \"rare\" },\n  { name: \"Scholar\", nameAr: \"العالم\", description: \"Read for 20 hours total\", descriptionAr: \"اقرأ لمدة ٢٠ ساعة\", icon: \"GraduationCap\", color: \"indigo\", type: \"learning_time\", requirement: 72000, rarity: \"legendary\" },\n  { name: \"Quick Learner\", nameAr: \"المتعلم السريع\", description: \"Complete 5 chapters\", descriptionAr: \"أكمل ٥ فصول\", icon: \"Zap\", color: \"cyan\", type: \"first_chapter\", requirement: 5, rarity: \"common\" },\n  { name: \"Chapter Champion\", nameAr: \"بطل الفصول\", description: \"Complete 25 chapters\", descriptionAr: \"أكمل ٢٥ فصل\", icon: \"Crown\", color: \"gold\", type: \"first_chapter\", requirement: 25, rarity: \"legendary\" },\n];\n\n// Sample chapter definitions for seeding\nexport const sampleChapterDefinitions: InsertSampleChapter[] = [\n  {\n    title: \"Addition and Subtraction\",\n    titleAr: \"الجمع والطرح\",\n    subject: \"math\",\n    grade: 2,\n    description: \"Learn basic addition and subtraction with fun examples\",\n    descriptionAr: \"تعلم الجمع والطرح الأساسي مع أمثلة ممتعة\",\n    difficulty: \"easy\",\n    estimatedMinutes: 10,\n    content: {\n      subject: \"math\",\n      grade: 2,\n      topic: \"الجمع والطرح\",\n      explanation: {\n        paragraphs: [\n          \"الجمع هو عملية إضافة أعداد معًا. مثلاً: ٢ + ٣ = ٥\",\n          \"الطرح هو عملية إنقاص عدد من عدد آخر. مثلاً: ٥ - ٢ = ٣\",\n          \"يمكننا استخدام أصابعنا للعد والتأكد من الإجابة الصحيحة.\",\n          \"لنتمرن معًا على بعض الأمثلة!\"\n        ]\n      },\n      practice: [\n        { question: \"ما ناتج ٣ + ٤؟\", options: [\"٥\", \"٦\", \"٧\", \"٨\"], correct: \"C\", difficulty: \"easy\" },\n        { question: \"ما ناتج ٨ - ٣؟\", options: [\"٣\", \"٤\", \"٥\", \"٦\"], correct: \"C\", difficulty: \"easy\" },\n        { question: \"ما ناتج ٥ + ٢؟\", options: [\"٦\", \"٧\", \"٨\", \"٩\"], correct: \"B\", difficulty: \"easy\" },\n        { question: \"ما ناتج ٩ - ٤؟\", options: [\"٣\", \"٤\", \"٥\", \"٦\"], correct: \"C\", difficulty: \"easy\" },\n        { question: \"ما ناتج ٦ + ١؟\", options: [\"٥\", \"٦\", \"٧\", \"٨\"], correct: \"C\", difficulty: \"easy\" }\n      ],\n      test: [\n        { question: \"ما ناتج ٤ + ٥؟\", options: [\"٨\", \"٩\", \"١٠\", \"١١\"], correct: \"B\", difficulty: \"easy\" },\n        { question: \"ما ناتج ٧ - ٢؟\", options: [\"٣\", \"٤\", \"٥\", \"٦\"], correct: \"C\", difficulty: \"easy\" },\n        { question: \"ما ناتج ٢ + ٦؟\", options: [\"٦\", \"٧\", \"٨\", \"٩\"], correct: \"C\", difficulty: \"easy\" },\n        { question: \"ما ناتج ١٠ - ٣؟\", options: [\"٥\", \"٦\", \"٧\", \"٨\"], correct: \"C\", difficulty: \"easy\" },\n        { question: \"ما ناتج ٣ + ٣؟\", options: [\"٤\", \"٥\", \"٦\", \"٧\"], correct: \"C\", difficulty: \"easy\" },\n        { question: \"ما ناتج ٨ - ٥؟\", options: [\"٢\", \"٣\", \"٤\", \"٥\"], correct: \"B\", difficulty: \"medium\" },\n        { question: \"ما ناتج ٤ + ٤؟\", options: [\"٦\", \"٧\", \"٨\", \"٩\"], correct: \"C\", difficulty: \"easy\" },\n        { question: \"ما ناتج ٩ - ٦؟\", options: [\"٢\", \"٣\", \"٤\", \"٥\"], correct: \"B\", difficulty: \"medium\" },\n        { question: \"ما ناتج ٥ + ٥؟\", options: [\"٨\", \"٩\", \"١٠\", \"١١\"], correct: \"C\", difficulty: \"easy\" },\n        { question: \"ما ناتج ٧ - ٤؟\", options: [\"٢\", \"٣\", \"٤\", \"٥\"], correct: \"B\", difficulty: \"easy\" }\n      ]\n    }\n  },\n  {\n    title: \"The Solar System\",\n    titleAr: \"المجموعة الشمسية\",\n    subject: \"science\",\n    grade: 4,\n    description: \"Explore the planets and stars in our solar system\",\n    descriptionAr: \"اكتشف الكواكب والنجوم في مجموعتنا الشمسية\",\n    difficulty: \"medium\",\n    estimatedMinutes: 15,\n    content: {\n      subject: \"science\",\n      grade: 4,\n      topic: \"المجموعة الشمسية\",\n      explanation: {\n        paragraphs: [\n          \"المجموعة الشمسية تتكون من الشمس والكواكب التي تدور حولها.\",\n          \"الشمس هي نجم كبير جداً يعطينا الضوء والحرارة.\",\n          \"هناك ثمانية كواكب: عطارد، الزهرة، الأرض، المريخ، المشتري، زحل، أورانوس، ونبتون.\",\n          \"الأرض هي الكوكب الوحيد الذي نعرف أن به حياة!\"\n        ]\n      },\n      practice: [\n        { question: \"ما هو أقرب كوكب للشمس؟\", options: [\"الزهرة\", \"عطارد\", \"الأرض\", \"المريخ\"], correct: \"B\", difficulty: \"easy\" },\n        { question: \"كم عدد كواكب المجموعة الشمسية؟\", options: [\"٦\", \"٧\", \"٨\", \"٩\"], correct: \"C\", difficulty: \"easy\" },\n        { question: \"ما هو أكبر كوكب في المجموعة الشمسية؟\", options: [\"زحل\", \"المشتري\", \"أورانوس\", \"نبتون\"], correct: \"B\", difficulty: \"medium\" },\n        { question: \"أي كوكب يُعرف بالكوكب الأحمر؟\", options: [\"الزهرة\", \"المريخ\", \"المشتري\", \"زحل\"], correct: \"B\", difficulty: \"easy\" },\n        { question: \"الشمس نجم أم كوكب؟\", options: [\"كوكب\", \"قمر\", \"نجم\", \"مذنب\"], correct: \"C\", difficulty: \"easy\" }\n      ],\n      test: [\n        { question: \"ما هو ثالث كوكب من الشمس؟\", options: [\"عطارد\", \"الزهرة\", \"الأرض\", \"المريخ\"], correct: \"C\", difficulty: \"easy\" },\n        { question: \"أي كوكب له حلقات مميزة؟\", options: [\"المشتري\", \"زحل\", \"أورانوس\", \"نبتون\"], correct: \"B\", difficulty: \"easy\" },\n        { question: \"ما هو أبعد كوكب عن الشمس؟\", options: [\"أورانوس\", \"نبتون\", \"زحل\", \"المشتري\"], correct: \"B\", difficulty: \"medium\" },\n        { question: \"كم عدد أقمار الأرض؟\", options: [\"٠\", \"١\", \"٢\", \"٣\"], correct: \"B\", difficulty: \"easy\" },\n        { question: \"أي كوكب هو الأصغر؟\", options: [\"عطارد\", \"المريخ\", \"الزهرة\", \"الأرض\"], correct: \"A\", difficulty: \"medium\" },\n        { question: \"ما هو الكوكب التوأم للأرض؟\", options: [\"المريخ\", \"الزهرة\", \"عطارد\", \"نبتون\"], correct: \"B\", difficulty: \"hard\" },\n        { question: \"من أين تأتي الحرارة والضوء للأرض؟\", options: [\"القمر\", \"النجوم\", \"الشمس\", \"الكواكب\"], correct: \"C\", difficulty: \"easy\" },\n        { question: \"ما هو ترتيب المريخ من الشمس؟\", options: [\"الثالث\", \"الرابع\", \"الخامس\", \"السادس\"], correct: \"B\", difficulty: \"medium\" },\n        { question: \"أي كوكب يدور على جانبه؟\", options: [\"زحل\", \"نبتون\", \"أورانوس\", \"المشتري\"], correct: \"C\", difficulty: \"hard\" },\n        { question: \"ما الذي يجعل الأرض مميزة؟\", options: [\"حجمها\", \"موقعها\", \"وجود الماء والحياة\", \"لونها\"], correct: \"C\", difficulty: \"easy\" }\n      ]\n    }\n  },\n  {\n    title: \"Arabic Alphabet Review\",\n    titleAr: \"مراجعة الحروف العربية\",\n    subject: \"arabic\",\n    grade: 1,\n    description: \"Practice reading and writing Arabic letters\",\n    descriptionAr: \"تدرب على قراءة وكتابة الحروف العربية\",\n    difficulty: \"easy\",\n    estimatedMinutes: 10,\n    content: {\n      subject: \"arabic\",\n      grade: 1,\n      topic: \"الحروف العربية\",\n      explanation: {\n        paragraphs: [\n          \"اللغة العربية بها ٢٨ حرفًا جميلًا.\",\n          \"كل حرف له شكل في أول الكلمة وفي وسطها وفي آخرها.\",\n          \"الحروف الأولى هي: ألف، باء، تاء، ثاء...\",\n          \"هيا نتعلم معًا ونتدرب على الحروف!\"\n        ]\n      },\n      practice: [\n        { question: \"ما هو أول حرف في الأبجدية العربية؟\", options: [\"باء\", \"ألف\", \"تاء\", \"جيم\"], correct: \"B\", difficulty: \"easy\" },\n        { question: \"كم عدد الحروف العربية؟\", options: [\"٢٦\", \"٢٧\", \"٢٨\", \"٢٩\"], correct: \"C\", difficulty: \"easy\" },\n        { question: \"أي حرف يأتي بعد الباء؟\", options: [\"ألف\", \"ثاء\", \"تاء\", \"جيم\"], correct: \"C\", difficulty: \"easy\" },\n        { question: \"ما هو الحرف الذي يبدأ به كلمة 'شمس'؟\", options: [\"سين\", \"شين\", \"صاد\", \"ضاد\"], correct: \"B\", difficulty: \"easy\" },\n        { question: \"أي من هذه الحروف له نقطة واحدة تحته؟\", options: [\"باء\", \"تاء\", \"ثاء\", \"نون\"], correct: \"A\", difficulty: \"medium\" }\n      ],\n      test: [\n        { question: \"ما هو الحرف الأخير في الأبجدية؟\", options: [\"واو\", \"هاء\", \"ياء\", \"لام\"], correct: \"C\", difficulty: \"easy\" },\n        { question: \"كم نقطة للحرف 'ث'؟\", options: [\"١\", \"٢\", \"٣\", \"٤\"], correct: \"C\", difficulty: \"easy\" },\n        { question: \"أي حرف يشبه 'ب' لكن بنقطتين فوق؟\", options: [\"ت\", \"ث\", \"ن\", \"ي\"], correct: \"A\", difficulty: \"easy\" },\n        { question: \"ما الحرف الذي يبدأ به كلمة 'قمر'؟\", options: [\"كاف\", \"قاف\", \"فاء\", \"غين\"], correct: \"B\", difficulty: \"easy\" },\n        { question: \"أي حرف له نقطة فوقه؟\", options: [\"حاء\", \"خاء\", \"جيم\", \"ب و ج\"], correct: \"B\", difficulty: \"medium\" },\n        { question: \"ما الحرف الذي يبدأ به كلمة 'بيت'؟\", options: [\"تاء\", \"باء\", \"ياء\", \"نون\"], correct: \"B\", difficulty: \"easy\" },\n        { question: \"كم نقطة للحرف 'ش'؟\", options: [\"١\", \"٢\", \"٣\", \"٤\"], correct: \"C\", difficulty: \"easy\" },\n        { question: \"أي حرف يأتي قبل 'ج'؟\", options: [\"ب\", \"ت\", \"ث\", \"ح\"], correct: \"C\", difficulty: \"medium\" },\n        { question: \"ما الحرف الذي يبدأ به كلمة 'ماء'؟\", options: [\"نون\", \"ميم\", \"واو\", \"ألف\"], correct: \"B\", difficulty: \"easy\" },\n        { question: \"الحرف 'ع' له نقاط؟\", options: [\"نعم، واحدة\", \"نعم، اثنتين\", \"نعم، ثلاث\", \"لا، بدون نقاط\"], correct: \"D\", difficulty: \"medium\" }\n      ]\n    }\n  }\n];\n","path":null,"size_bytes":23146,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"replit.md":{"content":"# LearnSnap - Educational AI Platform\n\n## Overview\nLearnSnap is a B2C SaaS educational app that transforms textbook pages into interactive learning experiences for elementary students (ages 6-12) in Saudi Arabia. Parents upload photos of textbook pages, and AI generates interactive lessons, practice questions, and tests.\n\n## Project State\n- **Status**: MVP Complete\n- **Last Updated**: December 2025\n\n## Recent Changes\n- Implemented complete database schema with PostgreSQL\n- Built all parent and child app pages with RTL Arabic support\n- Integrated 3-AI verification pipeline (Gemini → OpenAI → Anthropic)\n- Added secure authentication with bcrypt password hashing\n- Created dual design system (professional parent UI vs playful child UI)\n- Added Stripe subscription integration with tiered pricing\n- Built advanced analytics dashboard with charts\n- Implemented gamification with badges and leaderboards\n- Added voice narration using Web Speech API for children\n- Created parent notification system with preferences\n\n## Architecture\n\n### Tech Stack\n- **Frontend**: React + Vite + wouter routing\n- **Backend**: Express.js\n- **Database**: PostgreSQL with Drizzle ORM\n- **Styling**: Tailwind CSS + shadcn/ui components\n- **AI**: Gemini Flash (generation), GPT-4o mini (verification), Claude Sonnet (error fixing)\n\n### Database Schema\n- `users` - Parent accounts with email/password auth\n- `children` - Child profiles linked to parents\n- `chapters` - AI-generated learning content\n- `chapter_results` - Test scores and answers\n- `chapter_photos` - Uploaded textbook images\n\n### Key Features\n1. **Parent Dashboard** - Manage children, upload chapters, view reports\n2. **Photo Upload** - Drag & drop up to 20 textbook images\n3. **AI Processing** - 3-stage verification pipeline for quality content\n4. **Child Learning Flow**:\n   - Learn: Simple explanations with visuals\n   - Practice: 5 questions with instant feedback\n   - Test: 10 questions for assessment\n5. **Gamification** - Stars, streaks, achievements\n\n## User Preferences\n- Arabic RTL interface (Cairo font for parents, Fredoka for children)\n- Dual design system:\n  - Parent app: Professional blue/green palette\n  - Child app: Playful coral/turquoise/yellow gradients\n- No emojis in UI (use Lucide React icons)\n\n## Project Structure\n```\nclient/src/\n├── pages/\n│   ├── auth.tsx           # Login/Register\n│   ├── dashboard.tsx      # Parent home\n│   ├── upload.tsx         # Photo upload\n│   ├── processing.tsx     # AI processing status\n│   ├── chapter.tsx        # Chapter details\n│   ├── report.tsx         # Performance report\n│   ├── child-welcome.tsx  # Child greeting\n│   ├── child-lessons.tsx  # Lessons list\n│   ├── learn-stage.tsx    # Reading content\n│   ├── practice-stage.tsx # Practice questions\n│   ├── test-stage.tsx     # Assessment\n│   └── results.tsx        # Score display\nserver/\n├── routes.ts              # API endpoints\n├── storage.ts             # Database operations\n├── ai-service.ts          # AI pipeline\n└── db.ts                  # Database connection\nshared/\n└── schema.ts              # Drizzle schema + types\n```\n\n## Environment Variables\nUses Replit AI Integrations:\n- `AI_INTEGRATIONS_GEMINI_API_KEY`\n- `AI_INTEGRATIONS_OPENAI_API_KEY`\n- `AI_INTEGRATIONS_ANTHROPIC_API_KEY`\n- `DATABASE_URL` (PostgreSQL)\n- `SESSION_SECRET`\n","path":null,"size_bytes":3450,"size_tokens":null},"server/ai-service.ts":{"content":"import Anthropic from \"@anthropic-ai/sdk\";\nimport OpenAI from \"openai\";\nimport { GoogleGenAI } from \"@google/genai\";\nimport type { ChapterContent, Question } from \"@shared/schema\";\n\n// Use Replit AI Integrations environment variables\nconst anthropic = new Anthropic({\n  apiKey: process.env.AI_INTEGRATIONS_ANTHROPIC_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_ANTHROPIC_BASE_URL,\n});\n\nconst openai = new OpenAI({\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n});\n\nconst genAI = new GoogleGenAI({ \n  apiKey: process.env.AI_INTEGRATIONS_GEMINI_API_KEY || \"\",\n});\n\nconst SYSTEM_PROMPT = `أنت معلم تعليمي متخصص في إنشاء محتوى تعليمي للأطفال في المرحلة الابتدائية (6-12 سنة) في السعودية.\n\nمهمتك:\n1. تحليل صور صفحات الكتب المدرسية\n2. استخراج المفاهيم الأساسية\n3. إنشاء شرح مبسط ومناسب لعمر الطفل\n4. إنشاء أسئلة تمرين (5 أسئلة سهلة-متوسطة)\n5. إنشاء أسئلة اختبار (10 أسئلة متنوعة الصعوبة)\n\nالقواعد:\n- استخدم لغة عربية بسيطة وواضحة\n- استخدم أمثلة من الحياة اليومية\n- اجعل الشرح ممتعاً ومشوقاً\n- تأكد من صحة الإجابات\n- الأسئلة يجب أن تكون متعددة الخيارات (4 خيارات)`;\n\nconst JSON_SCHEMA = `{\n  \"subject\": \"string (math, science, arabic, english, islamic, social)\",\n  \"grade\": number (1-6),\n  \"topic\": \"string (عنوان الموضوع بالعربية)\",\n  \"explanation\": {\n    \"paragraphs\": [\"string\", \"string\", \"string\"] // 3-5 فقرات شرح بسيط\n  },\n  \"practice\": [\n    {\n      \"question\": \"string (السؤال)\",\n      \"options\": [\"string\", \"string\", \"string\", \"string\"], // 4 خيارات\n      \"correct\": \"A\" | \"B\" | \"C\" | \"D\",\n      \"difficulty\": \"easy\" | \"medium\"\n    }\n  ],\n  \"test\": [\n    {\n      \"question\": \"string (السؤال)\",\n      \"options\": [\"string\", \"string\", \"string\", \"string\"], // 4 خيارات\n      \"correct\": \"A\" | \"B\" | \"C\" | \"D\",\n      \"difficulty\": \"easy\" | \"medium\" | \"hard\"\n    }\n  ]\n}`;\n\n// Helper to extract base64 from data URL\nfunction extractBase64(dataUrl: string): { data: string; mimeType: string } {\n  const matches = dataUrl.match(/^data:([^;]+);base64,(.+)$/);\n  if (!matches) {\n    throw new Error(\"Invalid data URL format\");\n  }\n  return { mimeType: matches[1], data: matches[2] };\n}\n\n// Step 1: Generate content with Gemini Flash\nexport async function generateWithGemini(photos: string[], subject: string, grade: number): Promise<ChapterContent> {\n  console.log(\"Generating content with Gemini Flash...\");\n  \n  const imagesParts = photos.map((photo) => {\n    const { data, mimeType } = extractBase64(photo);\n    return {\n      inlineData: {\n        data,\n        mimeType: mimeType as \"image/jpeg\" | \"image/png\" | \"image/webp\",\n      },\n    };\n  });\n\n  const prompt = `${SYSTEM_PROMPT}\n\nالمادة: ${subject}\nالصف: ${grade}\n\nحلل الصور المرفقة وأنشئ محتوى تعليمي بالتنسيق التالي (JSON فقط):\n\n${JSON_SCHEMA}\n\nمهم جداً:\n- أنشئ 5 أسئلة تمرين بالضبط\n- أنشئ 10 أسئلة اختبار بالضبط\n- تأكد من أن JSON صحيح\n- لا تضف أي نص خارج JSON`;\n\n  try {\n    const response = await genAI.models.generateContent({\n      model: \"gemini-2.0-flash-exp\",\n      contents: [\n        {\n          role: \"user\",\n          parts: [\n            { text: prompt },\n            ...imagesParts,\n          ],\n        },\n      ],\n      config: {\n        responseMimeType: \"application/json\",\n      },\n    });\n\n    const text = response.text || \"\";\n    const jsonMatch = text.match(/\\{[\\s\\S]*\\}/);\n    if (!jsonMatch) {\n      throw new Error(\"No valid JSON found in Gemini response\");\n    }\n\n    const content = JSON.parse(jsonMatch[0]) as ChapterContent;\n    return content;\n  } catch (error) {\n    console.error(\"Gemini generation error:\", error);\n    throw error;\n  }\n}\n\n// Step 2: Verify with GPT-4o mini\nexport async function verifyWithGPT(content: ChapterContent): Promise<{ status: \"PASS\" | \"FAIL\"; issues: string[] }> {\n  console.log(\"Verifying content with GPT-4o mini...\");\n\n  const verificationPrompt = `أنت مدقق جودة للمحتوى التعليمي. راجع المحتوى التالي وتحقق من:\n\n1. صحة الإجابات (كل سؤال له إجابة صحيحة واحدة فقط)\n2. مناسبة اللغة للأطفال (6-12 سنة)\n3. وضوح الأسئلة والخيارات\n4. عدد الأسئلة صحيح (5 تمرين + 10 اختبار)\n5. تنوع صعوبة الأسئلة\n\nالمحتوى:\n${JSON.stringify(content, null, 2)}\n\nأجب بـ JSON فقط:\n{\n  \"status\": \"PASS\" | \"FAIL\",\n  \"issues\": [\"قائمة المشاكل إن وجدت\"]\n}`;\n\n  try {\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o-mini\",\n      messages: [\n        { role: \"system\", content: \"أنت مدقق جودة محتوى تعليمي. أجب بـ JSON فقط.\" },\n        { role: \"user\", content: verificationPrompt },\n      ],\n      response_format: { type: \"json_object\" },\n    });\n\n    const result = JSON.parse(response.choices[0].message.content || \"{}\");\n    return {\n      status: result.status || \"PASS\",\n      issues: result.issues || [],\n    };\n  } catch (error) {\n    console.error(\"GPT verification error:\", error);\n    // If verification fails, assume content is OK to not block\n    return { status: \"PASS\", issues: [] };\n  }\n}\n\n// Step 3: Fix with Claude if needed\nexport async function fixWithClaude(content: ChapterContent, issues: string[]): Promise<ChapterContent> {\n  console.log(\"Fixing content with Claude Sonnet...\");\n\n  const fixPrompt = `أنت معلم تعليمي. المحتوى التالي به مشاكل تحتاج إصلاح:\n\nالمحتوى الحالي:\n${JSON.stringify(content, null, 2)}\n\nالمشاكل المكتشفة:\n${issues.join(\"\\n\")}\n\nأصلح المشاكل وأعد المحتوى بنفس التنسيق (JSON فقط):\n\n${JSON_SCHEMA}`;\n\n  try {\n    const response = await anthropic.messages.create({\n      model: \"claude-sonnet-4-20250514\",\n      max_tokens: 4096,\n      messages: [\n        { role: \"user\", content: fixPrompt },\n      ],\n    });\n\n    const textContent = response.content.find((c) => c.type === \"text\");\n    if (!textContent || textContent.type !== \"text\") {\n      throw new Error(\"No text content in Claude response\");\n    }\n\n    const jsonMatch = textContent.text.match(/\\{[\\s\\S]*\\}/);\n    if (!jsonMatch) {\n      throw new Error(\"No valid JSON found in Claude response\");\n    }\n\n    return JSON.parse(jsonMatch[0]) as ChapterContent;\n  } catch (error) {\n    console.error(\"Claude fix error:\", error);\n    // Return original content if fix fails\n    return content;\n  }\n}\n\n// Main AI processing pipeline\nexport async function processChapterWithAI(\n  photos: string[],\n  subject: string,\n  grade: number\n): Promise<ChapterContent> {\n  // Step 1: Generate with Gemini\n  let content = await generateWithGemini(photos, subject, grade);\n\n  // Step 2: Verify with GPT\n  const verification = await verifyWithGPT(content);\n\n  if (verification.status === \"PASS\") {\n    console.log(\"Content verified successfully!\");\n    return content;\n  }\n\n  console.log(\"Content verification failed, fixing with Claude...\");\n  console.log(\"Issues:\", verification.issues);\n\n  // Step 3: Fix with Claude\n  content = await fixWithClaude(content, verification.issues);\n\n  // Step 4: Re-verify\n  const recheck = await verifyWithGPT(content);\n  if (recheck.status === \"FAIL\") {\n    console.warn(\"Content still has issues after fix:\", recheck.issues);\n    // Continue anyway, as the content is still usable\n  }\n\n  return content;\n}\n\n// Calculate stars based on score\nexport function calculateStars(score: number, total: number): number {\n  const percentage = (score / total) * 100;\n  if (percentage >= 90) return 5;\n  if (percentage >= 80) return 4;\n  if (percentage >= 70) return 3;\n  if (percentage >= 60) return 2;\n  return 1;\n}\n\n// Calculate practice and test scores\nexport function calculateScores(\n  practiceAnswers: string[],\n  testAnswers: string[],\n  practiceQuestions: Question[],\n  testQuestions: Question[]\n): { practiceScore: number; testScore: number; totalScore: number; stars: number } {\n  let practiceScore = 0;\n  let testScore = 0;\n\n  practiceAnswers.forEach((answer, index) => {\n    if (practiceQuestions[index]?.correct === answer) {\n      practiceScore++;\n    }\n  });\n\n  testAnswers.forEach((answer, index) => {\n    if (testQuestions[index]?.correct === answer) {\n      testScore++;\n    }\n  });\n\n  const totalScore = practiceScore + testScore;\n  const stars = calculateStars(totalScore, 15);\n\n  return { practiceScore, testScore, totalScore, stars };\n}\n","path":null,"size_bytes":8928,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/pages/child-lessons.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useParams, Link } from \"wouter\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { \n  Star, \n  Play, \n  CheckCircle, \n  Clock, \n  ArrowRight,\n  BookOpen,\n  Calculator,\n  Beaker,\n  Globe,\n  Moon,\n  Users\n} from \"lucide-react\";\nimport type { Chapter, ChapterResult } from \"@shared/schema\";\n\nconst subjectIcons: Record<string, any> = {\n  math: Calculator,\n  science: Beaker,\n  arabic: BookOpen,\n  english: Globe,\n  islamic: Moon,\n  social: Users,\n};\n\nconst subjectColors: Record<string, string> = {\n  math: \"from-child-blue to-blue-600\",\n  science: \"from-child-green to-emerald-600\",\n  arabic: \"from-amber-400 to-orange-500\",\n  english: \"from-child-purple to-purple-600\",\n  islamic: \"from-emerald-400 to-teal-600\",\n  social: \"from-child-coral to-pink-600\",\n};\n\nconst subjectLabels: Record<string, string> = {\n  math: \"الرياضيات\",\n  science: \"العلوم\",\n  arabic: \"اللغة العربية\",\n  english: \"الإنجليزية\",\n  islamic: \"الإسلامية\",\n  social: \"الاجتماعية\",\n};\n\nfunction LessonCard({ chapter, result }: { chapter: Chapter; result?: ChapterResult }) {\n  const Icon = subjectIcons[chapter.subject] || BookOpen;\n  const colorClass = subjectColors[chapter.subject] || \"from-gray-400 to-gray-600\";\n  const isCompleted = chapter.status === \"completed\";\n  const stars = result?.stars || 0;\n\n  return (\n    <Link href={`/child/chapter/${chapter.id}/learn`}>\n      <Card \n        className=\"overflow-hidden hover:scale-[1.02] transition-transform cursor-pointer shadow-lg\"\n        data-testid={`card-lesson-${chapter.id}`}\n      >\n        <div className={`h-3 bg-gradient-to-r ${colorClass}`} />\n        <CardContent className=\"p-5\">\n          <div className=\"flex items-start gap-4\">\n            <div className={`w-14 h-14 rounded-xl bg-gradient-to-br ${colorClass} flex items-center justify-center shadow-md`}>\n              <Icon className=\"w-7 h-7 text-white\" />\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <div className=\"flex items-center gap-2 mb-1\">\n                <Badge variant=\"secondary\" className=\"text-xs font-arabic\">\n                  {subjectLabels[chapter.subject]}\n                </Badge>\n                {isCompleted && (\n                  <CheckCircle className=\"w-4 h-4 text-green-500\" />\n                )}\n              </div>\n              <h3 className=\"font-child font-bold text-lg mb-1 line-clamp-1\" data-testid={`text-lesson-title-${chapter.id}`}>\n                {chapter.title}\n              </h3>\n              <div className=\"flex items-center gap-1\">\n                {Array.from({ length: 5 }).map((_, i) => (\n                  <Star \n                    key={i} \n                    className={`w-4 h-4 ${i < stars ? \"text-amber-400 fill-amber-400\" : \"text-gray-200\"}`}\n                  />\n                ))}\n              </div>\n            </div>\n          </div>\n          <Button \n            className={`w-full mt-4 font-child font-bold h-12 rounded-xl ${\n              isCompleted \n                ? \"bg-gradient-to-r from-green-400 to-emerald-500\" \n                : `bg-gradient-to-r ${colorClass}`\n            }`}\n            data-testid={`button-lesson-${chapter.id}`}\n          >\n            {isCompleted ? (\n              <>\n                <CheckCircle className=\"w-5 h-5 ml-2\" />\n                مراجعة\n              </>\n            ) : chapter.status === \"processing\" ? (\n              <>\n                <Clock className=\"w-5 h-5 ml-2\" />\n                قيد التحضير...\n              </>\n            ) : (\n              <>\n                <Play className=\"w-5 h-5 ml-2\" />\n                ابدأ!\n              </>\n            )}\n          </Button>\n        </CardContent>\n      </Card>\n    </Link>\n  );\n}\n\nexport default function ChildLessons() {\n  const { childId } = useParams<{ childId: string }>();\n\n  const { data: chapters, isLoading } = useQuery<Chapter[]>({\n    queryKey: [\"/api/children\", childId, \"chapters\"],\n    enabled: !!childId,\n  });\n\n  const { data: results } = useQuery<ChapterResult[]>({\n    queryKey: [\"/api/children\", childId, \"results\"],\n    enabled: !!childId,\n  });\n\n  const readyChapters = chapters?.filter(c => c.status === \"ready\" || c.status === \"completed\") || [];\n  const processingChapters = chapters?.filter(c => c.status === \"processing\") || [];\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-pink-100 via-purple-50 to-blue-100\" dir=\"rtl\">\n      <header className=\"bg-white/80 backdrop-blur-sm border-b sticky top-0 z-50\">\n        <div className=\"max-w-2xl mx-auto px-4\">\n          <div className=\"flex items-center h-16 gap-4\">\n            <Link href={`/child/${childId}/welcome`}>\n              <Button variant=\"ghost\" size=\"icon\" className=\"rounded-xl\">\n                <ArrowRight className=\"w-6 h-6\" />\n              </Button>\n            </Link>\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 bg-gradient-to-br from-child-coral to-child-purple rounded-xl flex items-center justify-center\">\n                <BookOpen className=\"w-5 h-5 text-white\" />\n              </div>\n              <h1 className=\"font-child font-bold text-xl\">دروسي</h1>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-2xl mx-auto px-4 py-6\">\n        {isLoading ? (\n          <div className=\"space-y-4\">\n            {[1, 2, 3].map((i) => (\n              <Card key={i}>\n                <div className=\"h-3 bg-gray-200\" />\n                <CardContent className=\"p-5\">\n                  <div className=\"flex items-start gap-4\">\n                    <Skeleton className=\"w-14 h-14 rounded-xl\" />\n                    <div className=\"flex-1 space-y-2\">\n                      <Skeleton className=\"h-5 w-20\" />\n                      <Skeleton className=\"h-6 w-32\" />\n                      <Skeleton className=\"h-4 w-24\" />\n                    </div>\n                  </div>\n                  <Skeleton className=\"h-12 w-full mt-4 rounded-xl\" />\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        ) : readyChapters.length === 0 && processingChapters.length === 0 ? (\n          <div className=\"text-center py-16\">\n            <div className=\"w-24 h-24 bg-white/60 rounded-full flex items-center justify-center mx-auto mb-6\">\n              <BookOpen className=\"w-12 h-12 text-gray-400\" />\n            </div>\n            <h2 className=\"text-2xl font-child font-bold text-gray-700 mb-2\">\n              لا توجد دروس بعد\n            </h2>\n            <p className=\"font-arabic text-gray-500\">\n              اطلب من والديك إضافة درس جديد\n            </p>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            {readyChapters.map((chapter) => {\n              const result = results?.find(r => r.chapterId === chapter.id);\n              return <LessonCard key={chapter.id} chapter={chapter} result={result} />;\n            })}\n            \n            {processingChapters.length > 0 && (\n              <>\n                <h2 className=\"font-child font-bold text-lg text-gray-600 mt-6 mb-2\">\n                  قيد التحضير...\n                </h2>\n                {processingChapters.map((chapter) => (\n                  <Card key={chapter.id} className=\"opacity-60\">\n                    <div className=\"h-3 bg-gray-300\" />\n                    <CardContent className=\"p-5\">\n                      <div className=\"flex items-center gap-4\">\n                        <div className=\"w-14 h-14 rounded-xl bg-gray-200 flex items-center justify-center animate-pulse\">\n                          <Clock className=\"w-7 h-7 text-gray-400\" />\n                        </div>\n                        <div>\n                          <p className=\"font-child font-bold text-lg\">{chapter.title}</p>\n                          <p className=\"text-sm text-gray-500 font-arabic\">جاري التحضير...</p>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </>\n            )}\n          </div>\n        )}\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":8419,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"server/db.ts":{"content":"import { Pool, neonConfig } from \"@neondatabase/serverless\";\nimport { drizzle } from \"drizzle-orm/neon-serverless\";\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nconst pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","path":null,"size_bytes":476,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route, useLocation } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { useEffect } from \"react\";\n\nimport NotFound from \"@/pages/not-found\";\nimport AuthPage from \"@/pages/auth\";\nimport Dashboard from \"@/pages/dashboard\";\nimport UploadPage from \"@/pages/upload\";\nimport ProcessingPage from \"@/pages/processing\";\nimport ChapterPage from \"@/pages/chapter\";\nimport ReportPage from \"@/pages/report\";\nimport SubscriptionPage from \"@/pages/subscription\";\nimport AnalyticsPage from \"@/pages/analytics\";\nimport ChildWelcome from \"@/pages/child-welcome\";\nimport ChildLessons from \"@/pages/child-lessons\";\nimport LearnStage from \"@/pages/learn-stage\";\nimport PracticeStage from \"@/pages/practice-stage\";\nimport TestStage from \"@/pages/test-stage\";\nimport ResultsPage from \"@/pages/results\";\nimport BadgesPage from \"@/pages/badges\";\nimport LeaderboardPage from \"@/pages/leaderboard\";\nimport NotificationsPage from \"@/pages/notifications\";\nimport ContentLibrary from \"@/pages/content-library\";\n\nfunction ProtectedRoute({ component: Component }: { component: () => JSX.Element }) {\n  const [, setLocation] = useLocation();\n  const userId = localStorage.getItem(\"userId\");\n\n  useEffect(() => {\n    if (!userId) {\n      setLocation(\"/auth\");\n    }\n  }, [userId, setLocation]);\n\n  if (!userId) return null;\n  return <Component />;\n}\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/auth\" component={AuthPage} />\n      <Route path=\"/\">\n        {() => <ProtectedRoute component={Dashboard} />}\n      </Route>\n      <Route path=\"/upload\">\n        {() => <ProtectedRoute component={UploadPage} />}\n      </Route>\n      <Route path=\"/chapter/:id/processing\" component={ProcessingPage} />\n      <Route path=\"/chapter/:id\" component={ChapterPage} />\n      <Route path=\"/report/:resultId\" component={ReportPage} />\n      <Route path=\"/subscription\">\n        {() => <ProtectedRoute component={SubscriptionPage} />}\n      </Route>\n      <Route path=\"/analytics\">\n        {() => <ProtectedRoute component={AnalyticsPage} />}\n      </Route>\n      \n      <Route path=\"/child/:childId/welcome\" component={ChildWelcome} />\n      <Route path=\"/child/:childId/lessons\" component={ChildLessons} />\n      <Route path=\"/child/:childId/badges\" component={BadgesPage} />\n      <Route path=\"/child/chapter/:id/learn\" component={LearnStage} />\n      <Route path=\"/child/chapter/:id/practice\" component={PracticeStage} />\n      <Route path=\"/child/chapter/:id/test\" component={TestStage} />\n      <Route path=\"/child/chapter/:id/results\" component={ResultsPage} />\n      <Route path=\"/leaderboard\">\n        {() => <ProtectedRoute component={LeaderboardPage} />}\n      </Route>\n      <Route path=\"/notifications\">\n        {() => <ProtectedRoute component={NotificationsPage} />}\n      </Route>\n      <Route path=\"/content-library\">\n        {() => <ProtectedRoute component={ContentLibrary} />}\n      </Route>\n      \n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <Router />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":3376,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n        xl: \"0.75rem\", /* 12px */\n        \"2xl\": \"1rem\", /* 16px */\n        \"3xl\": \"1.5rem\", /* 24px */\n      },\n      colors: {\n        // Child app playful colors\n        child: {\n          coral: \"#FF6B6B\",\n          turquoise: \"#4ECDC4\",\n          yellow: \"#FFD93D\",\n          green: \"#6BCF7F\",\n          blue: \"#4D96FF\",\n          purple: \"#B388FF\",\n        },\n        // Success/warning colors\n        success: {\n          DEFAULT: \"hsl(142 76% 36%)\",\n          foreground: \"hsl(0 0% 100%)\",\n        },\n        warning: {\n          DEFAULT: \"hsl(38 92% 50%)\",\n          foreground: \"hsl(0 0% 100%)\",\n        },\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n        arabic: [\"Cairo\", \"sans-serif\"],\n        child: [\"Fredoka\", \"Cairo\", \"sans-serif\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n        \"bounce-gentle\": {\n          \"0%, 100%\": { transform: \"translateY(0)\" },\n          \"50%\": { transform: \"translateY(-10px)\" },\n        },\n        \"pulse-glow\": {\n          \"0%, 100%\": { opacity: \"1\" },\n          \"50%\": { opacity: \"0.7\" },\n        },\n        \"scale-in\": {\n          from: { transform: \"scale(0)\", opacity: \"0\" },\n          to: { transform: \"scale(1)\", opacity: \"1\" },\n        },\n        \"slide-up\": {\n          from: { transform: \"translateY(20px)\", opacity: \"0\" },\n          to: { transform: \"translateY(0)\", opacity: \"1\" },\n        },\n        \"confetti-fall\": {\n          \"0%\": { transform: \"translateY(-100%) rotate(0deg)\", opacity: \"1\" },\n          \"100%\": { transform: \"translateY(100vh) rotate(720deg)\", opacity: \"0\" },\n        },\n        \"star-pop\": {\n          \"0%\": { transform: \"scale(0) rotate(-180deg)\" },\n          \"50%\": { transform: \"scale(1.2) rotate(0deg)\" },\n          \"100%\": { transform: \"scale(1) rotate(0deg)\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n        \"bounce-gentle\": \"bounce-gentle 2s ease-in-out infinite\",\n        \"pulse-glow\": \"pulse-glow 2s ease-in-out infinite\",\n        \"scale-in\": \"scale-in 0.3s ease-out\",\n        \"slide-up\": \"slide-up 0.4s ease-out\",\n        \"confetti-fall\": \"confetti-fall 3s linear forwards\",\n        \"star-pop\": \"star-pop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":6058,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"design_guidelines.md":{"content":"# LearnSnap Design Guidelines\n\n## Design Approach\n\n**Dual Design System**: LearnSnap requires two distinct design languages serving different audiences:\n- **Parent App**: Professional, efficient, trust-building interface focused on clarity and actionable insights\n- **Child App**: Playful, engaging, encouraging interface optimized for young learners (ages 6-12)\n\n**Reference Inspiration**: Parent app draws from productivity tools like Notion and Linear for clean data presentation; Child app takes cues from Duolingo and Khan Academy Kids for gamified learning experiences.\n\n---\n\n## Typography System\n\n**Parent App**:\n- Font: Cairo (Arabic), Inter fallback\n- Hierarchy: text-2xl/font-bold (headings), text-xl/font-semibold (subheadings), text-base/font-normal (body), text-sm/font-light (captions)\n- Line height: relaxed for readability\n\n**Child App**:\n- Font: Cairo (Arabic), Fredoka fallback for playful aesthetic\n- Hierarchy: text-3xl/font-bold (headings), text-2xl/font-semibold (subheadings), text-xl/font-normal (body), text-xl/font-bold (buttons)\n- Larger sizes for accessibility and reduced reading fatigue\n\n**RTL Support**: All text right-aligned with `dir=\"rtl\"`, proper Arabic numerals, reversed layout flow\n\n---\n\n## Layout & Spacing\n\n**Spacing Scale**: Use Tailwind units 2, 4, 6, 8, 12, 16, 20, 24, 32\n- Component padding: p-4 to p-6 (parent), p-6 to p-8 (child)\n- Section spacing: py-12 to py-20 (parent), py-16 to py-24 (child)\n- Card gaps: gap-4 (parent), gap-6 (child)\n\n**Grid Systems**:\n- Parent: 2-3 column grids for children cards, reports (grid-cols-1 md:grid-cols-2 lg:grid-cols-3)\n- Child: Single column focus on mobile, 2 columns max on desktop for lesson cards\n- Max widths: max-w-7xl for parent dashboards, max-w-4xl for child learning screens\n\n**Touch Targets**:\n- Parent: h-10 minimum for buttons\n- Child: h-16 minimum (64px) for large tap-friendly buttons\n\n---\n\n## Component Library\n\n**Parent App Components**:\n\n1. **Child Profile Cards**: Rounded cards (rounded-xl) with shadow-md, displaying avatar, name, recent score badge, streak fire emoji\n2. **Upload Interface**: Dashed border dropzone (border-2 border-dashed), thumbnail grid preview (grid-cols-3 gap-3), delete/reorder controls\n3. **Progress Indicators**: Linear progress bars with percentage, circular charts using Recharts for test scores\n4. **Report Cards**: White background (bg-white), subtle shadows, color-coded sections (green for strengths, amber for improvement areas)\n5. **Data Tables**: Striped rows for question breakdowns, visual checkmarks/X icons for correct/incorrect\n\n**Child App Components**:\n\n1. **Lesson Cards**: Large colorful cards (min-h-32) with subject-specific gradient backgrounds, emoji icons (48px), rounded-2xl corners, shadow-lg\n2. **Question Containers**: Generous padding (p-8), large question text, 4 answer buttons stacked with gap-4\n3. **Answer Buttons**: Full-width, h-16, rounded-xl, colored borders (3px), active state with scale transform\n4. **Feedback Screens**: Full-screen overlays with confetti animation (correct) or encouraging emoji (incorrect), auto-dismiss after 2s\n5. **Progress Bar**: Thick (h-3), colorful gradient fill, shows X/total questions\n6. **Achievement Displays**: Large star icons (⭐ 64px), animated entrance, badge cards with shine effect\n\n---\n\n## Visual Elements & Images\n\n**Images Usage**:\n- Parent dashboard: No hero image needed, focus on data/cards\n- Parent reports: Include small thumbnail of uploaded textbook pages\n- Child app: Large decorative illustrations for each subject (math: numbers/shapes, science: beakers/planets, Arabic: calligraphy elements)\n- Achievement screens: Celebratory graphics (balloons, confetti, trophy icons)\n\n**Icons**: Lucide React throughout for consistency\n- Parent: outline style, 20-24px\n- Child: filled/solid style, 32-40px\n\n**Backgrounds**:\n- Parent: Clean white (bg-white) and light gray (bg-gray-50) surfaces\n- Child: Gradient backgrounds - `bg-gradient-to-br from-pink-100 via-purple-50 to-blue-100` for main screens, solid bright colors for subject cards\n\n---\n\n## Interactions & Animations\n\n**Parent App**: Minimal animations\n- Hover: subtle scale (scale-105) on cards\n- Transitions: duration-200 for all state changes\n- Loading: Simple spinner for processing states\n\n**Child App**: Celebratory animations\n- Confetti: Use canvas-confetti library on correct answers\n- Button press: scale-95 active state with spring animation\n- Page transitions: Slide from right (Framer Motion slideIn)\n- Stars: Bounce entrance animation (animate-bounce) when earned\n- NO hover states (touch-first design)\n\n---\n\n## Accessibility & Responsiveness\n\n- Focus indicators: ring-2 ring-offset-2 for keyboard navigation\n- Color contrast: WCAG AA minimum (4.5:1 for body text)\n- Mobile-first: All layouts stack to single column below md breakpoint\n- Form validation: Inline error messages in red-500, success in green-500\n- Loading states: Skeleton screens during AI processing (animate-pulse)\n\n---\n\n## Key Pages Layout\n\n**Parent Home**: Grid of child cards, prominent \"Add Chapter\" button (bg-blue-600, top right), recent activity list below\n\n**Upload Flow**: Centered form (max-w-2xl), child selector dropdown, drag-drop zone, preview grid, submit button at bottom\n\n**Child Learning Screen**: Full-screen layout, progress bar fixed at top, content centered (max-w-3xl), large navigation buttons at bottom\n\n**Results Screen**: Centered celebration (confetti canvas background), stacked metrics (stars, score, time), \"Continue\" button prominent at bottom","path":null,"size_bytes":5530,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"server/stripeService.ts":{"content":"import { getUncachableStripeClient } from './stripeClient';\nimport { db } from './db';\nimport { users } from '@shared/schema';\nimport { eq, sql } from 'drizzle-orm';\n\nexport class StripeService {\n  async createCustomer(email: string, userId: string, fullName: string) {\n    const stripe = await getUncachableStripeClient();\n    return await stripe.customers.create({\n      email,\n      name: fullName,\n      metadata: { userId },\n    });\n  }\n\n  async createCheckoutSession(customerId: string, priceId: string, successUrl: string, cancelUrl: string) {\n    const stripe = await getUncachableStripeClient();\n    return await stripe.checkout.sessions.create({\n      customer: customerId,\n      payment_method_types: ['card'],\n      line_items: [{ price: priceId, quantity: 1 }],\n      mode: 'subscription',\n      success_url: successUrl,\n      cancel_url: cancelUrl,\n    });\n  }\n\n  async createCustomerPortalSession(customerId: string, returnUrl: string) {\n    const stripe = await getUncachableStripeClient();\n    return await stripe.billingPortal.sessions.create({\n      customer: customerId,\n      return_url: returnUrl,\n    });\n  }\n\n  async getProduct(productId: string) {\n    const result = await db.execute(\n      sql`SELECT * FROM stripe.products WHERE id = ${productId}`\n    );\n    return result.rows[0] || null;\n  }\n\n  async listProducts(active = true, limit = 20, offset = 0) {\n    const result = await db.execute(\n      sql`SELECT * FROM stripe.products WHERE active = ${active} LIMIT ${limit} OFFSET ${offset}`\n    );\n    return result.rows;\n  }\n\n  async listProductsWithPrices(active = true, limit = 20, offset = 0) {\n    const result = await db.execute(\n      sql`\n        WITH paginated_products AS (\n          SELECT id, name, description, metadata, active\n          FROM stripe.products\n          WHERE active = ${active}\n          ORDER BY id\n          LIMIT ${limit} OFFSET ${offset}\n        )\n        SELECT \n          p.id as product_id,\n          p.name as product_name,\n          p.description as product_description,\n          p.active as product_active,\n          p.metadata as product_metadata,\n          pr.id as price_id,\n          pr.unit_amount,\n          pr.currency,\n          pr.recurring,\n          pr.active as price_active,\n          pr.metadata as price_metadata\n        FROM paginated_products p\n        LEFT JOIN stripe.prices pr ON pr.product = p.id AND pr.active = true\n        ORDER BY p.id, pr.unit_amount\n      `\n    );\n    return result.rows;\n  }\n\n  async getPrice(priceId: string) {\n    const result = await db.execute(\n      sql`SELECT * FROM stripe.prices WHERE id = ${priceId}`\n    );\n    return result.rows[0] || null;\n  }\n\n  async listPrices(active = true, limit = 20, offset = 0) {\n    const result = await db.execute(\n      sql`SELECT * FROM stripe.prices WHERE active = ${active} LIMIT ${limit} OFFSET ${offset}`\n    );\n    return result.rows;\n  }\n\n  async getPricesForProduct(productId: string) {\n    const result = await db.execute(\n      sql`SELECT * FROM stripe.prices WHERE product = ${productId} AND active = true`\n    );\n    return result.rows;\n  }\n\n  async getSubscription(subscriptionId: string) {\n    const result = await db.execute(\n      sql`SELECT * FROM stripe.subscriptions WHERE id = ${subscriptionId}`\n    );\n    return result.rows[0] || null;\n  }\n\n  async getUser(id: string) {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async updateUserStripeInfo(userId: string, stripeInfo: {\n    stripeCustomerId?: string;\n    stripeSubscriptionId?: string;\n    subscriptionTier?: string;\n    subscriptionStatus?: string;\n  }) {\n    const [user] = await db.update(users).set(stripeInfo).where(eq(users.id, userId)).returning();\n    return user;\n  }\n}\n\nexport const stripeService = new StripeService();\n","path":null,"size_bytes":3811,"size_tokens":null},"client/src/pages/notifications.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ArrowRight, Bell, BookOpen, Trophy, TrendingUp, Flame, Check, CheckCheck } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { Notification, NotificationPreferences } from \"@shared/schema\";\n\nexport default function Notifications() {\n  const userId = localStorage.getItem(\"userId\");\n\n  const { data: notificationsList, isLoading } = useQuery<Notification[]>({\n    queryKey: [`/api/users/${userId}/notifications`],\n    enabled: !!userId,\n  });\n\n  const { data: preferences } = useQuery<NotificationPreferences>({\n    queryKey: [`/api/users/${userId}/notification-preferences`],\n    enabled: !!userId,\n  });\n\n  const markReadMutation = useMutation({\n    mutationFn: async (notificationId: string) => {\n      return apiRequest(\"PATCH\", `/api/notifications/${notificationId}/read`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/users/${userId}/notifications`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/users/${userId}/notifications/unread-count`] });\n    },\n  });\n\n  const markAllReadMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"PATCH\", `/api/users/${userId}/notifications/read-all`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/users/${userId}/notifications`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/users/${userId}/notifications/unread-count`] });\n    },\n  });\n\n  const updatePreferencesMutation = useMutation({\n    mutationFn: async (newPreferences: NotificationPreferences) => {\n      return apiRequest(\"PATCH\", `/api/users/${userId}/notification-preferences`, newPreferences);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/users/${userId}/notification-preferences`] });\n    },\n  });\n\n  const getNotificationIcon = (type: string) => {\n    switch (type) {\n      case \"chapter_complete\":\n        return <BookOpen className=\"w-5 h-5 text-blue-600\" />;\n      case \"badge_earned\":\n        return <Trophy className=\"w-5 h-5 text-yellow-600\" />;\n      case \"weekly_report\":\n        return <TrendingUp className=\"w-5 h-5 text-green-600\" />;\n      case \"streak_reminder\":\n        return <Flame className=\"w-5 h-5 text-orange-600\" />;\n      default:\n        return <Bell className=\"w-5 h-5 text-gray-600\" />;\n    }\n  };\n\n  const formatDate = (date: Date | string | null) => {\n    if (!date) return \"\";\n    const d = new Date(date);\n    const now = new Date();\n    const diffMs = now.getTime() - d.getTime();\n    const diffMins = Math.floor(diffMs / 60000);\n    const diffHours = Math.floor(diffMs / 3600000);\n    const diffDays = Math.floor(diffMs / 86400000);\n\n    if (diffMins < 1) return \"الآن\";\n    if (diffMins < 60) return `منذ ${diffMins} دقيقة`;\n    if (diffHours < 24) return `منذ ${diffHours} ساعة`;\n    if (diffDays < 7) return `منذ ${diffDays} أيام`;\n    return d.toLocaleDateString(\"ar-SA\");\n  };\n\n  const handlePreferenceChange = (key: keyof NotificationPreferences, value: boolean) => {\n    if (!preferences) return;\n    updatePreferencesMutation.mutate({ ...preferences, [key]: value });\n  };\n\n  const unreadCount = notificationsList?.filter(n => !n.read).length || 0;\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background\" dir=\"rtl\">\n        <div className=\"max-w-3xl mx-auto p-6\">\n          <Skeleton className=\"h-10 w-48 mb-6\" />\n          <div className=\"space-y-4\">\n            {[1, 2, 3].map(i => (\n              <Skeleton key={i} className=\"h-24 w-full\" />\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\" dir=\"rtl\">\n      <header className=\"bg-white border-b sticky top-0 z-50\">\n        <div className=\"max-w-3xl mx-auto px-4\">\n          <div className=\"flex items-center h-16 gap-4\">\n            <Link href=\"/dashboard\">\n              <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n                <ArrowRight className=\"w-5 h-5\" />\n              </Button>\n            </Link>\n            <div className=\"flex-1\">\n              <h1 className=\"font-arabic font-bold text-xl\">الإشعارات</h1>\n            </div>\n            {unreadCount > 0 && (\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => markAllReadMutation.mutate()}\n                disabled={markAllReadMutation.isPending}\n                data-testid=\"button-mark-all-read\"\n              >\n                <CheckCheck className=\"w-4 h-4 ml-2\" />\n                قراءة الكل\n              </Button>\n            )}\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-3xl mx-auto p-6 space-y-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"font-arabic text-lg\">إعدادات الإشعارات</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"font-arabic font-medium\">إكمال الفصول</p>\n                <p className=\"text-sm text-muted-foreground font-arabic\">\n                  إشعار عند إكمال طفلك لفصل جديد\n                </p>\n              </div>\n              <Switch\n                checked={preferences?.chapterComplete ?? true}\n                onCheckedChange={(v) => handlePreferenceChange(\"chapterComplete\", v)}\n                data-testid=\"switch-chapter-complete\"\n              />\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"font-arabic font-medium\">الشارات المكتسبة</p>\n                <p className=\"text-sm text-muted-foreground font-arabic\">\n                  إشعار عند حصول طفلك على شارة جديدة\n                </p>\n              </div>\n              <Switch\n                checked={preferences?.badgeEarned ?? true}\n                onCheckedChange={(v) => handlePreferenceChange(\"badgeEarned\", v)}\n                data-testid=\"switch-badge-earned\"\n              />\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"font-arabic font-medium\">التقرير الأسبوعي</p>\n                <p className=\"text-sm text-muted-foreground font-arabic\">\n                  ملخص أسبوعي لتقدم أطفالك\n                </p>\n              </div>\n              <Switch\n                checked={preferences?.weeklyReport ?? true}\n                onCheckedChange={(v) => handlePreferenceChange(\"weeklyReport\", v)}\n                data-testid=\"switch-weekly-report\"\n              />\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"font-arabic font-medium\">تذكير السلسلة</p>\n                <p className=\"text-sm text-muted-foreground font-arabic\">\n                  تذكير للحفاظ على سلسلة التعلم\n                </p>\n              </div>\n              <Switch\n                checked={preferences?.streakReminder ?? false}\n                onCheckedChange={(v) => handlePreferenceChange(\"streakReminder\", v)}\n                data-testid=\"switch-streak-reminder\"\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        <div className=\"space-y-3\">\n          <h2 className=\"font-arabic font-bold text-lg\">الإشعارات الأخيرة</h2>\n          \n          {!notificationsList?.length ? (\n            <Card className=\"text-center py-12\">\n              <Bell className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n              <p className=\"font-arabic text-muted-foreground\">لا توجد إشعارات</p>\n            </Card>\n          ) : (\n            notificationsList.map((notification) => (\n              <Card\n                key={notification.id}\n                className={`transition-colors ${!notification.read ? \"bg-blue-50/50 dark:bg-blue-950/20\" : \"\"}`}\n                data-testid={`notification-${notification.id}`}\n              >\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-start gap-4\">\n                    <div className=\"p-2 rounded-full bg-muted\">\n                      {getNotificationIcon(notification.type)}\n                    </div>\n                    <div className=\"flex-1\">\n                      <p className=\"font-arabic font-medium\">{notification.titleAr}</p>\n                      <p className=\"text-sm text-muted-foreground font-arabic mt-1\">\n                        {notification.messageAr}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground mt-2\">\n                        {formatDate(notification.createdAt)}\n                      </p>\n                    </div>\n                    {!notification.read && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => markReadMutation.mutate(notification.id)}\n                        disabled={markReadMutation.isPending}\n                        data-testid={`button-mark-read-${notification.id}`}\n                      >\n                        <Check className=\"w-4 h-4\" />\n                      </Button>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          )}\n        </div>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":9953,"size_tokens":null},"client/src/lib/pdf-export.ts":{"content":"import { jsPDF } from \"jspdf\";\nimport html2canvas from \"html2canvas\";\nimport type { ChapterResult, Chapter, Child, ChapterContent } from \"@shared/schema\";\n\ninterface ReportData {\n  result: ChapterResult;\n  chapter: Chapter;\n  child?: Child;\n}\n\nexport async function exportReportToPDF(data: ReportData): Promise<void> {\n  const { result, chapter, child } = data;\n\n  const pdf = new jsPDF({\n    orientation: \"portrait\",\n    unit: \"mm\",\n    format: \"a4\",\n  });\n\n  const pageWidth = pdf.internal.pageSize.getWidth();\n  const pageHeight = pdf.internal.pageSize.getHeight();\n  const margin = 15;\n  const contentWidth = pageWidth - margin * 2;\n  let yPosition = margin;\n\n  const percentage = Math.round((result.totalScore! / 15) * 100);\n  const stars = result.stars || 0;\n  const timeMinutes = Math.floor((result.timeSpentSeconds || 0) / 60);\n  const timeSeconds = (result.timeSpentSeconds || 0) % 60;\n\n  pdf.setFillColor(59, 130, 246);\n  pdf.rect(0, 0, pageWidth, 40, \"F\");\n\n  pdf.setTextColor(255, 255, 255);\n  pdf.setFontSize(24);\n  pdf.text(\"LearnSnap\", pageWidth / 2, 15, { align: \"center\" });\n  \n  pdf.setFontSize(14);\n  pdf.text(\"Performance Report\", pageWidth / 2, 25, { align: \"center\" });\n  pdf.text(chapter.title || \"Chapter Report\", pageWidth / 2, 33, { align: \"center\" });\n\n  yPosition = 50;\n\n  pdf.setTextColor(0, 0, 0);\n  pdf.setFontSize(12);\n  \n  const reportDate = new Date().toLocaleDateString(\"ar-SA\", {\n    year: \"numeric\",\n    month: \"long\",\n    day: \"numeric\",\n  });\n  \n  if (child) {\n    pdf.text(`Student: ${child.name}`, margin, yPosition);\n    yPosition += 7;\n  }\n  pdf.text(`Date: ${reportDate}`, margin, yPosition);\n  yPosition += 7;\n  pdf.text(`Subject: ${chapter.subject || \"General\"}`, margin, yPosition);\n  yPosition += 15;\n\n  pdf.setFillColor(240, 253, 244);\n  pdf.roundedRect(margin, yPosition, contentWidth, 45, 3, 3, \"F\");\n  \n  pdf.setFontSize(16);\n  pdf.setTextColor(22, 101, 52);\n  pdf.text(\"Overall Score\", margin + contentWidth / 2, yPosition + 10, { align: \"center\" });\n  \n  pdf.setFontSize(36);\n  pdf.text(`${percentage}%`, margin + contentWidth / 2, yPosition + 28, { align: \"center\" });\n  \n  pdf.setFontSize(12);\n  const starText = `${\"*\".repeat(stars)}${\"o\".repeat(5 - stars)}`;\n  pdf.text(starText, margin + contentWidth / 2, yPosition + 38, { align: \"center\" });\n  \n  yPosition += 55;\n\n  pdf.setTextColor(0, 0, 0);\n  pdf.setFontSize(14);\n  pdf.text(\"Score Breakdown\", margin, yPosition);\n  yPosition += 10;\n  \n  pdf.setFillColor(229, 231, 235);\n  pdf.roundedRect(margin, yPosition, contentWidth, 8, 2, 2, \"F\");\n  pdf.setFillColor(34, 197, 94);\n  const practiceWidth = ((result.practiceScore || 0) / 5) * contentWidth;\n  pdf.roundedRect(margin, yPosition, practiceWidth, 8, 2, 2, \"F\");\n  pdf.setFontSize(10);\n  pdf.text(`Practice: ${result.practiceScore}/5`, margin, yPosition + 15);\n  yPosition += 25;\n  \n  pdf.setFillColor(229, 231, 235);\n  pdf.roundedRect(margin, yPosition, contentWidth, 8, 2, 2, \"F\");\n  pdf.setFillColor(59, 130, 246);\n  const testWidth = ((result.testScore || 0) / 10) * contentWidth;\n  pdf.roundedRect(margin, yPosition, testWidth, 8, 2, 2, \"F\");\n  pdf.text(`Test: ${result.testScore}/10`, margin, yPosition + 15);\n  yPosition += 25;\n  \n  const timeText = timeMinutes > 0 \n    ? `Time Spent: ${timeMinutes} min ${timeSeconds} sec` \n    : `Time Spent: ${timeSeconds} sec`;\n  pdf.text(timeText, margin, yPosition);\n  yPosition += 15;\n\n  let parsedContent: ChapterContent | null = null;\n  try {\n    parsedContent = typeof chapter.content === \"string\" \n      ? JSON.parse(chapter.content) \n      : chapter.content;\n  } catch {\n    parsedContent = chapter.content || null;\n  }\n  \n  const practiceQuestions = parsedContent?.practice || [];\n  const testQuestions = parsedContent?.test || [];\n  const answers = result.answers as { practiceAnswers: string[]; testAnswers: string[] } | null;\n\n  const allResults = [\n    ...practiceQuestions.map((q, i) => ({\n      question: q.question,\n      isCorrect: answers?.practiceAnswers?.[i] === q.correct,\n      type: \"practice\" as const,\n    })),\n    ...testQuestions.map((q, i) => ({\n      question: q.question,\n      isCorrect: answers?.testAnswers?.[i] === q.correct,\n      type: \"test\" as const,\n    })),\n  ];\n\n  const strengths = allResults.filter((r) => r.isCorrect);\n  const weaknesses = allResults.filter((r) => !r.isCorrect);\n\n  if (strengths.length > 0) {\n    pdf.setFontSize(14);\n    pdf.setTextColor(22, 101, 52);\n    pdf.text(`Strengths (${strengths.length})`, margin, yPosition);\n    yPosition += 8;\n    \n    pdf.setFontSize(10);\n    pdf.setTextColor(0, 0, 0);\n    strengths.slice(0, 5).forEach((item) => {\n      if (yPosition > pageHeight - 30) {\n        pdf.addPage();\n        yPosition = margin;\n      }\n      const text = `+ ${item.question.substring(0, 70)}${item.question.length > 70 ? \"...\" : \"\"}`;\n      pdf.text(text, margin + 5, yPosition);\n      yPosition += 6;\n    });\n    yPosition += 10;\n  }\n\n  if (weaknesses.length > 0) {\n    if (yPosition > pageHeight - 60) {\n      pdf.addPage();\n      yPosition = margin;\n    }\n    \n    pdf.setFontSize(14);\n    pdf.setTextColor(180, 83, 9);\n    pdf.text(`Needs Improvement (${weaknesses.length})`, margin, yPosition);\n    yPosition += 8;\n    \n    pdf.setFontSize(10);\n    pdf.setTextColor(0, 0, 0);\n    weaknesses.slice(0, 5).forEach((item) => {\n      if (yPosition > pageHeight - 30) {\n        pdf.addPage();\n        yPosition = margin;\n      }\n      const text = `- ${item.question.substring(0, 70)}${item.question.length > 70 ? \"...\" : \"\"}`;\n      pdf.text(text, margin + 5, yPosition);\n      yPosition += 6;\n    });\n    yPosition += 10;\n  }\n\n  if (weaknesses.length > 0) {\n    if (yPosition > pageHeight - 50) {\n      pdf.addPage();\n      yPosition = margin;\n    }\n    \n    pdf.setFillColor(239, 246, 255);\n    pdf.roundedRect(margin, yPosition, contentWidth, 35, 3, 3, \"F\");\n    \n    pdf.setFontSize(12);\n    pdf.setTextColor(30, 64, 175);\n    pdf.text(\"Recommendations\", margin + 5, yPosition + 8);\n    \n    pdf.setFontSize(9);\n    pdf.text(\"1. Review the questions that were answered incorrectly\", margin + 5, yPosition + 16);\n    pdf.text(\"2. Re-read the lesson focusing on difficult concepts\", margin + 5, yPosition + 22);\n    pdf.text(\"3. Try the test again after reviewing\", margin + 5, yPosition + 28);\n  }\n\n  pdf.setFontSize(8);\n  pdf.setTextColor(128, 128, 128);\n  pdf.text(\n    `Generated by LearnSnap - ${new Date().toISOString().split(\"T\")[0]}`,\n    pageWidth / 2,\n    pageHeight - 10,\n    { align: \"center\" }\n  );\n\n  const fileName = `LearnSnap_Report_${chapter.title?.replace(/\\s+/g, \"_\") || \"Chapter\"}_${new Date().toISOString().split(\"T\")[0]}.pdf`;\n  pdf.save(fileName);\n}\n\nexport async function captureChartToPDF(elementId: string): Promise<string | null> {\n  const element = document.getElementById(elementId);\n  if (!element) return null;\n\n  try {\n    const canvas = await html2canvas(element, {\n      scale: 2,\n      useCORS: true,\n      logging: false,\n    });\n    return canvas.toDataURL(\"image/png\");\n  } catch (error) {\n    console.error(\"Failed to capture chart:\", error);\n    return null;\n  }\n}\n","path":null,"size_bytes":7089,"size_tokens":null},"client/src/pages/analytics.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { ArrowRight, Clock, BookOpen, Trophy, TrendingUp, Users, BarChart3 } from \"lucide-react\";\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell, LineChart, Line } from \"recharts\";\nimport { useState } from \"react\";\nimport type { Child } from \"@shared/schema\";\n\ninterface ChildAnalytics {\n  totalLearningTime: number;\n  subjectPerformance: { subject: string; avgScore: number; count: number }[];\n  weeklyProgress: { date: string; chaptersCompleted: number; learningTime: number }[];\n  recentActivity: { date: string; chapterTitle: string; score: number; timeSpent: number }[];\n}\n\ninterface ParentAnalytics {\n  childrenStats: { childId: string; name: string; totalChapters: number; avgScore: number; totalTime: number }[];\n  subjectOverview: { subject: string; avgScore: number; totalChapters: number }[];\n}\n\nconst SUBJECT_LABELS: Record<string, string> = {\n  math: \"الرياضيات\",\n  science: \"العلوم\",\n  arabic: \"اللغة العربية\",\n  english: \"اللغة الإنجليزية\",\n  islamic: \"التربية الإسلامية\",\n  social: \"الدراسات الاجتماعية\",\n};\n\nconst CHART_COLORS = [\"#3B82F6\", \"#10B981\", \"#F59E0B\", \"#8B5CF6\", \"#EC4899\", \"#06B6D4\"];\n\nconst formatTime = (seconds: number): string => {\n  if (seconds < 60) return `${seconds} ثانية`;\n  if (seconds < 3600) return `${Math.round(seconds / 60)} دقيقة`;\n  const hours = Math.floor(seconds / 3600);\n  const mins = Math.round((seconds % 3600) / 60);\n  return `${hours} ساعة ${mins > 0 ? `و ${mins} دقيقة` : \"\"}`;\n};\n\nconst formatDate = (dateStr: string): string => {\n  const date = new Date(dateStr);\n  return date.toLocaleDateString(\"ar-SA\", { weekday: \"short\", day: \"numeric\", month: \"short\" });\n};\n\nexport default function AnalyticsPage() {\n  const [, setLocation] = useLocation();\n  const [selectedChildId, setSelectedChildId] = useState<string | null>(null);\n  \n  const userId = localStorage.getItem(\"userId\");\n\n  const { data: children } = useQuery<Child[]>({\n    queryKey: [\"/api/children\", { parentId: userId }],\n    enabled: !!userId,\n  });\n\n  const { data: parentAnalytics, isLoading: parentLoading } = useQuery<ParentAnalytics>({\n    queryKey: [\"/api/analytics/parent\", userId],\n    enabled: !!userId,\n  });\n\n  const { data: childAnalytics, isLoading: childLoading } = useQuery<ChildAnalytics>({\n    queryKey: [\"/api/analytics/child\", selectedChildId],\n    enabled: !!selectedChildId,\n  });\n\n  if (!userId) {\n    setLocation(\"/auth\");\n    return null;\n  }\n\n  const totalLearningTime = parentAnalytics?.childrenStats.reduce((sum, c) => sum + c.totalTime, 0) || 0;\n  const totalChapters = parentAnalytics?.childrenStats.reduce((sum, c) => sum + c.totalChapters, 0) || 0;\n  const avgScore = parentAnalytics?.childrenStats.length \n    ? Math.round(parentAnalytics.childrenStats.reduce((sum, c) => sum + c.avgScore, 0) / parentAnalytics.childrenStats.length)\n    : 0;\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-emerald-50\" dir=\"rtl\">\n      <header className=\"bg-white/80 backdrop-blur border-b sticky top-0 z-50\">\n        <div className=\"container mx-auto px-4 py-3 flex items-center justify-between gap-4\">\n          <div className=\"flex items-center gap-3\">\n            <Button \n              variant=\"ghost\" \n              size=\"icon\" \n              onClick={() => setLocation(\"/dashboard\")}\n              data-testid=\"button-back\"\n            >\n              <ArrowRight className=\"w-5 h-5\" />\n            </Button>\n            <div>\n              <h1 className=\"text-xl font-bold font-arabic text-foreground\">تحليلات التعلم</h1>\n              <p className=\"text-sm text-muted-foreground font-arabic\">تتبع تقدم أطفالك</p>\n            </div>\n          </div>\n          <BarChart3 className=\"w-8 h-8 text-blue-500\" />\n        </div>\n      </header>\n\n      <main className=\"container mx-auto px-4 py-6 space-y-6\">\n        {/* Overview Stats */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          <Card>\n            <CardContent className=\"flex items-center gap-4 p-6\">\n              <div className=\"w-12 h-12 rounded-xl bg-blue-100 flex items-center justify-center\">\n                <Clock className=\"w-6 h-6 text-blue-600\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground font-arabic\">إجمالي وقت التعلم</p>\n                <p className=\"text-2xl font-bold text-foreground\" data-testid=\"text-total-time\">\n                  {formatTime(totalLearningTime)}\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"flex items-center gap-4 p-6\">\n              <div className=\"w-12 h-12 rounded-xl bg-emerald-100 flex items-center justify-center\">\n                <BookOpen className=\"w-6 h-6 text-emerald-600\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground font-arabic\">الفصول المكتملة</p>\n                <p className=\"text-2xl font-bold text-foreground\" data-testid=\"text-total-chapters\">\n                  {totalChapters}\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"flex items-center gap-4 p-6\">\n              <div className=\"w-12 h-12 rounded-xl bg-amber-100 flex items-center justify-center\">\n                <Trophy className=\"w-6 h-6 text-amber-600\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground font-arabic\">متوسط الدرجات</p>\n                <p className=\"text-2xl font-bold text-foreground\" data-testid=\"text-avg-score\">\n                  {avgScore}%\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Children Performance Comparison */}\n        {parentAnalytics && parentAnalytics.childrenStats.length > 0 && (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 font-arabic\">\n                <Users className=\"w-5 h-5\" />\n                أداء الأطفال\n              </CardTitle>\n              <CardDescription className=\"font-arabic\">مقارنة أداء جميع الأطفال</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"h-64\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <BarChart data={parentAnalytics.childrenStats} layout=\"vertical\">\n                    <CartesianGrid strokeDasharray=\"3 3\" />\n                    <XAxis type=\"number\" domain={[0, 100]} />\n                    <YAxis dataKey=\"name\" type=\"category\" width={80} />\n                    <Tooltip \n                      formatter={(value: number) => [`${value}%`, \"متوسط الدرجات\"]}\n                      labelFormatter={(name) => name}\n                    />\n                    <Bar dataKey=\"avgScore\" fill=\"#3B82F6\" radius={[0, 4, 4, 0]} />\n                  </BarChart>\n                </ResponsiveContainer>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Subject Overview */}\n        {parentAnalytics && parentAnalytics.subjectOverview.length > 0 && (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 font-arabic\">\n                <TrendingUp className=\"w-5 h-5\" />\n                أداء المواد\n              </CardTitle>\n              <CardDescription className=\"font-arabic\">متوسط الدرجات حسب المادة</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"h-64 flex\">\n                <div className=\"flex-1\">\n                  <ResponsiveContainer width=\"100%\" height=\"100%\">\n                    <PieChart>\n                      <Pie\n                        data={parentAnalytics.subjectOverview.map(s => ({\n                          ...s,\n                          name: SUBJECT_LABELS[s.subject] || s.subject,\n                        }))}\n                        cx=\"50%\"\n                        cy=\"50%\"\n                        innerRadius={60}\n                        outerRadius={80}\n                        dataKey=\"totalChapters\"\n                        nameKey=\"name\"\n                        label={(entry) => entry.name}\n                      >\n                        {parentAnalytics.subjectOverview.map((_, index) => (\n                          <Cell key={`cell-${index}`} fill={CHART_COLORS[index % CHART_COLORS.length]} />\n                        ))}\n                      </Pie>\n                      <Tooltip formatter={(value: number, name: string) => [value, \"عدد الفصول\"]} />\n                    </PieChart>\n                  </ResponsiveContainer>\n                </div>\n                <div className=\"w-1/3 space-y-2\">\n                  {parentAnalytics.subjectOverview.map((subject, index) => (\n                    <div key={subject.subject} className=\"flex items-center gap-2\">\n                      <div \n                        className=\"w-3 h-3 rounded-full\" \n                        style={{ backgroundColor: CHART_COLORS[index % CHART_COLORS.length] }} \n                      />\n                      <span className=\"text-sm font-arabic text-foreground\">\n                        {SUBJECT_LABELS[subject.subject] || subject.subject}\n                      </span>\n                      <span className=\"text-sm text-muted-foreground mr-auto\">\n                        {subject.avgScore}%\n                      </span>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Individual Child Analytics */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"font-arabic\">تفاصيل الطفل</CardTitle>\n            <CardDescription className=\"font-arabic\">اختر طفلاً لعرض تحليلات مفصلة</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <Select value={selectedChildId || \"\"} onValueChange={setSelectedChildId}>\n              <SelectTrigger data-testid=\"select-child\">\n                <SelectValue placeholder=\"اختر طفلاً\" />\n              </SelectTrigger>\n              <SelectContent>\n                {children?.map((child) => (\n                  <SelectItem key={child.id} value={child.id}>\n                    {child.name}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n\n            {childLoading && (\n              <div className=\"text-center py-8 text-muted-foreground font-arabic\">\n                جاري التحميل...\n              </div>\n            )}\n\n            {childAnalytics && (\n              <div className=\"space-y-6\">\n                {/* Weekly Progress Chart */}\n                <div>\n                  <h3 className=\"font-semibold mb-4 font-arabic\">التقدم الأسبوعي</h3>\n                  <div className=\"h-48\">\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                      <LineChart data={childAnalytics.weeklyProgress}>\n                        <CartesianGrid strokeDasharray=\"3 3\" />\n                        <XAxis \n                          dataKey=\"date\" \n                          tickFormatter={(d) => formatDate(d)}\n                          fontSize={12}\n                        />\n                        <YAxis />\n                        <Tooltip \n                          labelFormatter={(d) => formatDate(d as string)}\n                          formatter={(value: number, name: string) => [\n                            name === \"chaptersCompleted\" ? value : formatTime(value as number),\n                            name === \"chaptersCompleted\" ? \"الفصول\" : \"وقت التعلم\"\n                          ]}\n                        />\n                        <Line \n                          type=\"monotone\" \n                          dataKey=\"chaptersCompleted\" \n                          stroke=\"#3B82F6\" \n                          strokeWidth={2}\n                          name=\"الفصول\"\n                        />\n                      </LineChart>\n                    </ResponsiveContainer>\n                  </div>\n                </div>\n\n                {/* Subject Performance */}\n                {childAnalytics.subjectPerformance.length > 0 && (\n                  <div>\n                    <h3 className=\"font-semibold mb-4 font-arabic\">أداء المواد</h3>\n                    <div className=\"h-48\">\n                      <ResponsiveContainer width=\"100%\" height=\"100%\">\n                        <BarChart data={childAnalytics.subjectPerformance.map(s => ({\n                          ...s,\n                          subject: SUBJECT_LABELS[s.subject] || s.subject,\n                        }))}>\n                          <CartesianGrid strokeDasharray=\"3 3\" />\n                          <XAxis dataKey=\"subject\" fontSize={12} />\n                          <YAxis domain={[0, 100]} />\n                          <Tooltip formatter={(value: number) => [`${value}%`, \"متوسط الدرجات\"]} />\n                          <Bar dataKey=\"avgScore\" fill=\"#10B981\" radius={[4, 4, 0, 0]} />\n                        </BarChart>\n                      </ResponsiveContainer>\n                    </div>\n                  </div>\n                )}\n\n                {/* Recent Activity */}\n                {childAnalytics.recentActivity.length > 0 && (\n                  <div>\n                    <h3 className=\"font-semibold mb-4 font-arabic\">النشاط الأخير</h3>\n                    <div className=\"space-y-2\">\n                      {childAnalytics.recentActivity.map((activity, index) => (\n                        <div \n                          key={index}\n                          className=\"flex items-center justify-between p-3 bg-muted/50 rounded-lg\"\n                        >\n                          <div>\n                            <p className=\"font-medium font-arabic text-foreground\">{activity.chapterTitle}</p>\n                            <p className=\"text-sm text-muted-foreground\">{formatDate(activity.date)}</p>\n                          </div>\n                          <div className=\"text-left\">\n                            <p className=\"font-bold text-foreground\">{activity.score}%</p>\n                            <p className=\"text-xs text-muted-foreground\">{formatTime(activity.timeSpent)}</p>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":15296,"size_tokens":null},"client/src/pages/badges.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useParams, Link } from \"wouter\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ArrowRight, Trophy, Star, Flame, Crown, Zap, BookOpen, Calculator, Beaker, GraduationCap, Lock, Sparkles, Award, Target, Rocket } from \"lucide-react\";\nimport type { Badge as BadgeType, ChildBadge } from \"@shared/schema\";\n\nconst iconMap: Record<string, any> = {\n  Footprints: Rocket, // Using Rocket as fallback for Footprints\n  Star,\n  Flame,\n  Trophy,\n  Calculator,\n  Beaker,\n  BookOpen,\n  GraduationCap,\n  Zap,\n  Crown,\n  Award,\n  Target,\n  Rocket,\n};\n\nconst colorMap: Record<string, string> = {\n  amber: \"from-amber-400 to-amber-600\",\n  yellow: \"from-yellow-400 to-yellow-600\",\n  orange: \"from-orange-400 to-orange-600\",\n  purple: \"from-purple-400 to-purple-600\",\n  blue: \"from-blue-400 to-blue-600\",\n  green: \"from-green-400 to-green-600\",\n  teal: \"from-teal-400 to-teal-600\",\n  indigo: \"from-indigo-400 to-indigo-600\",\n  cyan: \"from-cyan-400 to-cyan-600\",\n  gold: \"from-yellow-500 to-amber-600\",\n};\n\nconst rarityColors: Record<string, string> = {\n  common: \"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300\",\n  rare: \"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300\",\n  epic: \"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300\",\n  legendary: \"bg-amber-100 text-amber-700 dark:bg-amber-900 dark:text-amber-300\",\n};\n\nconst rarityNamesAr: Record<string, string> = {\n  common: \"عادي\",\n  rare: \"نادر\",\n  epic: \"ملحمي\",\n  legendary: \"أسطوري\",\n};\n\nexport default function BadgesPage() {\n  const params = useParams<{ childId: string }>();\n  const childId = params.childId;\n\n  const { data: allBadges, isLoading: loadingAll } = useQuery<BadgeType[]>({\n    queryKey: [\"/api/badges\"],\n  });\n\n  const { data: earnedBadges, isLoading: loadingEarned } = useQuery<(ChildBadge & { badge: BadgeType })[]>({\n    queryKey: [\"/api/children\", childId, \"badges\"],\n    enabled: !!childId,\n  });\n\n  const earnedIds = new Set(earnedBadges?.map((cb) => cb.badgeId) || []);\n\n  if (loadingAll || loadingEarned) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-coral-100 via-turquoise-50 to-sunny-100 flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-4 border-turquoise-500 border-t-transparent\" />\n      </div>\n    );\n  }\n\n  const earnedCount = earnedBadges?.length || 0;\n  const totalCount = allBadges?.length || 0;\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-coral-100 via-turquoise-50 to-sunny-100\" dir=\"rtl\">\n      <header className=\"bg-gradient-to-l from-coral-500 to-turquoise-500 text-white p-4 sticky top-0 z-50\">\n        <div className=\"max-w-4xl mx-auto flex items-center justify-between gap-4\">\n          <div className=\"flex items-center gap-3\">\n            <Trophy className=\"w-8 h-8\" />\n            <div>\n              <h1 className=\"font-child text-xl font-bold\">شاراتي</h1>\n              <p className=\"text-sm opacity-90 font-child\">{earnedCount} من {totalCount} شارة</p>\n            </div>\n          </div>\n          <Link href={`/child/${childId}/lessons`}>\n            <Button variant=\"secondary\" size=\"sm\" className=\"font-child gap-2\" data-testid=\"button-back-lessons\">\n              <ArrowRight className=\"w-4 h-4\" />\n              الدروس\n            </Button>\n          </Link>\n        </div>\n      </header>\n\n      <main className=\"max-w-4xl mx-auto p-4 pb-20\">\n        {earnedBadges && earnedBadges.length > 0 && (\n          <section className=\"mb-8\">\n            <h2 className=\"font-child text-xl font-bold text-gray-800 mb-4 flex items-center gap-2\">\n              <Sparkles className=\"w-6 h-6 text-amber-500\" />\n              الشارات المكتسبة\n            </h2>\n            <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-4\">\n              {earnedBadges.map((cb) => {\n                const IconComponent = iconMap[cb.badge.icon] || Star;\n                const gradientClass = colorMap[cb.badge.color] || \"from-gray-400 to-gray-600\";\n                \n                return (\n                  <Card \n                    key={cb.id} \n                    className=\"overflow-hidden hover-elevate\" \n                    data-testid={`badge-earned-${cb.badgeId}`}\n                  >\n                    <CardContent className=\"p-4 text-center\">\n                      <div className={`w-16 h-16 mx-auto mb-3 rounded-full bg-gradient-to-br ${gradientClass} flex items-center justify-center shadow-lg`}>\n                        <IconComponent className=\"w-8 h-8 text-white\" />\n                      </div>\n                      <h3 className=\"font-child font-bold text-gray-800 mb-1\">{cb.badge.nameAr}</h3>\n                      <p className=\"text-xs text-muted-foreground font-child mb-2\">{cb.badge.descriptionAr}</p>\n                      <Badge className={`${rarityColors[cb.badge.rarity || \"common\"]} text-xs`}>\n                        {rarityNamesAr[cb.badge.rarity || \"common\"]}\n                      </Badge>\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n          </section>\n        )}\n\n        <section>\n          <h2 className=\"font-child text-xl font-bold text-gray-800 mb-4 flex items-center gap-2\">\n            <Lock className=\"w-6 h-6 text-gray-400\" />\n            شارات للفتح\n          </h2>\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-4\">\n            {allBadges?.filter((b) => !earnedIds.has(b.id)).map((badge) => {\n              const IconComponent = iconMap[badge.icon] || Star;\n              \n              return (\n                <Card \n                  key={badge.id} \n                  className=\"overflow-hidden opacity-60\" \n                  data-testid={`badge-locked-${badge.id}`}\n                >\n                  <CardContent className=\"p-4 text-center\">\n                    <div className=\"w-16 h-16 mx-auto mb-3 rounded-full bg-gray-300 dark:bg-gray-700 flex items-center justify-center\">\n                      <Lock className=\"w-8 h-8 text-gray-500\" />\n                    </div>\n                    <h3 className=\"font-child font-bold text-gray-600 dark:text-gray-400 mb-1\">{badge.nameAr}</h3>\n                    <p className=\"text-xs text-muted-foreground font-child mb-2\">{badge.descriptionAr}</p>\n                    <Badge className={`${rarityColors[badge.rarity || \"common\"]} text-xs`}>\n                      {rarityNamesAr[badge.rarity || \"common\"]}\n                    </Badge>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        </section>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":6833,"size_tokens":null},"server/stripeClient.ts":{"content":"import Stripe from 'stripe';\n\nlet connectionSettings: any;\n\nasync function getCredentials() {\n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY\n    ? 'repl ' + process.env.REPL_IDENTITY\n    : process.env.WEB_REPL_RENEWAL\n      ? 'depl ' + process.env.WEB_REPL_RENEWAL\n      : null;\n\n  if (!xReplitToken) {\n    throw new Error('X_REPLIT_TOKEN not found for repl/depl');\n  }\n\n  const connectorName = 'stripe';\n  const isProduction = process.env.REPLIT_DEPLOYMENT === '1';\n  const targetEnvironment = isProduction ? 'production' : 'development';\n\n  const url = new URL(`https://${hostname}/api/v2/connection`);\n  url.searchParams.set('include_secrets', 'true');\n  url.searchParams.set('connector_names', connectorName);\n  url.searchParams.set('environment', targetEnvironment);\n\n  const response = await fetch(url.toString(), {\n    headers: {\n      'Accept': 'application/json',\n      'X_REPLIT_TOKEN': xReplitToken\n    }\n  });\n\n  const data = await response.json();\n  \n  connectionSettings = data.items?.[0];\n\n  if (!connectionSettings || (!connectionSettings.settings.publishable || !connectionSettings.settings.secret)) {\n    throw new Error(`Stripe ${targetEnvironment} connection not found`);\n  }\n\n  return {\n    publishableKey: connectionSettings.settings.publishable,\n    secretKey: connectionSettings.settings.secret,\n  };\n}\n\nexport async function getUncachableStripeClient() {\n  const { secretKey } = await getCredentials();\n\n  return new Stripe(secretKey);\n}\n\nexport async function getStripePublishableKey() {\n  const { publishableKey } = await getCredentials();\n  return publishableKey;\n}\n\nexport async function getStripeSecretKey() {\n  const { secretKey } = await getCredentials();\n  return secretKey;\n}\n\nlet stripeSync: any = null;\n\nexport async function getStripeSync() {\n  if (!stripeSync) {\n    const { StripeSync } = await import('stripe-replit-sync');\n    const secretKey = await getStripeSecretKey();\n\n    stripeSync = new StripeSync({\n      poolConfig: {\n        connectionString: process.env.DATABASE_URL!,\n        max: 2,\n      },\n      stripeSecretKey: secretKey,\n    });\n  }\n  return stripeSync;\n}\n","path":null,"size_bytes":2177,"size_tokens":null},"client/src/pages/content-library.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { \n  ArrowRight, \n  BookOpen, \n  Clock, \n  GraduationCap, \n  Calculator, \n  Beaker, \n  Globe, \n  Moon,\n  Users,\n  Play,\n  Check,\n  Loader2\n} from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { SampleChapter, Child } from \"@shared/schema\";\n\nconst subjectIcons: Record<string, typeof BookOpen> = {\n  math: Calculator,\n  science: Beaker,\n  arabic: BookOpen,\n  english: Globe,\n  islamic: Moon,\n  social: Users,\n};\n\nconst subjectLabels: Record<string, string> = {\n  math: \"رياضيات\",\n  science: \"علوم\",\n  arabic: \"لغة عربية\",\n  english: \"لغة إنجليزية\",\n  islamic: \"تربية إسلامية\",\n  social: \"اجتماعيات\",\n};\n\nconst difficultyLabels: Record<string, string> = {\n  easy: \"سهل\",\n  medium: \"متوسط\",\n  hard: \"صعب\",\n};\n\nconst difficultyColors: Record<string, string> = {\n  easy: \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100\",\n  medium: \"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-100\",\n  hard: \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100\",\n};\n\nexport default function ContentLibrary() {\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const parentId = localStorage.getItem(\"userId\");\n  \n  const [selectedSubject, setSelectedSubject] = useState<string>(\"all\");\n  const [selectedGrade, setSelectedGrade] = useState<string>(\"all\");\n  const [selectedChild, setSelectedChild] = useState<string>(\"\");\n  const [assigningId, setAssigningId] = useState<string | null>(null);\n\n  const { data: sampleChapters, isLoading } = useQuery<SampleChapter[]>({\n    queryKey: [\"/api/sample-chapters\"],\n  });\n\n  const { data: children } = useQuery<Child[]>({\n    queryKey: [\"/api/children\", parentId],\n    enabled: !!parentId,\n  });\n\n  const assignMutation = useMutation({\n    mutationFn: async ({ sampleId, childId }: { sampleId: string; childId: string }) => {\n      return apiRequest(\"POST\", `/api/sample-chapters/${sampleId}/assign`, {\n        childId,\n        parentId,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/chapters\", parentId] });\n      toast({\n        title: \"تم إسناد الفصل\",\n        description: \"تم إضافة الفصل إلى قائمة دروس الطفل بنجاح\",\n      });\n      setAssigningId(null);\n    },\n    onError: () => {\n      toast({\n        title: \"خطأ\",\n        description: \"فشل في إسناد الفصل، حاول مرة أخرى\",\n        variant: \"destructive\",\n      });\n      setAssigningId(null);\n    },\n  });\n\n  const filteredChapters = sampleChapters?.filter((chapter) => {\n    if (selectedSubject !== \"all\" && chapter.subject !== selectedSubject) return false;\n    if (selectedGrade !== \"all\" && chapter.grade !== parseInt(selectedGrade, 10)) return false;\n    return true;\n  });\n\n  const handleAssign = (sampleId: string) => {\n    if (!selectedChild) {\n      toast({\n        title: \"اختر طفلاً\",\n        description: \"يرجى اختيار الطفل الذي تريد إسناد الفصل له\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    setAssigningId(sampleId);\n    assignMutation.mutate({ sampleId, childId: selectedChild });\n  };\n\n  if (!parentId) {\n    navigate(\"/auth\");\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\" dir=\"rtl\">\n      <header className=\"bg-white dark:bg-gray-800 border-b sticky top-0 z-50\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16 gap-4\">\n            <div className=\"flex items-center gap-4\">\n              <Link href=\"/\">\n                <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n                  <ArrowRight className=\"w-5 h-5\" />\n                </Button>\n              </Link>\n              <div>\n                <h1 className=\"text-xl font-bold font-arabic\">مكتبة المحتوى</h1>\n                <p className=\"text-sm text-muted-foreground font-arabic\">دروس جاهزة للتعلم</p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"mb-8 space-y-4\">\n          <p className=\"text-muted-foreground font-arabic\">\n            استعرض الدروس التعليمية الجاهزة واختر ما يناسب مستوى طفلك\n          </p>\n\n          <div className=\"flex flex-wrap gap-4\">\n            <Select value={selectedSubject} onValueChange={setSelectedSubject}>\n              <SelectTrigger className=\"w-40\" data-testid=\"select-subject-filter\">\n                <SelectValue placeholder=\"كل المواد\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">كل المواد</SelectItem>\n                <SelectItem value=\"math\">رياضيات</SelectItem>\n                <SelectItem value=\"science\">علوم</SelectItem>\n                <SelectItem value=\"arabic\">لغة عربية</SelectItem>\n                <SelectItem value=\"english\">لغة إنجليزية</SelectItem>\n                <SelectItem value=\"islamic\">تربية إسلامية</SelectItem>\n                <SelectItem value=\"social\">اجتماعيات</SelectItem>\n              </SelectContent>\n            </Select>\n\n            <Select value={selectedGrade} onValueChange={setSelectedGrade}>\n              <SelectTrigger className=\"w-40\" data-testid=\"select-grade-filter\">\n                <SelectValue placeholder=\"كل الصفوف\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">كل الصفوف</SelectItem>\n                {[1, 2, 3, 4, 5, 6].map((grade) => (\n                  <SelectItem key={grade} value={grade.toString()}>\n                    الصف {grade === 1 ? \"الأول\" : grade === 2 ? \"الثاني\" : grade === 3 ? \"الثالث\" : grade === 4 ? \"الرابع\" : grade === 5 ? \"الخامس\" : \"السادس\"}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n\n            {children && children.length > 0 && (\n              <Select value={selectedChild} onValueChange={setSelectedChild}>\n                <SelectTrigger className=\"w-48\" data-testid=\"select-child\">\n                  <SelectValue placeholder=\"اختر الطفل\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {children.map((child) => (\n                    <SelectItem key={child.id} value={child.id}>\n                      {child.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            )}\n          </div>\n        </div>\n\n        {isLoading ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n          </div>\n        ) : filteredChapters && filteredChapters.length > 0 ? (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {filteredChapters.map((chapter) => {\n              const SubjectIcon = subjectIcons[chapter.subject] || BookOpen;\n              \n              return (\n                <Card \n                  key={chapter.id} \n                  className=\"hover-elevate transition-all\"\n                  data-testid={`card-sample-chapter-${chapter.id}`}\n                >\n                  <CardHeader className=\"pb-2\">\n                    <div className=\"flex items-start justify-between gap-2\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"p-2 rounded-lg bg-primary/10\">\n                          <SubjectIcon className=\"w-5 h-5 text-primary\" />\n                        </div>\n                        <div>\n                          <CardTitle className=\"text-lg font-arabic\">\n                            {chapter.titleAr}\n                          </CardTitle>\n                          <CardDescription className=\"font-arabic\">\n                            {subjectLabels[chapter.subject] || chapter.subject}\n                          </CardDescription>\n                        </div>\n                      </div>\n                      <Badge \n                        variant=\"secondary\" \n                        className={difficultyColors[chapter.difficulty || \"medium\"]}\n                      >\n                        {difficultyLabels[chapter.difficulty || \"medium\"]}\n                      </Badge>\n                    </div>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <p className=\"text-sm text-muted-foreground font-arabic line-clamp-2\">\n                      {chapter.descriptionAr}\n                    </p>\n                    \n                    <div className=\"flex items-center gap-4 text-sm text-muted-foreground\">\n                      <div className=\"flex items-center gap-1\">\n                        <GraduationCap className=\"w-4 h-4\" />\n                        <span className=\"font-arabic\">الصف {chapter.grade}</span>\n                      </div>\n                      <div className=\"flex items-center gap-1\">\n                        <Clock className=\"w-4 h-4\" />\n                        <span className=\"font-arabic\">{chapter.estimatedMinutes} دقيقة</span>\n                      </div>\n                    </div>\n\n                    <Button \n                      className=\"w-full gap-2 font-arabic\"\n                      onClick={() => handleAssign(chapter.id)}\n                      disabled={!selectedChild || assigningId === chapter.id}\n                      data-testid={`button-assign-${chapter.id}`}\n                    >\n                      {assigningId === chapter.id ? (\n                        <>\n                          <Loader2 className=\"w-4 h-4 animate-spin\" />\n                          جاري الإضافة...\n                        </>\n                      ) : (\n                        <>\n                          <Play className=\"w-4 h-4\" />\n                          إضافة للطفل\n                        </>\n                      )}\n                    </Button>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        ) : (\n          <Card className=\"p-8 text-center\">\n            <BookOpen className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n            <h3 className=\"font-arabic font-semibold mb-2\">لا توجد دروس</h3>\n            <p className=\"text-muted-foreground font-arabic text-sm\">\n              {selectedSubject !== \"all\" || selectedGrade !== \"all\" \n                ? \"لا توجد دروس بهذه المعايير، جرب تغيير الفلاتر\"\n                : \"سيتم إضافة المزيد من الدروس قريباً\"\n              }\n            </p>\n          </Card>\n        )}\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":11546,"size_tokens":null},"client/src/pages/subscription.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle, CardFooter } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Check, Crown, Sparkles, Users, ArrowRight, BookOpen } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface Price {\n  id: string;\n  unit_amount: number;\n  currency: string;\n  recurring: { interval: string } | null;\n  active: boolean;\n}\n\ninterface Product {\n  id: string;\n  name: string;\n  description: string;\n  active: boolean;\n  metadata: {\n    tier: string;\n    monthlyChapters: string;\n    maxChildren: string;\n  };\n  prices: Price[];\n}\n\nconst tierIcons: Record<string, typeof Crown> = {\n  basic: BookOpen,\n  pro: Sparkles,\n  family: Users,\n};\n\nconst tierColors: Record<string, string> = {\n  basic: \"from-blue-500 to-blue-600\",\n  pro: \"from-purple-500 to-purple-600\",\n  family: \"from-amber-500 to-amber-600\",\n};\n\nexport default function SubscriptionPage() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  \n  const userId = localStorage.getItem(\"userId\");\n  const userName = localStorage.getItem(\"userName\");\n\n  const { data: productsData, isLoading } = useQuery<{ data: Product[] }>({\n    queryKey: [\"/api/stripe/products\"],\n    enabled: !!userId,\n  });\n\n  const checkoutMutation = useMutation({\n    mutationFn: async (priceId: string) => {\n      const res = await apiRequest(\"POST\", \"/api/stripe/checkout\", {\n        userId,\n        priceId,\n      });\n      return res.json();\n    },\n    onSuccess: (data) => {\n      if (data.url) {\n        window.location.href = data.url;\n      }\n    },\n    onError: () => {\n      toast({\n        title: \"خطأ\",\n        description: \"فشل فتح صفحة الدفع\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const formatPrice = (amount: number, currency: string) => {\n    return new Intl.NumberFormat(\"ar-SA\", {\n      style: \"currency\",\n      currency: currency.toUpperCase(),\n      minimumFractionDigits: 0,\n    }).format(amount / 100);\n  };\n\n  if (!userId) {\n    setLocation(\"/auth\");\n    return null;\n  }\n\n  const products = productsData?.data || [];\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-green-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900\" dir=\"rtl\">\n      <div className=\"container mx-auto px-4 py-12\">\n        <div className=\"text-center mb-12\">\n          <Badge variant=\"secondary\" className=\"mb-4\">\n            <Crown className=\"w-3 h-3 ml-1\" />\n            خطط الاشتراك\n          </Badge>\n          <h1 className=\"text-4xl font-bold mb-4 font-cairo\">اختر الخطة المناسبة لعائلتك</h1>\n          <p className=\"text-muted-foreground text-lg max-w-2xl mx-auto\">\n            استثمر في مستقبل أطفالك مع LearnSnap - تعلم تفاعلي مدعوم بالذكاء الاصطناعي\n          </p>\n        </div>\n\n        <div className=\"mb-8 text-center\">\n          <Card className=\"inline-block\">\n            <CardContent className=\"py-4 px-6 flex items-center gap-4\">\n              <div className=\"flex items-center gap-2 text-green-600\">\n                <Check className=\"w-5 h-5\" />\n                <span>ضمان استرداد لمدة 7 أيام</span>\n              </div>\n              <div className=\"h-4 w-px bg-border\" />\n              <div className=\"flex items-center gap-2 text-green-600\">\n                <Check className=\"w-5 h-5\" />\n                <span>إلغاء في أي وقت</span>\n              </div>\n              <div className=\"h-4 w-px bg-border\" />\n              <div className=\"flex items-center gap-2 text-green-600\">\n                <Check className=\"w-5 h-5\" />\n                <span>دعم فني على مدار الساعة</span>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {isLoading ? (\n          <div className=\"grid md:grid-cols-3 gap-8 max-w-5xl mx-auto\">\n            {[1, 2, 3].map((i) => (\n              <Card key={i} className=\"relative\">\n                <CardHeader>\n                  <Skeleton className=\"h-8 w-24 mb-2\" />\n                  <Skeleton className=\"h-12 w-32\" />\n                  <Skeleton className=\"h-4 w-full mt-2\" />\n                </CardHeader>\n                <CardContent>\n                  <Skeleton className=\"h-4 w-full mb-2\" />\n                  <Skeleton className=\"h-4 w-3/4 mb-2\" />\n                  <Skeleton className=\"h-4 w-1/2\" />\n                </CardContent>\n                <CardFooter>\n                  <Skeleton className=\"h-10 w-full\" />\n                </CardFooter>\n              </Card>\n            ))}\n          </div>\n        ) : products.length === 0 ? (\n          <div className=\"text-center py-16\">\n            <Card className=\"max-w-md mx-auto\">\n              <CardContent className=\"py-12\">\n                <Sparkles className=\"w-16 h-16 mx-auto mb-4 text-muted-foreground\" />\n                <h3 className=\"text-xl font-semibold mb-2\">الخطط قادمة قريباً</h3>\n                <p className=\"text-muted-foreground mb-6\">\n                  نعمل على إعداد خطط اشتراك مميزة لك\n                </p>\n                <Button onClick={() => setLocation(\"/dashboard\")} data-testid=\"button-back-dashboard\">\n                  العودة للوحة التحكم\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n        ) : (\n          <div className=\"grid md:grid-cols-3 gap-8 max-w-5xl mx-auto\">\n            {products.map((product, index) => {\n              const tier = product.metadata?.tier || \"basic\";\n              const Icon = tierIcons[tier] || BookOpen;\n              const color = tierColors[tier] || \"from-blue-500 to-blue-600\";\n              const price = product.prices[0];\n              const isPopular = tier === \"pro\";\n\n              return (\n                <Card \n                  key={product.id} \n                  className={`relative transition-all duration-300 ${isPopular ? \"ring-2 ring-purple-500 scale-105\" : \"\"}`}\n                  data-testid={`card-subscription-${tier}`}\n                >\n                  {isPopular && (\n                    <div className=\"absolute -top-3 left-1/2 -translate-x-1/2\">\n                      <Badge className={`bg-gradient-to-r ${color} text-white`}>\n                        الأكثر شعبية\n                      </Badge>\n                    </div>\n                  )}\n                  \n                  <CardHeader className=\"text-center pt-8\">\n                    <div className={`w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-r ${color} flex items-center justify-center`}>\n                      <Icon className=\"w-8 h-8 text-white\" />\n                    </div>\n                    <CardTitle className=\"text-2xl\">{product.name}</CardTitle>\n                    {price && (\n                      <div className=\"mt-4\">\n                        <span className=\"text-4xl font-bold\">\n                          {formatPrice(price.unit_amount, price.currency)}\n                        </span>\n                        <span className=\"text-muted-foreground\">/شهرياً</span>\n                      </div>\n                    )}\n                    <CardDescription className=\"mt-2\">\n                      {product.description}\n                    </CardDescription>\n                  </CardHeader>\n                  \n                  <CardContent className=\"pb-4\">\n                    <ul className=\"space-y-3\">\n                      <li className=\"flex items-center gap-2\">\n                        <div className={`w-5 h-5 rounded-full bg-gradient-to-r ${color} flex items-center justify-center`}>\n                          <Check className=\"w-3 h-3 text-white\" />\n                        </div>\n                        <span>\n                          {product.metadata?.monthlyChapters === \"unlimited\" \n                            ? \"فصول غير محدودة\" \n                            : `${product.metadata?.monthlyChapters || \"5\"} فصول شهرياً`}\n                        </span>\n                      </li>\n                      <li className=\"flex items-center gap-2\">\n                        <div className={`w-5 h-5 rounded-full bg-gradient-to-r ${color} flex items-center justify-center`}>\n                          <Check className=\"w-3 h-3 text-white\" />\n                        </div>\n                        <span>\n                          {product.metadata?.maxChildren === \"1\" \n                            ? \"طفل واحد\" \n                            : `حتى ${product.metadata?.maxChildren || \"1\"} أطفال`}\n                        </span>\n                      </li>\n                      <li className=\"flex items-center gap-2\">\n                        <div className={`w-5 h-5 rounded-full bg-gradient-to-r ${color} flex items-center justify-center`}>\n                          <Check className=\"w-3 h-3 text-white\" />\n                        </div>\n                        <span>تقارير مفصلة للأداء</span>\n                      </li>\n                      <li className=\"flex items-center gap-2\">\n                        <div className={`w-5 h-5 rounded-full bg-gradient-to-r ${color} flex items-center justify-center`}>\n                          <Check className=\"w-3 h-3 text-white\" />\n                        </div>\n                        <span>دعم فني</span>\n                      </li>\n                    </ul>\n                  </CardContent>\n                  \n                  <CardFooter>\n                    <Button\n                      className={`w-full ${isPopular ? `bg-gradient-to-r ${color} hover:opacity-90` : \"\"}`}\n                      variant={isPopular ? \"default\" : \"outline\"}\n                      size=\"lg\"\n                      onClick={() => price && checkoutMutation.mutate(price.id)}\n                      disabled={!price || checkoutMutation.isPending}\n                      data-testid={`button-subscribe-${tier}`}\n                    >\n                      {checkoutMutation.isPending ? \"جاري التحميل...\" : \"اشترك الآن\"}\n                      <ArrowRight className=\"w-4 h-4 mr-2\" />\n                    </Button>\n                  </CardFooter>\n                </Card>\n              );\n            })}\n          </div>\n        )}\n\n        <div className=\"text-center mt-12\">\n          <Button \n            variant=\"ghost\" \n            onClick={() => setLocation(\"/dashboard\")}\n            data-testid=\"button-back\"\n          >\n            العودة للوحة التحكم\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":10923,"size_tokens":null},"script/seed-products.ts":{"content":"import { getUncachableStripeClient } from '../server/stripeClient';\n\nasync function seedProducts() {\n  const stripe = await getUncachableStripeClient();\n\n  console.log('Creating subscription products...');\n\n  const products = await stripe.products.search({ query: \"name:'LearnSnap'\" });\n  if (products.data.length > 0) {\n    console.log('Products already exist, skipping seed');\n    return;\n  }\n\n  const basicProduct = await stripe.products.create({\n    name: 'LearnSnap أساسي',\n    description: 'خطة أساسية - 5 فصول شهرياً، طفل واحد',\n    metadata: {\n      tier: 'basic',\n      monthlyChapters: '5',\n      maxChildren: '1',\n    },\n  });\n\n  await stripe.prices.create({\n    product: basicProduct.id,\n    unit_amount: 2900,\n    currency: 'sar',\n    recurring: { interval: 'month' },\n  });\n\n  console.log('Created Basic product:', basicProduct.id);\n\n  const proProduct = await stripe.products.create({\n    name: 'LearnSnap برو',\n    description: 'خطة احترافية - 20 فصل شهرياً، 3 أطفال',\n    metadata: {\n      tier: 'pro',\n      monthlyChapters: '20',\n      maxChildren: '3',\n    },\n  });\n\n  await stripe.prices.create({\n    product: proProduct.id,\n    unit_amount: 7900,\n    currency: 'sar',\n    recurring: { interval: 'month' },\n  });\n\n  console.log('Created Pro product:', proProduct.id);\n\n  const familyProduct = await stripe.products.create({\n    name: 'LearnSnap عائلي',\n    description: 'خطة عائلية - فصول غير محدودة، 10 أطفال',\n    metadata: {\n      tier: 'family',\n      monthlyChapters: 'unlimited',\n      maxChildren: '10',\n    },\n  });\n\n  await stripe.prices.create({\n    product: familyProduct.id,\n    unit_amount: 14900,\n    currency: 'sar',\n    recurring: { interval: 'month' },\n  });\n\n  console.log('Created Family product:', familyProduct.id);\n  console.log('Seed complete!');\n}\n\nseedProducts().catch(console.error);\n","path":null,"size_bytes":1925,"size_tokens":null},"server/webhookHandlers.ts":{"content":"import { getStripeSync, getUncachableStripeClient } from './stripeClient';\nimport { db } from './db';\nimport { users } from '@shared/schema';\nimport { eq, sql } from 'drizzle-orm';\n\nexport class WebhookHandlers {\n  static async processWebhook(payload: Buffer, signature: string): Promise<void> {\n    if (!Buffer.isBuffer(payload)) {\n      throw new Error(\n        'STRIPE WEBHOOK ERROR: Payload must be a Buffer. ' +\n        'Received type: ' + typeof payload + '. ' +\n        'This usually means express.json() parsed the body before reaching this handler. ' +\n        'FIX: Ensure webhook route is registered BEFORE app.use(express.json()).'\n      );\n    }\n\n    const sync = await getStripeSync();\n    await sync.processWebhook(payload, signature);\n\n    const stripe = await getUncachableStripeClient();\n    const event = stripe.webhooks.constructEvent(\n      payload,\n      signature,\n      process.env.STRIPE_WEBHOOK_SECRET || ''\n    );\n\n    try {\n      switch (event.type) {\n        case 'checkout.session.completed': {\n          const session = event.data.object as any;\n          if (session.mode === 'subscription' && session.customer) {\n            const customerId = session.customer as string;\n            const subscriptionId = session.subscription as string;\n            \n            const subscription = await stripe.subscriptions.retrieve(subscriptionId);\n            const priceId = subscription.items.data[0]?.price.id;\n            const productId = subscription.items.data[0]?.price.product as string;\n            const product = await stripe.products.retrieve(productId);\n            const tier = (product.metadata?.tier as string) || 'basic';\n\n            await db.update(users)\n              .set({\n                stripeSubscriptionId: subscriptionId,\n                subscriptionTier: tier,\n                subscriptionStatus: 'active',\n              })\n              .where(eq(users.stripeCustomerId, customerId));\n\n            console.log(`Subscription activated for customer ${customerId}: ${tier}`);\n          }\n          break;\n        }\n\n        case 'customer.subscription.updated': {\n          const subscription = event.data.object as any;\n          const customerId = subscription.customer as string;\n          const status = subscription.status;\n          \n          let subscriptionStatus = 'active';\n          if (status === 'canceled' || status === 'unpaid') {\n            subscriptionStatus = 'cancelled';\n          } else if (status === 'past_due') {\n            subscriptionStatus = 'past_due';\n          }\n\n          await db.update(users)\n            .set({ subscriptionStatus })\n            .where(eq(users.stripeCustomerId, customerId));\n\n          console.log(`Subscription updated for customer ${customerId}: ${status}`);\n          break;\n        }\n\n        case 'customer.subscription.deleted': {\n          const subscription = event.data.object as any;\n          const customerId = subscription.customer as string;\n\n          await db.update(users)\n            .set({\n              subscriptionTier: 'free',\n              subscriptionStatus: 'cancelled',\n              stripeSubscriptionId: null,\n            })\n            .where(eq(users.stripeCustomerId, customerId));\n\n          console.log(`Subscription cancelled for customer ${customerId}`);\n          break;\n        }\n      }\n    } catch (err) {\n      console.error('Error processing webhook event:', err);\n    }\n  }\n}\n","path":null,"size_bytes":3425,"size_tokens":null},"client/src/pages/leaderboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useLocation, Link } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ArrowRight, Trophy, Star, Award, Medal, Crown } from \"lucide-react\";\n\ntype LeaderboardEntry = {\n  childId: string;\n  name: string;\n  totalStars: number;\n  badgeCount: number;\n  rank: number;\n};\n\nexport default function LeaderboardPage() {\n  const [, setLocation] = useLocation();\n  const userId = localStorage.getItem(\"userId\");\n\n  const { data: leaderboard, isLoading } = useQuery<LeaderboardEntry[]>({\n    queryKey: [\"/api/parents\", userId, \"leaderboard\"],\n    enabled: !!userId,\n  });\n\n  const getRankIcon = (rank: number) => {\n    switch (rank) {\n      case 1:\n        return <Crown className=\"w-6 h-6 text-amber-500\" />;\n      case 2:\n        return <Medal className=\"w-6 h-6 text-gray-400\" />;\n      case 3:\n        return <Medal className=\"w-6 h-6 text-amber-700\" />;\n      default:\n        return <span className=\"w-6 h-6 flex items-center justify-center font-bold text-muted-foreground\">{rank}</span>;\n    }\n  };\n\n  const getRankGradient = (rank: number) => {\n    switch (rank) {\n      case 1:\n        return \"from-amber-50 to-amber-100 dark:from-amber-950 dark:to-amber-900 border-amber-200 dark:border-amber-800\";\n      case 2:\n        return \"from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 border-gray-200 dark:border-gray-700\";\n      case 3:\n        return \"from-orange-50 to-orange-100 dark:from-orange-950 dark:to-orange-900 border-orange-200 dark:border-orange-800\";\n      default:\n        return \"\";\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\" dir=\"rtl\">\n      <header className=\"bg-card border-b sticky top-0 z-50\">\n        <div className=\"max-w-4xl mx-auto p-4 flex items-center justify-between gap-4\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-amber-400 to-amber-600 flex items-center justify-center\">\n              <Trophy className=\"w-6 h-6 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"font-bold font-arabic text-lg\">لوحة المتصدرين</h1>\n              <p className=\"text-xs text-muted-foreground font-arabic\">تنافس الأبناء</p>\n            </div>\n          </div>\n          <Link href=\"/\">\n            <Button variant=\"ghost\" className=\"font-arabic gap-2\" data-testid=\"button-back-dashboard\">\n              <ArrowRight className=\"w-4 h-4\" />\n              الرئيسية\n            </Button>\n          </Link>\n        </div>\n      </header>\n\n      <main className=\"max-w-4xl mx-auto p-4 pb-20\">\n        {!leaderboard || leaderboard.length === 0 ? (\n          <Card>\n            <CardContent className=\"p-8 text-center\">\n              <Trophy className=\"w-16 h-16 mx-auto mb-4 text-muted-foreground\" />\n              <h2 className=\"font-arabic text-lg font-bold mb-2\">لا يوجد أبناء بعد</h2>\n              <p className=\"text-muted-foreground font-arabic mb-4\">\n                أضف أبناءك من الصفحة الرئيسية لبدء المنافسة\n              </p>\n              <Link href=\"/\">\n                <Button className=\"font-arabic\" data-testid=\"button-add-children\">إضافة أبناء</Button>\n              </Link>\n            </CardContent>\n          </Card>\n        ) : leaderboard.length === 1 ? (\n          <Card>\n            <CardContent className=\"p-8 text-center\">\n              <Trophy className=\"w-16 h-16 mx-auto mb-4 text-amber-500\" />\n              <h2 className=\"font-arabic text-lg font-bold mb-2\">{leaderboard[0].name} هو البطل</h2>\n              <p className=\"text-muted-foreground font-arabic mb-4\">\n                أضف طفلاً آخر لبدء المنافسة بين الأبناء\n              </p>\n              <div className=\"flex items-center justify-center gap-6 mt-6\">\n                <div className=\"text-center\">\n                  <div className=\"flex items-center justify-center gap-1 text-amber-500\">\n                    <Star className=\"w-5 h-5\" />\n                    <span className=\"text-2xl font-bold\">{leaderboard[0].totalStars}</span>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground font-arabic\">نجوم</p>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"flex items-center justify-center gap-1 text-purple-500\">\n                    <Award className=\"w-5 h-5\" />\n                    <span className=\"text-2xl font-bold\">{leaderboard[0].badgeCount}</span>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground font-arabic\">شارات</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"space-y-4\">\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"font-arabic text-base flex items-center gap-2\">\n                  <Trophy className=\"w-5 h-5 text-amber-500\" />\n                  ترتيب الأبناء\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                {leaderboard.map((entry) => (\n                  <div\n                    key={entry.childId}\n                    className={`flex items-center gap-4 p-4 rounded-md border bg-gradient-to-l ${getRankGradient(entry.rank)}`}\n                    data-testid={`leaderboard-entry-${entry.childId}`}\n                  >\n                    <div className=\"flex-shrink-0\">{getRankIcon(entry.rank)}</div>\n                    <div className=\"flex-1 min-w-0\">\n                      <h3 className=\"font-arabic font-bold truncate\">{entry.name}</h3>\n                      <div className=\"flex items-center gap-4 mt-1\">\n                        <div className=\"flex items-center gap-1 text-amber-500\">\n                          <Star className=\"w-4 h-4\" />\n                          <span className=\"text-sm font-bold\">{entry.totalStars}</span>\n                          <span className=\"text-xs text-muted-foreground font-arabic\">نجوم</span>\n                        </div>\n                        <div className=\"flex items-center gap-1 text-purple-500\">\n                          <Award className=\"w-4 h-4\" />\n                          <span className=\"text-sm font-bold\">{entry.badgeCount}</span>\n                          <span className=\"text-xs text-muted-foreground font-arabic\">شارات</span>\n                        </div>\n                      </div>\n                    </div>\n                    {entry.rank <= 3 && (\n                      <Badge \n                        className={\n                          entry.rank === 1 \n                            ? \"bg-amber-100 text-amber-700 dark:bg-amber-900 dark:text-amber-300\" \n                            : entry.rank === 2 \n                            ? \"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300\" \n                            : \"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300\"\n                        }\n                      >\n                        {entry.rank === 1 ? \"ذهبي\" : entry.rank === 2 ? \"فضي\" : \"برونزي\"}\n                      </Badge>\n                    )}\n                  </div>\n                ))}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardContent className=\"p-4 text-center\">\n                <p className=\"text-muted-foreground font-arabic text-sm\">\n                  شجع أبناءك على التعلم وجمع النجوم والشارات للتقدم في الترتيب\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":8199,"size_tokens":null},"client/src/hooks/use-speech.ts":{"content":"import { useState, useCallback, useEffect, useRef } from \"react\";\n\ninterface UseSpeechOptions {\n  lang?: string;\n  rate?: number;\n  pitch?: number;\n  volume?: number;\n}\n\ninterface UseSpeechReturn {\n  speak: (text: string) => void;\n  stop: () => void;\n  pause: () => void;\n  resume: () => void;\n  isSpeaking: boolean;\n  isPaused: boolean;\n  isSupported: boolean;\n}\n\nexport function useSpeech(options: UseSpeechOptions = {}): UseSpeechReturn {\n  const { lang = \"ar-SA\", rate = 0.9, pitch = 1, volume = 1 } = options;\n  \n  const [isSpeaking, setIsSpeaking] = useState(false);\n  const [isPaused, setIsPaused] = useState(false);\n  const [isSupported, setIsSupported] = useState(false);\n  const utteranceRef = useRef<SpeechSynthesisUtterance | null>(null);\n\n  useEffect(() => {\n    setIsSupported(typeof window !== \"undefined\" && \"speechSynthesis\" in window);\n  }, []);\n\n  const speak = useCallback((text: string) => {\n    if (!isSupported || !text) return;\n    \n    window.speechSynthesis.cancel();\n    \n    const utterance = new SpeechSynthesisUtterance(text);\n    utterance.lang = lang;\n    utterance.rate = rate;\n    utterance.pitch = pitch;\n    utterance.volume = volume;\n\n    utterance.onstart = () => {\n      setIsSpeaking(true);\n      setIsPaused(false);\n    };\n\n    utterance.onend = () => {\n      setIsSpeaking(false);\n      setIsPaused(false);\n    };\n\n    utterance.onerror = () => {\n      setIsSpeaking(false);\n      setIsPaused(false);\n    };\n\n    utteranceRef.current = utterance;\n    window.speechSynthesis.speak(utterance);\n  }, [isSupported, lang, rate, pitch, volume]);\n\n  const stop = useCallback(() => {\n    if (!isSupported) return;\n    window.speechSynthesis.cancel();\n    setIsSpeaking(false);\n    setIsPaused(false);\n  }, [isSupported]);\n\n  const pause = useCallback(() => {\n    if (!isSupported || !isSpeaking) return;\n    window.speechSynthesis.pause();\n    setIsPaused(true);\n  }, [isSupported, isSpeaking]);\n\n  const resume = useCallback(() => {\n    if (!isSupported || !isPaused) return;\n    window.speechSynthesis.resume();\n    setIsPaused(false);\n  }, [isSupported, isPaused]);\n\n  useEffect(() => {\n    return () => {\n      if (isSupported) {\n        window.speechSynthesis.cancel();\n      }\n    };\n  }, [isSupported]);\n\n  return {\n    speak,\n    stop,\n    pause,\n    resume,\n    isSpeaking,\n    isPaused,\n    isSupported,\n  };\n}\n","path":null,"size_bytes":2355,"size_tokens":null}},"version":2}